<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HongYanAsstHardware</title>
      <link href="/HongYanAsstHard/"/>
      <url>/HongYanAsstHard/</url>
      
        <content type="html"><![CDATA[<blockquote><p>北京邮电大学雏雁计划项目 <code>HongYanAsst. 鸿雁车协助手</code> 硬件部分</p><p>信息与通信工程导论项目 <code>HongYanAsst 骑行安全监控系统</code> Wiki</p></blockquote><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.10/img/HYAH/gh_c7de51796504_3441.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.10/img/HYAH/gh_c7de51796504_3441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="100" height = "100" alt="QRcode" align=center /><a id="more"></a><h3 id="项目背景及用户分析"><a href="#项目背景及用户分析" class="headerlink" title="项目背景及用户分析"></a>项目背景及用户分析</h3><p>自行车在生活中随处可见，具有速度快、重量轻、节能环保、维护简单等优点。得益于人力车的性质，自行车兼具交通工具与运动器材的属性。它既是一种绿色环保的代步、出行方式；也可作为运动器材，进行多样的骑行训练与体育竞技。骑自行车锻炼，可亲近自然，愉悦身心，结交朋友，陶冶情操，更能增长见识，培养毅力，强身健体，预防疾病。近年来，随着智能运动终端的广泛普及，结合运动数据进行科学训练的模式，也正被愈发广泛地接受。</p><p>截至2019年，我国自行车社会保有量已近4亿辆、电动自行车近3亿辆，均位居世界第一。然而，自行车运动在我国的普及，前路依然漫长。推广力度的不足、相对高昂的器材价格与安全意识、健康意识的缺失等，都是阻碍更多普通大众接收自行车文化，加入骑友（骑行爱好者）行列的不利因素。</p><p>骑行运动本身由于速度快、技术要求高、时间长易于疲劳、路线一般开放等特点，其危险性可想而知。甚至仅仅是平时骑行通勤，道路上的机动车及电动车仍然会威胁到通勤安全。</p><p>年轻人，特别是大学生，一般具有体魄强健、追求刺激、乐于接受新鲜思想与事物的特点，十分适合作为自行车运动的普及者与首要普及对象。对普及者而言，正所谓“顺风而呼，声非加疾也，而闻者彰”，只有齐心协力，形成合力，持久发力，才能为自行车运动的普及与骑行活动的开展注入强大动力。成立自行车协会，组织骑行相关活动，是普及自行车文化较为经济、高效的方式之一。</p><p>时隔11载，2020年秋，在我校广大骑行爱好者的强烈要求与不懈努力之下，北郵鸿雁自行车协会（下简称“鸿雁车协”、“协会”）重新成立，正式成为认证社团。鸿雁车协推广自行车运动，为骑友提供交流平台，将骑行活动组织化、规范化，使自行车运动与健康意识在我校的普及迈出了基础却坚实的一步。</p><p>鸿雁车协的成立，对骑行爱好者意义重大，吸引了我校学生的广泛关注。迄今为止，协会已成功组织并顺利完成数次周边百公里级别骑行。2020年社团招新（百团大战）期间，关注协会者络绎不绝，覆盖各学院本科生、硕士生、博士生近300人；2020年社团嘉年华之夜，参与协会举办活动者260余人，现场排起长队，十分火爆。虽然成立时间尚短，活动举办尚少，但协会展现出的强劲发展势头，令鸿雁车协中心组与协会成员刮目相看。</p><p>然而，回顾我校自行车协会历史中断的十一年，却有太多需要弥补的损失。虽然我校骑友数载流离，车协事务百废待兴的混沌状态，已随着车协的成立与初步发展得到缓解，但不可否认的是，周边名校（如北大、央财、北航等）一直在争分夺秒，结合优势学科特色与社会影响力，建设专业性强，具有院校特色的自行车协会组织与良好的自行车文化氛围。相形之下，不论是组织、规模还是影响力，我邮车协都亟待发展。</p><p>提高学生健康意识，推动我校自行车运动事业发展，恰逢其运；利用所学知识与现有资源构建信息化平台，促进鸿雁车协的现代化、信息化进程，正当其时。鸿雁车协中心组部分成员联手志同道合者，组成团队，立志通过该项目的开发，为各高校车协的发展以及所有骑行爱好者的良好体验贡献力量。</p><h3 id="创意过程"><a href="#创意过程" class="headerlink" title="创意过程"></a>创意过程</h3><h4 id="创意分析过程"><a href="#创意分析过程" class="headerlink" title="创意分析过程"></a>创意分析过程</h4><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/YR6W32PQPT2CEEN7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/YR6W32PQPT2CEEN7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="疯狂八分钟"></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/OZ3A6CWM1_JZ3C18Z5K.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/OZ3A6CWM1_JZ3C18Z5K.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="用户共感图"></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/HZOU_EMJ8GCXJW8A1I8UA.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/HZOU_EMJ8GCXJW8A1I8UA.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="用户痛点分析"></p><h4 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h4><p>本项目主要为鸿雁车协微信公众平台及微信小程序<code>HongYanAsst</code>，以及任何一位骑行爱好者及他们的亲友、任何一位骑行通勤者及他们的亲友开发端到端的、软硬结合的骑行安全监控系统。本项目的成果将包含以下几项核心功能：</p><ol><li>实时定位。实时获取设备位置信息及速度，并在微信小程序中显示。</li><li>事故侦测。由硬件设备判断是否发生事故，如发生事故则向指定手机号码发送短信告知。</li><li>高亮时刻。设备持有者可通过微信小程序在设备当前位置标点并上传图片，来和他的亲友共享。</li></ol><h4 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h4><p>这个板块为立项初期进行用户调研时热心用户提出的可行性建议中的典型代表.</p><p>热心用户的提问对我们帮助很大, 能更清楚地了解用户担心什么, 让考虑更周全.</p><ul><li><p>Q: 为什么不使用手机作为<code>GPS</code>信源, 做小程序端到端系统?</p></li><li><p>A: 我们测试过微信小程序获取并发送<code>GPS</code>定位在手机后台运行的稳定性, 在<code>Samsung S20</code>上一小时稳定性约为<code>76%</code>, <code>HUAWEI P30</code>约为<code>65%</code>, 故不采用这种不稳妥的方式. 而且手机作为出门在外唯一的实时通信工具, 让手机有额外的电源损耗可能不是明智之举.</p></li><li><p>Q: 为什么对产品重量和气动效果重视程度较低?</p></li><li><p>A: 轻量化和气动外形研发时间长, 成本高, 研发团队在短时间内可能无法做出很好的解决方案, 短期内只打算对核心功能做建设及优化. 况且我们的用户定位更倾向于一般的骑行爱好者及通勤者, 竞赛型用户究竟是少数. 另外, 我们的项目是开源的, 用户完全在符合协议要求的前提下使用更好的材料、定制更气动的外形.</p></li><li><p>Q: 有考虑过使用<code>ESP8266</code>模块使用<code>WiFi</code>作为网络接入解决方案吗?</p></li><li><p>A: 有考虑过. <code>SIM</code>系列硬件对电源功率的要求比较高, 功耗也比较高, 也很占体积. 使用<code>ESP8266</code>连接<code>WiFi</code>虽然会消耗手机电源, 但是现在大部分的手机都具备移动热点功率优化系统, 人家<code>大Pro</code>做的终究是要比我们好. 所以如果<code>SIM</code>策略不符合现有条件, 我们会考虑用<code>ESP8266</code>连接移动热点来解决联网问题.</p></li><li><p>Q: 看到你们为了调试做了很多, 软件和硬件上的都有.</p></li><li><p>A: 确实. 我们很重视调试体验. 我们坚信良好的调试环境可以极大地提高调试效率.</p></li></ul><h3 id="初步原理规划"><a href="#初步原理规划" class="headerlink" title="初步原理规划"></a>初步原理规划</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/5B3EE6LF5D6EUR3YRM60.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/5B3EE6LF5D6EUR3YRM60.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="总体规划框图"></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/WeChat-miniprogram.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/WeChat-miniprogram.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="微信小程序规划框图"></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE2.2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86%E5%9B%BE2.2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="硬件规划框图"></p><h3 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h3><h4 id="设备列表"><a href="#设备列表" class="headerlink" title="设备列表"></a>设备列表</h4><table><thead><tr><th>模块</th><th>数量</th><th>功能</th></tr></thead><tbody><tr><td><font color=green>Arduino MEGA 2560</font></td><td>1</td><td>核心板</td></tr><tr><td>NI-MH AA 5600mAh 4.8V 电池阵列</td><td>2</td><td>供电</td></tr><tr><td><font color=green>SIM800C</font></td><td>1</td><td>移动网络接入</td></tr><tr><td>NEO-7N</td><td>1</td><td>获取GPS数据</td></tr><tr><td><font color=green>MPU6050</font></td><td>1</td><td>获取加速度及计算偏角</td></tr><tr><td><font color=red>ESP8266</font></td><td>1</td><td><strong>[调试]</strong> 数据传输调试</td></tr><tr><td><font color=red>LCD1602</font></td><td>1</td><td><strong>[调试]</strong> 数据展示</td></tr><tr><td><font color=red>CHQ1838</font></td><td>1</td><td><strong>[调试]</strong> 读取红外信息</td></tr><tr><td>Li14500</td><td>1</td><td><strong>[调试]</strong> 供电</td></tr><tr><td><font color=red>Li18650</font></td><td>2</td><td><strong>[调试]</strong> 供电</td></tr></tbody></table><blockquote><p>绿色表示核心组件, 红色表示已弃用.</p></blockquote><h4 id="硬件组装"><a href="#硬件组装" class="headerlink" title="硬件组装"></a>硬件组装</h4><div class="timenode"><div class="meta"><p><p>V0.0 2020/11/24</p></p></div><div class="body"><h5 id="原型机-HYAsst-THE-ORIGIN"><a href="#原型机-HYAsst-THE-ORIGIN" class="headerlink" title="原型机: HYAsst THE ORIGIN"></a>原型机: <code>HYAsst THE ORIGIN</code></h5><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224903.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224903.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224911.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224911.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224920.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/20201124_224920.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="THE ORIGIN"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <p>原型机, 调试用, 有丰富的数据显示.</p>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>v0.1 2020/11/27</p></p></div><div class="body"><h5 id="初代机-ASKR-YGGDRASILLS"><a href="#初代机-ASKR-YGGDRASILLS" class="headerlink" title="初代机: ASKR YGGDRASILLS"></a>初代机: <code>ASKR YGGDRASILLS</code></h5><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476417218.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476417218.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ASKR YGGDRASILLS"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476459137.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/1606476459137.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ASKR YGGDRASILLS"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>取消LCD数据展示及调试中断, 使用<code>LED</code>灯作为交互接口.</li><li>彻底弃用<code>ESP8266</code>, 改用<code>SIM800C</code>接入网络.</li></ol>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>v1.0 2020/11/29</p></p></div><div class="body"><h5 id="二号机-SORYU-KYOKO-ZEPPELIN"><a href="#二号机-SORYU-KYOKO-ZEPPELIN" class="headerlink" title="二号机: SORYU KYOKO ZEPPELIN"></a>二号机: <code>SORYU KYOKO ZEPPELIN</code></h5><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223828.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223828.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223839.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223839.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.6/img/HYAH/20201129_223927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU KYOKO ZEPPELIN"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>舍弃面包板, 使用主板铜柱固定各功能模块.</li><li>暂时放弃<code>LED</code>交互接口及电容组.</li><li>更好的走线, 更坚固的框架, 更友好的外形, 设备便携性进一步提升.</li></ol>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>v1.1 2020/12/02</p></p></div><div class="body"><h5 id="二号机·改-SORYU-ASUKA-RANGURE"><a href="#二号机·改-SORYU-ASUKA-RANGURE" class="headerlink" title="二号机·改: SORYU ASUKA RANGURE"></a>二号机·改: <code>SORYU ASUKA RANGURE</code></h5><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125722.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125722.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU ASUKA RANGURE"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125735.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.7/img/HYAH/20201202_125735.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SORYU ASUKA RANGURE"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>重新启用<code>LED</code>交互接口及电容组, 将其整合到一张板上(为下一个版本做准备).</li><li><code>SIM800C</code>弃用胶棒天线, 换用弹簧天线, 进一步提升便携性.</li></ol>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>v2.0 2020/12/05</p></p></div><div class="body"><h5 id="三代目-RAMIEL-OCTAHEDRON"><a href="#三代目-RAMIEL-OCTAHEDRON" class="headerlink" title="三代目: RAMIEL OCTAHEDRON"></a>三代目: <code>RAMIEL OCTAHEDRON</code></h5><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230945.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230945.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230957.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/20201205_230957.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RAMIEL OCTAHEDRON"></p>              </div>            </details><details ><summary> <p>迭代说明</p> </summary>              <div class='content'>              <ol><li>重新制作灯板, 增加线路整理功能, 并整合到设备上部.</li><li>启用<code>NI-MH AA 5600mAh 4.8V</code>电池阵列并置于设备底部, 理论续航延长至<code>23</code>小时.</li><li>优化内存占用, 将静态内容优先存储至<code>Flash</code>.</li><li>事故侦测倾角维护时间增长至<code>150</code>个算法周期.</li></ol>              </div>            </details></div></div><h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><h4 id="软件设定"><a href="#软件设定" class="headerlink" title="软件设定"></a>软件设定</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ACCE 2          <span class="comment">// 加速度阈值, 以G为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ANGLE 90        <span class="comment">// 偏差角阈值, 以度为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCIDENT_ALERT_SPEED 25  <span class="comment">// 速度阈值,   以km/h为单位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEVICE_ID <span class="meta-string">&quot;xxxx&quot;</span>         <span class="comment">// 设备ID</span></span></span><br><span class="line"><span class="keyword">const</span> String APIKey = <span class="string">&quot;xxxx&quot;</span>;    <span class="comment">// 设备api-key</span></span><br><span class="line"><span class="keyword">const</span> String TEL_NUM = <span class="string">&quot;xxxx&quot;</span>;   <span class="comment">// 事故报警目标电话号</span></span><br></pre></td></tr></table></figure><h4 id="指示灯信息"><a href="#指示灯信息" class="headerlink" title="指示灯信息"></a>指示灯信息</h4><p>本项目为产品体积 质量以及实际考虑, 使用指示灯显示的方式进行交互.</p><h5 id="main-board"><a href="#main-board" class="headerlink" title="main board"></a>main board</h5><table><thead><tr><th align="center">status</th><th align="center">green LED</th><th align="center">yellow LED</th><th align="center">RGB</th></tr></thead><tbody><tr><td align="center">1</td><td align="center"><code>Arduino</code> power on</td><td align="center">device power on</td><td align="center">-</td></tr><tr><td align="center">0</td><td align="center"><code>Arduino</code> no power</td><td align="center">device no power</td><td align="center">-</td></tr><tr><td align="center">White</td><td align="center">-</td><td align="center">-</td><td align="center">initializing</td></tr><tr><td align="center">Blue</td><td align="center">-</td><td align="center">-</td><td align="center">data fetching</td></tr><tr><td align="center">Green</td><td align="center">-</td><td align="center">-</td><td align="center">data updating</td></tr><tr><td align="center">Red</td><td align="center">-</td><td align="center">-</td><td align="center">AccidentReport triggered</td></tr></tbody></table><h5 id="SIM800C"><a href="#SIM800C" class="headerlink" title="SIM800C"></a>SIM800C</h5><table><thead><tr><th align="center">status</th><th align="center">PWR</th><th align="center">NET</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">no power</td><td align="center">no power</td></tr><tr><td align="center">1</td><td align="center">power on</td><td align="center">-</td></tr><tr><td align="center">blink (1 per 1s)</td><td align="center">-</td><td align="center">searching network</td></tr><tr><td align="center">blink (1 per 3s)</td><td align="center">-</td><td align="center">network connection OK</td></tr><tr><td align="center">blink (1 per 0.5s)</td><td align="center">-</td><td align="center">TCP connection established</td></tr></tbody></table><h5 id="GPS"><a href="#GPS" class="headerlink" title="GPS"></a>GPS</h5><table><thead><tr><th align="center">status</th><th align="center">PPS</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">no power</td></tr><tr><td align="center">1</td><td align="center">searching for satellite</td></tr><tr><td align="center">blink</td><td align="center">PPS</td></tr></tbody></table><h5 id="MPU6050"><a href="#MPU6050" class="headerlink" title="MPU6050"></a>MPU6050</h5><table><thead><tr><th align="center">status</th><th align="center">PWR</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">no power</td></tr><tr><td align="center">1</td><td align="center">power on</td></tr></tbody></table><h3 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h3><h4 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h4><h5 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h5><p>为了进行<code>SIM800C</code>调试而简单写的基于<code>Arduino</code>的串口调试工具. 不用<code>USB</code>转串口也可以进行串口调试.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mySerial Serial2</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial2.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mySerial.available()) Serial.write(mySerial.read());</span><br><span class="line">  <span class="keyword">if</span> (Serial.available()) mySerial.write(Serial.read());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Arduino-多线程"><a href="#Arduino-多线程" class="headerlink" title="Arduino 多线程"></a>Arduino 多线程</h5><h6 id="Metro-Timer"><a href="#Metro-Timer" class="headerlink" title="Metro Timer"></a>Metro Timer</h6><p>使用计时器库 <a href="https://github.com/thomasfredericks/Metro-Arduino-Wiring">Metro</a> 模拟多线程操作. 详情见代码中<code>loop()</code>函数.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Metro.h&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Metro dataUpdate      = Metro(<span class="number">5000</span>);</span><br><span class="line">Metro dataFetch       = Metro(<span class="number">1000</span>);</span><br><span class="line">Metro accidentMonitor = Metro(<span class="number">100</span>);</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (dataFetch.check())  getGpsData();</span><br><span class="line"><span class="keyword">if</span> (dataUpdate.check()) dataUpd();</span><br></pre></td></tr></table></figure><h6 id="SCoop"><a href="#SCoop" class="headerlink" title="SCoop"></a>SCoop</h6><p><code>timer0_overflow_count</code>未定义问题:</p><p>新的<code>ArduinoIDE</code>在编译的过程中不再识别<code>timer0_overflow_count</code>, 即使它前面有<code>extern</code>语句. 这使得<code>timer0_overflow_count</code>在全局作用域中不可见. 但是在旧版的<code>ArduinoIDE</code>中可以正常工作. <code>SCoop.cpp</code>中原文如下:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> timer0_overflow_count; <span class="comment">// use this variable which is incremented at each overflow</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">micros_t</span> <span class="title">SCoopMicros16</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((always_inline))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">micros_t</span> <span class="title">SCoopMicros16</span><span class="params">(<span class="keyword">void</span>)</span> <span class="comment">// same as standrad PJRC micros, but in 16 bits and with inlining</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="keyword">register</span> <span class="keyword">micros_t</span> out ;</span><br><span class="line"><span class="function"><span class="keyword">asm</span> <span class="title">volatile</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;in__tmp_reg__, __SREG__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;cli&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;in%A0, %2&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;in__zero_reg__, %3&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lds%B0, timer0_overflow_count&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;out__SREG__, __tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;sbrs__zero_reg__, %4&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;rjmpL_%=_skip&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;cpi%A0, 255&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;breqL_%=_skip&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">16000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;subi%B0, 1&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#elif F_CPU == <span class="number">8000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;subi%B0, 2&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;L_%=_skip:&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;clr__zero_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;clr__tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">16000000L</span> || F_CPU == <span class="number">8000000L</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%B0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%B0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%A0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;rol__tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%A0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;rol__tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#<span class="keyword">if</span> F_CPU == <span class="number">8000000L</span> </span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%B0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;lsl%A0&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;rol__tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="string">&quot;or%B0, __tmp_reg__&quot;</span><span class="string">&quot;\n\t&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">#endif</span></span></span><br><span class="line"><span class="function"><span class="params">: <span class="string">&quot;=r&quot;</span> (out)</span></span></span><br><span class="line"><span class="function"><span class="params">: <span class="string">&quot;M&quot;</span> (TIMER0_MICROS_INC),</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="string">&quot;I&quot;</span> (_SFR_IO_ADDR(TCNT0)),</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="string">&quot;I&quot;</span> (_SFR_IO_ADDR(TIFR0)),</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="string">&quot;I&quot;</span> (TOV0)</span></span></span><br><span class="line"><span class="function"><span class="params">: <span class="string">&quot;r0&quot;</span> )</span></span>; <span class="keyword">return</span> out; &#125;</span><br></pre></td></tr></table></figure><p>在<code>timer0_overflow_count</code>的定义后加入</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> timer0_overflow_count_available_container = timer0_overflow_count;</span><br></pre></td></tr></table></figure><p>即可.</p><h5 id="Kalman-Filter"><a href="#Kalman-Filter" class="headerlink" title="Kalman Filter"></a>Kalman Filter</h5><p>使用积分, 对角速度及加速度进行操作计算倾角, 并使陀螺仪倾角平滑化.<br>reference:</p><p><a href="http://bilgin.esme.org/BitsAndBytes/KalmanFilterforDummies">KalmanFilterforDummies</a></p><p><a href="https://www.intechopen.com/books/introduction-and-implementations-of-the-kalman-filter/introduction-to-kalman-filter-and-its-applications">Introduction to kalman filter and its applications</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getAcce</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> now = millis();</span><br><span class="line">  dt = (now - lastTime) / <span class="number">1000.0</span>;</span><br><span class="line">  lastTime = now;</span><br><span class="line"></span><br><span class="line">  accelgyro.getMotion6(&amp;ax, &amp;ay, &amp;az, &amp;gx, &amp;gy, &amp;gz);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> accx = ax / AcceRatio, accy = ay / AcceRatio, accz = az / AcceRatio;</span><br><span class="line"></span><br><span class="line">  aax = <span class="built_in">atan</span>(accy / accz) * (<span class="number">-180</span>) / pi;</span><br><span class="line">  aay = <span class="built_in">atan</span>(accx / accz) * <span class="number">180</span> / pi;</span><br><span class="line">  aaz = <span class="built_in">atan</span>(accz / accy) * <span class="number">180</span> / pi;</span><br><span class="line"></span><br><span class="line">  aax_sum = aay_sum = aaz_sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>; i ^ n_sample; ++ i) &#123;</span><br><span class="line">    aaxs[i<span class="number">-1</span>] = aaxs[i], aax_sum += aaxs[i] * i;</span><br><span class="line">    aays[i<span class="number">-1</span>] = aays[i], aay_sum += aays[i] * i;</span><br><span class="line">    aazs[i<span class="number">-1</span>] = aazs[i], aaz_sum += aazs[i] * i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  aaxs[n_sample<span class="number">-1</span>] = aax, aax_sum += aax * n_sample, aax = (aax_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line">  aays[n_sample<span class="number">-1</span>] = aay, aay_sum += aay * n_sample, aay = (aay_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line">  aazs[n_sample<span class="number">-1</span>] = aaz, aaz_sum += aaz * n_sample, aaz = (aaz_sum / (<span class="number">11</span> * n_sample / <span class="number">2.0</span>)) * <span class="number">9</span> / <span class="number">7.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">double</span> gyrox = -(gx - gxo) / GyroRatio * dt;</span><br><span class="line">  <span class="keyword">double</span> gyroy = -(gy - gyo) / GyroRatio * dt;</span><br><span class="line">  <span class="keyword">double</span> gyroz = -(gz - gzo) / GyroRatio * dt;</span><br><span class="line">  agx += gyrox, agy += gyroy, agz += gyroz;</span><br><span class="line"></span><br><span class="line">  Sx = Rx = Sy = Ry = Sz = Rz = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i ^ <span class="number">10</span>; ++ i) &#123;</span><br><span class="line">    a_x[i - <span class="number">1</span>] = a_x[i], Sx += a_x[i];</span><br><span class="line">    a_y[i - <span class="number">1</span>] = a_y[i], Sy += a_y[i];</span><br><span class="line">    a_z[i - <span class="number">1</span>] = a_z[i], Sz += a_z[i];</span><br><span class="line">  &#125; a_x[<span class="number">9</span>] = aax, Sx += aax, Sx /= <span class="number">10</span>, a_y[<span class="number">9</span>] = aay, Sy += aay, Sy /= <span class="number">10</span>, a_z[<span class="number">9</span>] = aaz, Sz += aaz, Sz /= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>; i^<span class="number">10</span>; ++ i) Rx += sq(a_x[i] - Sx), Ry += sq(a_y[i] - Sy), Rz += sq(a_z[i] - Sz);</span><br><span class="line"></span><br><span class="line">  Rx = Rx / <span class="number">9</span>, Ry = Ry / <span class="number">9</span>, Rz = Rz / <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">  Px = Px + <span class="number">0.0025</span>, Kx = Px / (Px + Rx), agx = agx + Kx * (aax - agx), Px = (<span class="number">1</span> - Kx) * Px;</span><br><span class="line">  Py = Py + <span class="number">0.0025</span>, Ky = Py / (Py + Ry), agy = agy + Ky * (aay - agy), Py = (<span class="number">1</span> - Ky) * Py;</span><br><span class="line">  Pz = Pz + <span class="number">0.0025</span>, Kz = Pz / (Pz + Rz), agz = agz + Kz * (aaz - agz), Pz = (<span class="number">1</span> - Kz) * Pz;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> ACCELGYRO_SERIAL_OUTPUT</span></span><br><span class="line"></span><br><span class="line">  Serial.print(agx); Serial.print(<span class="string">&quot;,&quot;</span>); Serial.print(agy); Serial.print(<span class="string">&quot;,&quot;</span>); Serial.print(agz);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="SIM800C-供电问题"><a href="#SIM800C-供电问题" class="headerlink" title="SIM800C 供电问题"></a>SIM800C 供电问题</h5><p>众所周知, <code>SIM800C</code>功耗很大, 正常工况功率可以高达$5W$, 搜索网络过程中更是需要$10W$的高功率, 而<code>Arduino</code>的$5V$引脚是提供不了$5V2A$的高功率的. 为了解决这个问题我们使用<code>Li14500</code>电池对电路直接加电, 同时给包括<code>Arduino</code>板在内的所有模块供电. 为了进一步提高电路稳定性, 我们还在电路中加入了四颗当初玩粉尘传感器玩剩下的$220UF$电解电容, 来提升电路瞬间放电能力.</p><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272871126.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272871126.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="220UF50V电解电容"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272565927.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/1606272565927.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="硬件连接"></p>              </div>            </details><h5 id="SIM800C发送HTTP报文"><a href="#SIM800C发送HTTP报文" class="headerlink" title="SIM800C发送HTTP报文"></a>SIM800C发送HTTP报文</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dataUpd</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  SIM.println(<span class="string">&quot;AT\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CGDCONT=1,\&quot;IP\&quot;,\&quot;CMNET\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CGATT=1&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCSGP=1,\&quot;CMNET\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CLPORT=\&quot;TCP\&quot;,\&quot;2000\&quot;\r&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART=\&quot;TCP\&quot;,\&quot;183.230.40.33\&quot;,\&quot;80\&quot;\r&quot;</span>);</span><br><span class="line">  delay(<span class="number">100</span>); SIM.println(<span class="string">&quot;AT+CIPSEND&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">10</span>];</span><br><span class="line">  String jsonToSend = <span class="string">&quot;&#123;\&quot;Logitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Logi, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Latitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Lati, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Altitude\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Alti, <span class="number">1</span>, <span class="number">6</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;,\&quot;Speed\&quot;:&quot;</span>;</span><br><span class="line">  dtostrf(Skmph, <span class="number">1</span>, <span class="number">2</span>, buf);</span><br><span class="line">  jsonToSend += <span class="string">&quot;\&quot;&quot;</span> + String(buf) + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">  jsonToSend += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  String postString = <span class="string">&quot;POST /devices/&quot;</span>;</span><br><span class="line">  postString += DEVICE_ID;</span><br><span class="line">  postString += <span class="string">&quot;/datapoints?type=3 HTTP/1.1&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;api-key:&quot;</span>;</span><br><span class="line">  postString += APIKey;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Host:api.heclouds.com\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Connection:close\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;Content-Length:&quot;</span>;</span><br><span class="line">  postString += jsonToSend.length();</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += jsonToSend;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">  postString += <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *postArray = postString.c_str();</span><br><span class="line">  Serial.println(postArray);</span><br><span class="line"></span><br><span class="line">  SIM.write(postArray); delay(<span class="number">100</span>); SIM.write(<span class="number">0x1A</span>);</span><br><span class="line"></span><br><span class="line">  postArray = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="SIM800C发送短信"><a href="#SIM800C发送短信" class="headerlink" title="SIM800C发送短信"></a>SIM800C发送短信</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">accidentReport</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  ledWrite(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  ledWrite(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  Serial.println (<span class="string">&quot;Accident Report Trigged.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCLOSE\r&quot;</span>); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART\r&quot;</span>); delay(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">  String tmp = <span class="string">&quot;AT+CMGS=\&quot;&quot;</span>; tmp += TEL_NUM; tmp += <span class="string">&quot;\&quot;\n\r&quot;</span>;</span><br><span class="line">  Serial.println(tmp);</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">10</span>];</span><br><span class="line">  SIM.begin(<span class="number">115200</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT\r\n&quot;</span>); delay(<span class="number">100</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CMGF=1\n\r&quot;</span>); delay(<span class="number">500</span>);</span><br><span class="line">  SIM.write(tmp.c_str()); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;It seems to be an accident.&quot;</span>);</span><br><span class="line"></span><br><span class="line">  tmp = <span class="string">&quot;Location: &quot;</span>;</span><br><span class="line">  dtostrf(Lati, <span class="number">1</span>, <span class="number">4</span>, buf);</span><br><span class="line">  tmp += String(buf);</span><br><span class="line">  dtostrf(Logi, <span class="number">1</span>, <span class="number">4</span>, buf);</span><br><span class="line">  tmp += <span class="string">&quot;, &quot;</span> + String(buf)+<span class="string">&quot;\r&quot;</span>;</span><br><span class="line"></span><br><span class="line">  SIM.write(tmp.c_str());</span><br><span class="line">  delay(<span class="number">1000</span>); SIM.write(<span class="number">0x1A</span>);</span><br><span class="line">  delay (<span class="number">10000</span>); ledWrite(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPCLOSE\r&quot;</span>); delay(<span class="number">1000</span>);</span><br><span class="line">  SIM.println(<span class="string">&quot;AT+CIPSTART\r&quot;</span>); delay(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里尤其需要注意和<code>TCP</code>的冲突问题, 这里采用了先断连再重连的实现方式, 但是在实际测试中发现就算不断开连接短信也能够正常发送.</p><h5 id="LED灯控制函数"><a href="#LED灯控制函数" class="headerlink" title="LED灯控制函数"></a>LED灯控制函数</h5><p>很方便的LED灯控制手段.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ledWrite</span> <span class="params">(<span class="keyword">int</span> R, <span class="keyword">int</span> G, <span class="keyword">int</span> B)</span> </span>&#123;</span><br><span class="line">  digitalWrite(LedRed, (<span class="number">255</span>-R)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">  digitalWrite(LedGre, (<span class="number">255</span>-G)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">  digitalWrite(LedBlu, (<span class="number">255</span>-B)&gt;&gt;LED_LITHT_DEC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="红外遥控器编码"><a href="#红外遥控器编码" class="headerlink" title="红外遥控器编码"></a>红外遥控器编码</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rm_encode</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> res)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (res) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF6897</span>: <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//Show Time</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF30CF</span>: <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//Show Longitude &amp; Latitude</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF18E7</span>: <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//Show Speed</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF7A85</span>: <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//Show Acceleration</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF10EF</span>: <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//Show Accelgyro</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF38C7</span>: <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF5AA5</span>: <span class="keyword">return</span> <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF42BD</span>: <span class="keyword">return</span> <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF4AB5</span>: <span class="keyword">return</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF52AD</span>: <span class="keyword">return</span> <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF22DD</span>: <span class="keyword">return</span> <span class="number">1001</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xFF02FD</span>: <span class="keyword">return</span> <span class="number">1002</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="红外遥控信息处理逻辑"><a href="#红外遥控信息处理逻辑" class="headerlink" title="红外遥控信息处理逻辑"></a>红外遥控信息处理逻辑</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nowPosiModify</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> res)</span> </span>&#123;</span><br><span class="line">  rettmp=lcd_rm_encode(res);</span><br><span class="line">  <span class="keyword">if</span> (rettmp != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rettmp&gt;<span class="number">1000</span> &amp;&amp; rettmp&lt;=<span class="number">1100</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        flag=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">switch</span> (rettmp) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1001</span>: &#123;ret = (ret+<span class="number">1</span>)%tot_sta; <span class="keyword">break</span>;&#125;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1002</span>: &#123;ret = --ret&lt;<span class="number">0</span>? ret+tot_sta:ret; <span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> ret=rettmp, flag=<span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  digitalWrite(lcdBackLight, HIGH);</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> LCD_OUTPUT</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (ret) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(Year); lcd.print(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Month&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Month); lcd.print(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Day  &lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Day);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (Hour&lt;<span class="number">10</span>)   lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Hour); lcd.print(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Minute&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Minute); lcd.print(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (Second&lt;<span class="number">10</span>) lcd.print(<span class="string">&quot;0&quot;</span>); lcd.print(Second);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;Logi: &quot;</span>); lcd.print(Logi);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;Lati: &quot;</span>); lcd.print(Lati);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print (<span class="string">&quot;Speed(Kmph): &quot;</span>);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>); lcd.print(Skmph);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">3</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print (<span class="string">&quot;Acceleration:&quot;</span>);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>); lcd.print(Acce);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">case</span> <span class="number">4</span>: &#123;</span><br><span class="line">      lcd.clear(); lcd.setCursor(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;x:&quot;</span>); lcd.print(agx);</span><br><span class="line">      lcd.print(<span class="string">&quot; y:&quot;</span>); lcd.print(agy);</span><br><span class="line">      lcd.setCursor(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">      lcd.print(<span class="string">&quot;z:&quot;</span>); lcd.print(agz);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; rettmp = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line">  <span class="comment">//Serial.print(&quot;ret: &quot;);</span></span><br><span class="line">  <span class="comment">//Serial.print(ret);</span></span><br><span class="line">  <span class="comment">//Serial.print(&quot; tettmp: &quot;);</span></span><br><span class="line">  <span class="comment">//Serial.println(rettmp);</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="事故侦测"><a href="#事故侦测" class="headerlink" title="事故侦测"></a>事故侦测</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> durVal = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">double</span> tmpAgx[durVal], tmpAgy[durVal], tmpAgz[durVal];</span><br><span class="line"><span class="keyword">int</span> pos, totx, toty, totz;</span><br><span class="line"><span class="keyword">double</span> avgx, avgy, avgz;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">isRotate</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  getAcce(); <span class="keyword">register</span> <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">register</span> <span class="keyword">double</span> acce = <span class="built_in">sqrt</span>(accx*accx + accy*accy + accz*accz);</span><br><span class="line">  </span><br><span class="line">  flag = acce&gt;=ACCIDENT_ACCE;</span><br><span class="line">  <span class="keyword">if</span> (Abs(agx-avgx)&gt;ACCIDENT_ANGLE || Abs(agy-avgy)&gt;ACCIDENT_ANGLE || Abs(agz-avgz)&gt;ACCIDENT_ANGLE) flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  totx -= tmpAgx[pos], toty -= tmpAgy[pos], totz -= tmpAgz[pos];</span><br><span class="line">  tmpAgx[pos] = agx, tmpAgy[pos]= agy, tmpAgz[pos] = agz;</span><br><span class="line">  totx += agx, toty += agy, totz += agz;</span><br><span class="line">  avgx = <span class="number">1.0</span>*totx/(<span class="number">1.0</span>*durVal), avgy = <span class="number">1.0</span>*toty/(<span class="number">1.0</span>*durVal), avgz = <span class="number">1.0</span>*totz/(<span class="number">1.0</span>*durVal);</span><br><span class="line">  pos = (pos+<span class="number">1</span>)%durVal;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (accidentMonitor.check()) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isRotate() &amp;&amp; Skmph&gt;=ACCIDENT_ALERT_SPEED) accidentReport();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用循环数组存储$30$个运行周期中三维陀螺仪的倾角信息, 通过更新循环数组求$30$个运行周期中的三维倾角平均值.</p><p><code>acce</code>为三维加速度的等效值.</p><p>报警条件: 等效加速度大小大于阈值<code>ACCIDENT_ ACCE</code>, 并且三个方向上的倾角只要有一个倾角相对于$30$个运行周期中的平均值的差的绝对值大于阈值<code>ACCIDENT_ANGEL</code>, 并且当前<code>GPS</code>速度大于阈值<code>ACCIDENT_ALERT_SPEED</code>, 即可触发报警.</p><p>需要注意的一点: <code>if</code>语句中各个判断条件从左向右计算, 如果发现在某种情况下判断结果已经可以确定, 其余的部分将不会被计算. 为了能够保证维护的循环数组的连续性, 我们牺牲了部分低速或静息状态下的续航和性能, 保证<code>isRotate()</code>在每一个程序周期中都会被调用.</p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201127_232804.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201127_232804.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="事故报警"></p><h5 id="Bad-Attempt-向-Arduino-UNO-移植"><a href="#Bad-Attempt-向-Arduino-UNO-移植" class="headerlink" title="[Bad Attempt] 向 Arduino  UNO 移植"></a>[<strong><font color=red>Bad Attempt</font></strong>] 向 <code>Arduino  UNO</code> 移植</h5><p>想要做<code>Arduino</code>最小系统进一步减小体积, 后来发现有各种问题, 故终止.</p><p>失败原因: <code>ATMEGA328PU</code>性能太差, <code>RAM</code>太小, 实现功能要用到的动态存储空间太大.</p><p>下文简单介绍一下挣扎时用到的一些可能有用的操作.</p><h6 id="减小RAM占用"><a href="#减小RAM占用" class="headerlink" title="减小RAM占用"></a><strong>减小<code>RAM</code>占用</strong></h6><p><code>ATMEGA2560</code>足足有<code>8K</code>的<code>SRAM</code>, 但<code>ATMEGA328PU</code>只有<code>2K</code>, 我当场炸内存.</p><p><del>学OI那阵子松松松都是松时间, 从来不用担心<code>MLE</code>, 上了带学连空间都要松松松, 这就是当代带学生吗 (雾</del></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/uno/ramcrash.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/uno/ramcrash.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="炸内存之惨状"></p><p>解决方案:</p><ol><li>将静态变量内容存入<code>Flash</code>.</li></ol><p>在静态变量前面加<code>PROGMEM</code>修饰, 可以将静态变量存入<code>Flash</code>, 以减少<code>RAM</code>占用.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROGMEM <span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="number">3.1415926</span>, AcceRatio = <span class="number">16384.0</span>, GyroRatio = <span class="number">131.0</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li>将字符串常量存入<code>Flash</code>.</li></ol><p>字符串常量通常被存入静态内存区, 将其用<code>F()</code>修饰可以将其存入<code>Flash</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SIM.println(F(<span class="string">&quot;AT+CIPCSGP=1,\&quot;CMNET\&quot;\r&quot;</span>)); sleep(<span class="number">100</span>);</span><br><span class="line">SIM.println(F(<span class="string">&quot;AT+CLPORT=\&quot;TCP\&quot;,\&quot;2000\&quot;\r&quot;</span>)); sleep(<span class="number">500</span>);</span><br><span class="line">SIM.println(F(<span class="string">&quot;AT+CIPSTART=\&quot;TCP\&quot;,\&quot;183.230.40.33\&quot;,\&quot;80\&quot;\r&quot;</span>));</span><br></pre></td></tr></table></figure><h6 id="烧写bootloader"><a href="#烧写bootloader" class="headerlink" title="烧写bootloader"></a><strong>烧写<code>bootloader</code></strong></h6><p>有几次炸内存之后<code>Arduino</code>板工作不正常, 甚至无法正常烧录程序, 抱着尝试的心态重新烧写引导程序, 它奇迹般地复活了.</p><ol start="0"><li>硬件连接(常用)</li></ol><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/MegaToUNO.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/MegaToUNO.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Mega to UNO"></p><blockquote><p>The <code>10µF</code> electrolytic capacitor connected to <code>RESET</code> and <code>GND</code> of the programming board is needed <code>only</code> for the boards that have an interface between the microcontroller and the computer’s USB, like Mega, Uno, Mini, Nano. Boards like Leonardo, Esplora and Micro, with the USB directly managed by the microcontroller, don’t need the capacitor.</p></blockquote><p>实际用<code>Mega</code>测试的时候发现电容不加也行. (笑</p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/ArduinoUNOtoUNO_ISP2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/ArduinoUNOtoUNO_ISP2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="UNO to UNO"></p><ol><li>在工具栏 <code>工具</code>-&gt;<code>开发板</code> 中选择<code>PROGRAMMER</code>的正确开发板型号及处理器型号.</li><li>在工具栏 <code>工具</code>-&gt;<code>编程器</code> 中选择<code>AVRISP</code>编程器.</li></ol><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>在工具栏 <code>文件</code>-&gt;<code>示例</code>-&gt;<code>ArduinoISP</code> 中打开<code>ArduinoISP</code>例程, 编译并烧录到<code>PROGRAMMER</code>中.</li></ol><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="4"><li>在工具栏 <code>工具</code>-&gt;<code>开发板</code> 中选择<code>TARGET</code>的正确开发板型号和处理器型号.</li><li>在工具栏 <code>工具</code>-&gt;<code>编程器</code> 中选择<code>Arduino as ISP</code>, 并点击下方的<code>烧录引导程序</code>. 等待即可.</li></ol><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/bootloader/btl3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>更多内容详见官网相关文档<a href="https://www.arduino.cc/en/Tutorial/BuiltInExamples/ArduinoISP">ArduinoISP</a>.</p><h4 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h4><div class="note warning red"><p>由于微信小程序部分码量巨大 且只有定位功能是我们项目的核心功能 本Wiki中关于微信小程序将只针对于定位页面进行讲解 账号授权 新建活动 活动报名 资讯 相册 添加新设备等附属功能请自行查看代码.</p></div><h5 id="WG-84-to-GCJ-02-坐标转换"><a href="#WG-84-to-GCJ-02-坐标转换" class="headerlink" title="WG-84 to GCJ-02 坐标转换"></a>WG-84 to GCJ-02 坐标转换</h5><p>首先参考 <a href="https://www.cnblogs.com/langzou/p/10402501.html">GCJ-02火星坐标系和WGS-84坐标系转换关系</a>, 得:</p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后参考 <a href="https://www.zhihu.com/question/55648210">已知不可逆的坐标转换算法，通过结果进行反算的方法</a> 进行坐标逆变换.</p><p>我们只能先认为 <code>WGS-84</code> 转到 <code>GCJ-02</code> 的精确公式是存在的，这是我们做 <code>GCJ-02</code> 到 <code>WGS-84</code> 公式逆变换的前提，否则我们或许只能黑箱操作。经过一番操作，我们凑巧得出如下公式：</p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84togcj02.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/wg84togcj02.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在小程序中进行处理后, 在传入坐标精度为6位小数即可一定程度上保证坐标精准度.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wgs84togcj02 = <span class="function"><span class="keyword">function</span>(<span class="params">lat, log</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//is position off China mainland</span></span><br><span class="line">  <span class="keyword">if</span> (log &lt; <span class="number">72.004</span> || log &gt; <span class="number">137.8347</span> || lat &lt; <span class="number">0.8293</span> || lat &gt; <span class="number">55.8271</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      latitude: lat,</span><br><span class="line">      longitude: log,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> Pi = <span class="number">3.14159265358979324</span>;</span><br><span class="line">    <span class="comment">//coordinate projection factor</span></span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">6378245.0</span>;</span><br><span class="line">    <span class="comment">//eccentricity</span></span><br><span class="line">    <span class="keyword">const</span> ee = <span class="number">0.00669342162296594323</span>;</span><br><span class="line">    <span class="comment">//All Hail ELLIAS</span></span><br><span class="line">    <span class="keyword">var</span> transformLat = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret = <span class="number">-100.0</span> + <span class="number">2.0</span> * x + <span class="number">3.0</span> * y + <span class="number">0.2</span> * y * y + <span class="number">0.1</span> * x * y + <span class="number">0.2</span> * <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.abs(x));</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">6.0</span> * x * Pi) + <span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">2.0</span> * x * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(y * Pi) + <span class="number">40.0</span> * <span class="built_in">Math</span>.sin(y / <span class="number">3.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">160.0</span> * <span class="built_in">Math</span>.sin(y / <span class="number">12.0</span> * Pi) + <span class="number">320</span> * <span class="built_in">Math</span>.sin(y * Pi / <span class="number">30.0</span>)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      <span class="keyword">return</span> ret; &#125;</span><br><span class="line">    <span class="keyword">var</span> transformLog = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ret = <span class="number">300.0</span> + x + <span class="number">2.0</span> * y + <span class="number">0.1</span> * x * x + <span class="number">0.1</span> * x * y + <span class="number">0.1</span> * <span class="built_in">Math</span>.sqrt(<span class="built_in">Math</span>.abs(x));</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">6.0</span> * x * Pi) + <span class="number">20.0</span> * <span class="built_in">Math</span>.sin(<span class="number">2.0</span> * x * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">20.0</span> * <span class="built_in">Math</span>.sin(x * Pi) + <span class="number">40.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">3.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      ret += (<span class="number">150.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">12.0</span> * Pi) + <span class="number">300.0</span> * <span class="built_in">Math</span>.sin(x / <span class="number">30.0</span> * Pi)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">      <span class="keyword">return</span> ret; &#125;</span><br><span class="line">    <span class="keyword">var</span> delta = <span class="function"><span class="keyword">function</span> (<span class="params">lat, lon</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> dLat = transformLat(lon - <span class="number">105.0</span>, lat - <span class="number">35.0</span>);</span><br><span class="line">      <span class="keyword">var</span> dLon = transformLog(lon - <span class="number">105.0</span>, lat - <span class="number">35.0</span>);</span><br><span class="line">      <span class="keyword">var</span> radLat = lat / <span class="number">180.0</span> * Pi;</span><br><span class="line">      <span class="keyword">var</span> magic = <span class="built_in">Math</span>.sin(radLat);</span><br><span class="line">      magic = <span class="number">1</span> - ee * magic * magic;</span><br><span class="line">      <span class="keyword">var</span> sqrtMagic = <span class="built_in">Math</span>.sqrt(magic);</span><br><span class="line">      dLat = (dLat * <span class="number">180.0</span>) / ((a * (<span class="number">1</span> - ee)) / (magic * sqrtMagic) * Pi);</span><br><span class="line">      dLon = (dLon * <span class="number">180.0</span>) / (a / sqrtMagic * <span class="built_in">Math</span>.cos(radLat) * Pi);</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="string">&#x27;lat&#x27;</span>: dLat, <span class="string">&#x27;lon&#x27;</span>: dLon&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> d = delta(lat, log);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      latitude:  lat + d.lat,</span><br><span class="line">      longitude: log + d.lon,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="数据实时刷新"><a href="#数据实时刷新" class="headerlink" title="数据实时刷新"></a>数据实时刷新</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//location data getter timer</span></span><br><span class="line">timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.get_datapoints().then(<span class="function"><span class="params">datapoints</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure><div class="note warning red"><p><code>event</code>到期后<code>timer</code>将会停止工作.</p></div><h5 id="获取当前event"><a href="#获取当前event" class="headerlink" title="获取当前event"></a>获取当前event</h5><div class="note info"><p>本项目中将不同的使用节次虚拟化为不同的event.</p></div><p>只有在<code>event</code>中<code>register</code>才有权限上传图片.</p><p>只能在<code>event</code>开始前12h到<code>event</code>结束后1天的时间范围内上传图片. 如果event结束, <code>timer</code>也不会再更新.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get the corresponded event</span></span><br><span class="line"><span class="keyword">var</span> event = app.globalData.event;</span><br><span class="line"><span class="keyword">var</span> participants = event.participants;</span><br><span class="line"><span class="keyword">var</span> is_signed = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; participants.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (app.globalData.user.openid == participants[i].openid) &#123;</span><br><span class="line">    <span class="comment">//matching current user</span></span><br><span class="line">    <span class="comment">//check whether the event is expired, -12h to 1d</span></span><br><span class="line">    <span class="keyword">var</span> can_upload = ((((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &gt;= <span class="number">1</span>) || (((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &lt;= <span class="number">-0.5</span>)) ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//fill the basic event name info and decide whether the uploader should be shown or not</span></span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      event: event,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + event.name + <span class="string">&quot;的全部图片&quot;</span>,</span><br><span class="line">      is_uploader_hide: !can_upload,</span><br><span class="line">      tip_footer: <span class="string">&quot;请在活动开始前12小时到活动结束后1天内上传图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (((<span class="built_in">Date</span>.now() - event.precise_time) / <span class="number">86400000</span>) &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        tip_footer: <span class="string">&quot;活动已结束&quot;</span>,</span><br><span class="line">        is_dynamic_data_hide: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//event expired, clear interval</span></span><br><span class="line">    &#125;</span><br><span class="line">    is_signed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//cannot upload if unsigned</span></span><br><span class="line">  <span class="keyword">if</span> (!is_signed) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      event: event,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + event.name + <span class="string">&quot;的全部图片&quot;</span>,</span><br><span class="line">      is_uploader_hide: <span class="literal">true</span>,</span><br><span class="line">      tip_footer: <span class="string">&quot;未报名活动，无法上传图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="从数据库中获取当前event所对应的图片表"><a href="#从数据库中获取当前event所对应的图片表" class="headerlink" title="从数据库中获取当前event所对应的图片表"></a>从数据库中获取当前event所对应的图片表</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">db.collection(<span class="string">&quot;events&quot;</span>).where(&#123;</span><br><span class="line">      _id: event._id</span><br><span class="line">    &#125;).field(&#123;</span><br><span class="line">      _id: <span class="literal">true</span>,</span><br><span class="line">      snapshots: <span class="literal">true</span></span><br><span class="line">    &#125;).get(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//all shots taken in the event</span></span><br><span class="line">        <span class="keyword">var</span> snapshots = res.data[<span class="number">0</span>].snapshots</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          event_id: res.data[<span class="number">0</span>]._id,</span><br><span class="line">          event_shots: snapshots</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> markers = [];</span><br><span class="line">        markers[<span class="number">0</span>] = &#123;</span><br><span class="line">          id: <span class="number">0</span>,</span><br><span class="line">          latitude: that.data.latitude,</span><br><span class="line">          longitude: that.data.longitude,</span><br><span class="line">          width: <span class="number">20</span>,</span><br><span class="line">          height: <span class="number">20</span>,</span><br><span class="line">          iconPath: <span class="string">&quot;image/star.png&quot;</span>,</span><br><span class="line">          callout: &#123;</span><br><span class="line">            content: that.data.event.device.name + <span class="string">&quot;：&quot;</span> + that.data.event.device.deviceid,</span><br><span class="line">            bgColor: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">            padding: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderRadius: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderWidth: <span class="string">&quot;1px&quot;</span>,</span><br><span class="line">            borderColor: <span class="string">&quot;#1296DB&quot;</span>,</span><br><span class="line">            display: <span class="string">&quot;BYCLICK&quot;</span>,</span><br><span class="line">            fontSize: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          is_snapshot: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; snapshots.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> snapshot = snapshots[i];</span><br><span class="line">          <span class="keyword">var</span> marker = &#123;&#125;;</span><br><span class="line">          <span class="comment">//geopoint need to be transformed to json</span></span><br><span class="line">          <span class="keyword">var</span> location = snapshot.location.toJSON().coordinates;</span><br><span class="line">          marker.id = i + <span class="number">1</span>;</span><br><span class="line">          marker.location = snapshot.location;</span><br><span class="line">          marker.longitude = location[<span class="number">0</span>];</span><br><span class="line">          marker.latitude = location[<span class="number">1</span>];</span><br><span class="line">          marker.openid = snapshot.openid;</span><br><span class="line">          marker.name = snapshot.name;</span><br><span class="line">          marker.avatar = snapshot.avatar;</span><br><span class="line">          marker.nickname = snapshot.nickname;</span><br><span class="line">          marker.realname = snapshot.realname;</span><br><span class="line">          marker.taker = snapshot.nickname + <span class="string">&quot; (&quot;</span> + snapshot.realname + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">          marker.detail = snapshot.detail;</span><br><span class="line">          marker.iconPath = <span class="string">&quot;image/imagepoint.png&quot;</span>;</span><br><span class="line">          marker.url = snapshot.url;</span><br><span class="line">          marker.width = <span class="number">20</span>;</span><br><span class="line">          marker.height = <span class="number">20</span>;</span><br><span class="line">          marker.callout = &#123;</span><br><span class="line">            content: snapshot.detail,</span><br><span class="line">            bgColor: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">            padding: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderRadius: <span class="string">&quot;5px&quot;</span>,</span><br><span class="line">            borderWidth: <span class="string">&quot;1px&quot;</span>,</span><br><span class="line">            borderColor: <span class="string">&quot;#1485EF&quot;</span>,</span><br><span class="line">            display: <span class="string">&quot;ALWAYS&quot;</span>,</span><br><span class="line">            fontSize: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">          marker.is_snapshot = <span class="literal">true</span>;</span><br><span class="line">          markers.push(marker);</span><br><span class="line">          <span class="comment">//deviation, prevent markers from overlapping</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; markers.length; i++) &#123;</span><br><span class="line">          <span class="keyword">var</span> marker = markers[i];</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; markers.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (markers[j].location == marker.location) &#123;</span><br><span class="line">              markers[j].longitude += i * <span class="number">0.0002</span>;</span><br><span class="line">              markers[j].latitude += i * <span class="number">0.0002</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(markers);</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          markers: markers</span><br><span class="line">        &#125;)</span><br><span class="line">        wx.hideLoading(&#123;</span><br><span class="line">          complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>当前定位点和图片定位点都需要用<code>markers[]</code>盛放, 为了避免渲染冲突, 我们将当前定位点存在<code>markers[0]</code>中, 并对其单独赋值.</p><p>如果有坐标相同的定位点, 为了防止它们重合, 这里单独做了特判, 将每一对中重合的标记点其中的一个平移.</p><h5 id="从oneNet获取设备信息"><a href="#从oneNet获取设备信息" class="headerlink" title="从oneNet获取设备信息"></a>从oneNet获取设备信息</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get gps datapoints</span></span><br><span class="line">get_datapoints: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: <span class="string">`https://api.heclouds.com/devices/<span class="subst">$&#123;that.data.event.device.deviceid&#125;</span>/datapoints?datastream_id=Latitude,Logitude,Speed&amp;limit=1`</span>,</span><br><span class="line">      header: &#123;</span><br><span class="line">        <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;api-key&#x27;</span>: that.data.event.device.apikey</span><br><span class="line">      &#125;,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> status = res.statusCode;</span><br><span class="line">        <span class="keyword">const</span> response = res.data;</span><br><span class="line">        <span class="keyword">var</span> speed = response.data.datastreams[<span class="number">0</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> longitude = response.data.datastreams[<span class="number">1</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> latitude = response.data.datastreams[<span class="number">2</span>].datapoints;</span><br><span class="line">        <span class="keyword">var</span> current_sp = <span class="built_in">Number</span>(speed[speed.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="keyword">var</span> current_lo = <span class="built_in">Number</span>(longitude[longitude.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="keyword">var</span> current_la = <span class="built_in">Number</span>(latitude[latitude.length - <span class="number">1</span>].value);</span><br><span class="line">        <span class="comment">//encrypt to gcj to fit Tencent map</span></span><br><span class="line">        <span class="keyword">const</span> encrypt_res = wgs84togcj02(current_la, current_lo);</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          speed: current_sp,</span><br><span class="line">          longitude: encrypt_res.longitude,</span><br><span class="line">          latitude: encrypt_res.latitude,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][speed]: &quot;</span> + that.data.speed);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][latitude]: &quot;</span> + that.data.latitude);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;[onenet][longitude]: &quot;</span> + that.data.longitude);</span><br><span class="line">        <span class="keyword">if</span> (status !== <span class="number">200</span>) &#123;</span><br><span class="line">          reject(res.data)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (response.errno !== <span class="number">0</span>) &#123;</span><br><span class="line">          reject(response.error)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (response.data.datastreams.length === <span class="number">0</span>) &#123;</span><br><span class="line">          reject(<span class="string">&quot;No data yet.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        resolve(&#123;&#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>使用<code>Promise</code>取消异步.</p><h5 id="在地图上点击图片点"><a href="#在地图上点击图片点" class="headerlink" title="在地图上点击图片点"></a>在地图上点击图片点</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//marker tapped</span></span><br><span class="line">show_snapshots: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id = e.detail.markerId;</span><br><span class="line">  <span class="keyword">var</span> markers = <span class="built_in">this</span>.data.markers;</span><br><span class="line">  <span class="keyword">if</span> (id == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">this</span>.data.markers.length; i++) &#123;</span><br><span class="line">    markers[i].iconPath = <span class="string">&quot;image/imagepoint.png&quot;</span>;</span><br><span class="line">    markers[i].callout.borderColor = <span class="string">&quot;#1485EF&quot;</span>;</span><br><span class="line">    <span class="comment">//change imagepoint to red</span></span><br><span class="line">    <span class="keyword">if</span> (i == id) &#123;</span><br><span class="line">      markers[i].iconPath = <span class="string">&quot;image/imagepoint_selected.png&quot;</span>;</span><br><span class="line">      markers[i].callout.borderColor = <span class="string">&quot;#EF2914&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> current_marker = markers[id];</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    markers: markers,</span><br><span class="line">    current_marker: current_marker,</span><br><span class="line">    is_image_previewer_hide: <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="显示所有图片"><a href="#显示所有图片" class="headerlink" title="显示所有图片"></a>显示所有图片</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//show all tab tapped</span></span><br><span class="line">show_all_snapshots: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//no snapshot</span></span><br><span class="line">  <span class="keyword">var</span> event = <span class="built_in">this</span>.data.event;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.event.snapshots_count) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;暂无图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//has snapshots</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.data.is_all_Hide) &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      is_all_Hide: <span class="literal">false</span>,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;收起&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      is_all_Hide: <span class="literal">true</span>,</span><br><span class="line">      all_snapshots_tip: <span class="string">&quot;查看&quot;</span> + <span class="built_in">this</span>.data.event.name + <span class="string">&quot;全部图片&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="选择上传位点"><a href="#选择上传位点" class="headerlink" title="选择上传位点"></a>选择上传位点</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">choose_location: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    wx.chooseLocation(&#123;</span><br><span class="line">      latitude: that.data.latitude,</span><br><span class="line">      longitude: that.data.longitude,</span><br><span class="line">      complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!res.name) &#123;</span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            tip: <span class="string">&quot;未选中位置，点我重新选择&quot;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">            tip: res.name</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.avatar = app.globalData.user.avatar;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.openid = app.globalData.user.openid;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.nickname = app.globalData.user.nickname;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.realname = app.globalData.user.realname;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.name = res.name;</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.location = db.Geo.Point(res.longitude, res.latitude);</span><br><span class="line">        <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="built_in">this</span>.data.snapshots.time = d.getTime();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.data.detail) &#123;</span><br><span class="line">          <span class="built_in">this</span>.data.snapshots.detail = <span class="built_in">this</span>.data.detail;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.data.snapshots.detail = <span class="string">&quot;暂无描述&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h5 id="选择要上传的图片"><a href="#选择要上传的图片" class="headerlink" title="选择要上传的图片"></a>选择要上传的图片</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//the rider choose an image from snapshots just taken</span></span><br><span class="line">choose_image: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.data.files.length &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: <span class="string">&#x27;每位用户单个地点最多上传一张图片&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  wx.chooseImage(&#123;</span><br><span class="line">    <span class="comment">//choose compressd image to get faster upload and save data</span></span><br><span class="line">    sizeType: [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>],</span><br><span class="line">    count: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//take a snapshot or choose a photo</span></span><br><span class="line">    sourceType: [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>],</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//check the size of the image</span></span><br><span class="line">      <span class="keyword">var</span> maxsize = <span class="number">4000000</span>;</span><br><span class="line">      <span class="keyword">if</span> (res.tempFiles[<span class="number">0</span>].size &gt; maxsize) &#123;</span><br><span class="line">        <span class="keyword">var</span> original_size = (res.tempFiles[<span class="number">0</span>].size / <span class="number">1000000</span>).toFixed(<span class="number">2</span>);</span><br><span class="line">        wx.showToast(&#123;</span><br><span class="line">          title: <span class="string">&#x27;图片过大(&#x27;</span> + original_size + <span class="string">&#x27;MB&#x27;</span> + <span class="string">&#x27;)，请取消勾选&quot;原图&quot;或另行上传较小的图片&#x27;</span>,</span><br><span class="line">          icon: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//return file path and attach to page data filepath array</span></span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        files: that.data.files.concat(res.tempFilePaths),</span><br><span class="line">        is_upload_add_hide: <span class="literal">true</span>,</span><br><span class="line">        tip_second: <span class="string">&quot;长按图片删除&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="built_in">this</span>.choose_location();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>经过测试, 如果图片大小超过<code>4Mib</code>可能会造成微信闪退, 故加入了图片大小检测, 以提升系统的健壮性.</p><h5 id="上传图片和备注"><a href="#上传图片和备注" class="headerlink" title="上传图片和备注"></a>上传图片和备注</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//upload image with location and detail</span></span><br><span class="line">upload_images: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">  <span class="comment">//check if the user is uploading another snapshot to the same point</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.data.markers.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> marker = <span class="built_in">this</span>.data.markers[i];</span><br><span class="line">    <span class="keyword">if</span> (marker.openid == app.globalData.openid &amp;&amp; marker.name == <span class="built_in">this</span>.data.snapshots.name) &#123;</span><br><span class="line">      wx.showToast(&#123;</span><br><span class="line">        icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        title: <span class="string">&#x27;每位用户单个地点最多上传一张图片&#x27;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//check if the location is specified</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.snapshots.name) &#123;</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      icon: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">      title: <span class="string">&#x27;未选择位置&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//check if the detail of snapshot is provided</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.data.detail) &#123;</span><br><span class="line">    wx.showModal(&#123;</span><br><span class="line">      title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      content: <span class="string">&#x27;是否填写图片备注？&#x27;</span>,</span><br><span class="line">      cancelColor: <span class="string">&#x27;gray&#x27;</span>,</span><br><span class="line">      cancelText: <span class="string">&#x27;否&#x27;</span>,</span><br><span class="line">      confirmText: <span class="string">&#x27;是&#x27;</span>,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.cancel) &#123;</span><br><span class="line">          wx.showModal(&#123;</span><br><span class="line">            title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">            content: <span class="string">&#x27;确认上传该照片到&#x27;</span> + that.data.snapshots.name + <span class="string">&quot;？&quot;</span>,</span><br><span class="line">            cancelText: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">            confirmText: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                that.upload_image_final();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    wx.showModal(&#123;</span><br><span class="line">      title: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      content: <span class="string">&#x27;确认上传该照片到&#x27;</span> + that.data.snapshots.name + <span class="string">&quot;？&quot;</span>,</span><br><span class="line">      cancelText: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">      confirmText: <span class="string">&#x27;确认&#x27;</span>,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          that.upload_image_final();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="上传数据"><a href="#上传数据" class="headerlink" title="上传数据"></a>上传数据</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">upload_image_final: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    wx.showNavigationBarLoading(&#123;</span><br><span class="line">      complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: <span class="string">&#x27;图片上传中&#x27;</span>,</span><br><span class="line">      icon: <span class="string">&#x27;loading&#x27;</span>,</span><br><span class="line">      duration: <span class="number">5000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">const</span> filePath = that.data.files[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">//const filePath = files[i];</span></span><br><span class="line">    <span class="comment">//use this when uploading mutiple details</span></span><br><span class="line">    <span class="keyword">const</span> cloudPath = <span class="string">`events/<span class="subst">$&#123;that.data.event.name&#125;</span>/<span class="subst">$&#123;app.globalData.user.nickname&#125;</span>/<span class="subst">$&#123;app.globalData.openid&#125;</span>_<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>_<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;filePath.match(<span class="regexp">/\.(\w+)$/</span>)[<span class="number">1</span>]&#125;</span>`</span>;</span><br><span class="line">    wx.cloud.uploadFile(&#123;</span><br><span class="line">      cloudPath,</span><br><span class="line">      filePath,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        files_cloud_url = res.fileID;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          files_cloud_url: files_cloud_url</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> snapshots = that.data.snapshots;</span><br><span class="line">        <span class="comment">//regenerate detail</span></span><br><span class="line">        <span class="keyword">if</span> (that.data.detail != <span class="string">&quot;暂无描述&quot;</span> &amp;&amp; that.data.detail != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">          snapshots.detail = that.data.detail;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          snapshots.detail = <span class="string">&quot;暂无描述&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(snapshots);</span><br><span class="line">        <span class="comment">//add url field</span></span><br><span class="line">        snapshots.url = that.data.files_cloud_url;</span><br><span class="line">        <span class="keyword">var</span> e = that.data.event_shots;</span><br><span class="line">        e.push(snapshots);</span><br><span class="line">        <span class="keyword">var</span> snapshots_count = e.length;</span><br><span class="line">        that.setData(&#123;</span><br><span class="line">          event_shots: e</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(that.data.event_shots);</span><br><span class="line">        wx.cloud.callFunction(&#123;</span><br><span class="line">          name: <span class="string">&#x27;update_snapshots_count&#x27;</span>,</span><br><span class="line">          data: &#123;</span><br><span class="line">            taskId: that.data.event_id.toString(),</span><br><span class="line">            my_snapshot_count: snapshots_count</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        wx.cloud.callFunction(&#123;</span><br><span class="line">          name: <span class="string">&#x27;update_snapshots&#x27;</span>,</span><br><span class="line">          data: &#123;</span><br><span class="line">            taskId: that.data.event_id.toString(),</span><br><span class="line">            my_snapshot: that.data.event_shots,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          wx.hideNavigationBarLoading(&#123;</span><br><span class="line">            complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">          wx.showToast(&#123;</span><br><span class="line">            title: <span class="string">&#x27;上传成功&#x27;</span>,</span><br><span class="line">            duration: <span class="number">3000</span>,</span><br><span class="line">            success(res) &#123;</span><br><span class="line">              wx.pageScrollTo(&#123;</span><br><span class="line">                scrollTop: <span class="number">0</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="built_in">setTimeout</span>(that.onLoad, <span class="number">3000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="项目展示"><a href="#项目展示" class="headerlink" title="项目展示"></a>项目展示</h3><ul><li>Arduino代码: <a href="https://github.com/novaELLIAS/HongYanAsstHardware">HongYanAsstHardware</a></li><li>微信小程序代码: <a href="https://github.com/TheWayForward/HongyanAsst.">HongyanAsst.</a></li><li>微信小程序在线展示:<img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/gh_c7de51796504_3441.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.1/img/HYAH/gh_c7de51796504_3441.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="100" height = "100" alt="QRcode" align=center /></li><li>宣传视频: (暂无)</li></ul><h3 id="团队进度"><a href="#团队进度" class="headerlink" title="团队进度"></a>团队进度</h3><h4 id="开发进度"><a href="#开发进度" class="headerlink" title="开发进度"></a>开发进度</h4><table><thead><tr><th>项目</th><th>开发进度</th><th>迭代进度</th></tr></thead><tbody><tr><td>Arduino</td><td><font color=green><strong>100%</strong></font></td><td><font color=green><strong>100%</strong></font></td></tr><tr><td>微信小程序</td><td><font color=green><strong>100%</strong></font></td><td><font color=green><strong>100%</strong></font></td></tr></tbody></table><h4 id="组员进度"><a href="#组员进度" class="headerlink" title="组员进度"></a>组员进度</h4><table><thead><tr><th>成员</th><th>团队分工</th><th>开发进度</th><th>贡献率</th></tr></thead><tbody><tr><td>ElliasK</td><td>所有模块的初始开发、迭代开发和调试</td><td><strong>100%</strong></td><td><strong>90%</strong></td></tr><tr><td>Picaloe</td><td>设备调试协力、影视协力、文案协力</td><td><strong>90%</strong></td><td><strong>10%</strong></td></tr></tbody></table><h4 id="统计数据"><a href="#统计数据" class="headerlink" title="统计数据"></a>统计数据</h4><h5 id="硬件端"><a href="#硬件端" class="headerlink" title="硬件端"></a>硬件端</h5><p><img src="https://img.shields.io/github/repo-size/novaELLIAS/HongYanAsstHardware?label=repo size" class="lazyload" data-srcset="https://img.shields.io/github/repo-size/novaELLIAS/HongYanAsstHardware?label=repo size" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub repo size" /> <img src="https://img.shields.io/github/commit-activity/m/novaELLIAS/HongYanAsstHardware" class="lazyload" data-srcset="https://img.shields.io/github/commit-activity/m/novaELLIAS/HongYanAsstHardware" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub commit activity" /></p><h5 id="软件端"><a href="#软件端" class="headerlink" title="软件端"></a>软件端</h5><p><img src="https://img.shields.io/github/repo-size/TheWayForward/HongyanAsst.?label=repo size" class="lazyload" data-srcset="https://img.shields.io/github/repo-size/TheWayForward/HongyanAsst.?label=repo size" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub repo size" /> <img src="https://img.shields.io/github/commit-activity/m/TheWayForward/HongyanAsst." class="lazyload" data-srcset="https://img.shields.io/github/commit-activity/m/TheWayForward/HongyanAsst." srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GitHub commit activity" /></p><h4 id="调试日志"><a href="#调试日志" class="headerlink" title="调试日志"></a>调试日志</h4><div class="timenode"><div class="meta"><p><p>2020/11/16 校内 户外调试</p></p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>GPS</code>精度测试</td><td><font color=green><strong>通过(WG-84标准)</strong></font></td></tr><tr><td>基于模拟退火的<code>WG-84</code>转<code>GCJ-02</code>黑箱算法验证</td><td><font color=orange><strong>通过, 但效率不高</strong></font></td></tr><tr><td>基础便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案)</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td><code>ESP8266</code>通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr></tbody></table></div></div><div class="timenode"><div class="meta"><p><p>2020/11/20 居庸关 长途奔袭调试</p></p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>移动中通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>高速便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_132321.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_132321.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="发车前"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151747.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151747.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151832.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.13/img/HYAH/20201120_151832.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"></p>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>2020/11/22 蟒山 户外调试</p></p></div><div class="body"><p>机型: <code>v0.0-pre</code> 原型机前体 <code>HYAsst THE ORIGIN de pre-release</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>移动中通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>高速便携性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试</td><td><font color=red><strong>未通过, 有杜邦线松动</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案) <strong>(二周目)</strong></td><td><font color=orange><strong>检测到的死机一次, 原因不明</strong></font></td></tr><tr><td>骑行中陀螺仪数据采集</td><td><font color=green><strong>success</strong></font></td></tr></tbody></table><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/mmexport1606278218069.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/mmexport1606278218069.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="蟒山脚下合照"></p>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>2020/11/25-27 寝室 室内续航测试</p></p></div><div class="body"><p>机型: <code>v0.1</code> 初代机 <code>ASKR YGGDRASILLS</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>ESP8266</code>方案续航测试 (900mAh)</td><td><font color=green><strong>113min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 (<code>ESP8266</code>方案) <strong>(三周目)</strong></td><td><font color=red><strong>检测到的死机一次, 原因为<code>ESP8266</code>的<code>TCP</code>释放失败</strong></font></td></tr><tr><td><code>SIM800C</code>方案续航测试 (900mAh)</td><td><font color=green><strong>185min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 (<code>SIM800C</code>方案)</td><td><font color=red><strong>在进行<code>TCP</code>通信时触发事故告警会死机, 需要断电重启.</strong></font></td></tr></tbody></table><ul><li>理想最大电源solution: <code>6500mAh</code>, 可提供最大电源solution: <code>30Ah</code></li><li>奇怪的事情发生了, <code>SIM800C</code>续航比<code>ESP8266</code>还长(未曾设想的道路).</li></ul><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> <code>SIM800C</code>在进行<code>TCP</code>通信时触发事故告警会死机</p></div></div></div><div class="timenode"><div class="meta"><p><p>2020/11/28 校内 户外调试</p></p></div><div class="body"><p>机型: <code>v0.1</code> 初代机 <code>ASKR YGGDRASILLS</code></p><div class="note notice"><p>从此次开始所有的系统稳定性测试默认为<code>SIM800C</code>方案.</p></div><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td><code>SIM800C</code>通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>$O(1)$的<code>WG-84 to GCJ-02</code>算法验证</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td><code>GPS</code>速度精度测试</td><td><font color=green><strong>通过, 测得误差约为±0.092kmph</strong></font></td></tr><tr><td>事故侦测算法及参数验证 <strong>(二周目)</strong></td><td><font color=green><strong>通过, 判断准确</strong></font></td></tr><tr><td>基础便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>高速便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试 <strong>(二周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> 微信小程序中当前点标注由于图片中心点问题在画布缩小后看起来定位不准</p></div><div class="note bug red"><p><strong><font color=green>[FIXED]</font></strong> <code>timer = setInterval</code>失效 只能手动刷新</p></div><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="调试工具人: 移动电脑架"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.1.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.5/img/HYAH/ts2.1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="桶上调试"></p>              </div>            </details></div></div><div class="timenode"><div class="meta"><p><p>2020/12/06 校内 户外调试</p></p></div><div class="body"><p>机型: 三代目: <code>RAMIEL OCTAHEDRON</code></p><table><thead><tr><th>调试项目</th><th>调试结果</th></tr></thead><tbody><tr><td>事故侦测算法及参数验证 <strong>(三周目)</strong></td><td><font color=green><strong>通过, 判断准确</strong></font></td></tr><tr><td>高速便携性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>恶劣路面便携性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>系统稳定性测试</td><td><font color=green><strong>通过</strong></font></td></tr><tr><td>整体通信能力测试</td><td><font color=green><strong>通过, 全时连接</strong></font></td></tr><tr><td>续航测试 (900mAh) <strong>(二周目)</strong></td><td><font color=green><strong>203min, 续航良好</strong></font></td></tr><tr><td>系统稳定性测试 <strong>(三周目)</strong></td><td><font color=green><strong>通过</strong></font></td></tr></tbody></table></div></div><h3 id="开发点滴"><a href="#开发点滴" class="headerlink" title="开发点滴"></a>开发点滴</h3><h4 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h4><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/theGardenOfSinners.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/theGardenOfSinners.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" alt="[梶浦由記] the Garden of sinners -劇場版 空の境界 音楽集-" align=center /> <br></p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/GSD.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/GSD.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" alt="[London Symphony Orchestra] 交響組曲 機動戦士ガンダムSEED DESTINY Symphony SEED DESTINY" align=center /><h4 id="电子熏香"><a href="#电子熏香" class="headerlink" title="电子熏香"></a>电子熏香</h4><p>2020年11月20日早晨6点25分, 由于没睡醒进行了一些奇妙操作导致SIM800C冒烟. <font color=gray><strong>R.I.P.</strong></font></p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_152617.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_152617.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="300" height = "400" alt="去世的SIM800C" align=center /><p>从此我组给部分硬件损毁的情况起了别名:</p><table><thead><tr><th>别名</th><th>实际故障</th></tr></thead><tbody><tr><td>放炮</td><td>炸电解电容/二极管</td></tr><tr><td>电子熏香</td><td>板子糊了</td></tr><tr><td>核爆</td><td>炸电源</td></tr></tbody></table><h4 id="噜"><a href="#噜" class="headerlink" title="噜"></a>噜</h4><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.11/img/HYAH/atlu.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.11/img/HYAH/atlu.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="支離滅裂な思考と発言"></p><h4 id="Apple-punch"><a href="#Apple-punch" class="headerlink" title="Apple punch"></a>Apple punch</h4><p>🍎砸牛顿, 于是有了万有引力定律.</p><p>🍎砸我们, 于是弯了电容和杜邦线.</p><details ><summary> <p>事故现场</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210318.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210318.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="🍎惨剧"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210354.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.3/img/HYAH/20201121_210354.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="🍎惨剧"></p>              </div>            </details><h3 id="团队故事"><a href="#团队故事" class="headerlink" title="团队故事"></a>团队故事</h3><h4 id="Picaloe"><a href="#Picaloe" class="headerlink" title="Picaloe"></a>Picaloe</h4><blockquote><p>首先非常有幸能与我们小组组长一同完成本次大作业，本人是一个完全技术上的萌新小白，但与一个拥有过硬技术的组长共同完成了这个我认为很完美的项目，过程中我体会到了完成一个项目的难度，技术掌握，项目规划，文案策划等等，组长很早就已经开始策划本次大作业的方向了，由于本人技术原因，在技术创新方面我出力甚少，但在文案策划排版方面，我学到了许多新知识，例如<code>LaTeX</code>，<code>html</code>一些的文本代码的编写与格式的实现。我想说，这个项目，无论在，硬件，软件，还是文案布局方面，都付出了极大的心血，组长打代码的声音我是忘不了了。这次项目下来，我认识到了小组合作的重要性，也初步加深了对这个专业作为工科的理解，希望今后能慢慢从一只萌新小白成长为一位老打工人。</p></blockquote><h4 id="ElliasK"><a href="#ElliasK" class="headerlink" title="ElliasK"></a>ElliasK</h4><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/1.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "200" align=center /> <br></p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/2.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/HYAH/summery/2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" weidth="200" height = "213.88" align=center /><details ><summary> <p>Photos</p> </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_150643.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_150643.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="十三陵水库"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201120_151832.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201120_151832.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="居庸关"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_140405.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.12/img/HYAH/20201108_140405.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="京藏高速"></p>              </div>            </details><h3 id="Recerence"><a href="#Recerence" class="headerlink" title="Recerence"></a>Recerence</h3><blockquote><p><code>TheWayForward</code></p><p><a href="http://faioj.brynhild.online/cppreference/">FAIOJ C++参考手册</a></p><p><a href="https://www.zhihu.com/question/55648210">已知不可逆的坐标转换算法，通过结果进行反算的方法</a></p><p><a href="https://www.w3cschool.cn/ecmascript/3uge1q5v.html">w3school ECMAScript 6 Promise对象</a></p><p><a href="https://www.cnblogs.com/langzou/p/10402501.html">GCJ-02到WG-84坐标变换</a></p><p><a href="https://wenku.baidu.com/view/8928d61402768e9951e73889.html">百度文库 NEO-7_ProductSummary_(GPS.G7-HW-11003)</a></p><p><a href="http://bilgin.esme.org/BitsAndBytes/KalmanFilterforDummies">KalmanFilterforDummies</a></p><p><a href="https://www.intechopen.com/books/introduction-and-implementations-of-the-kalman-filter/introduction-to-kalman-filter-and-its-applications">Introduction-and-implementations-of-the-kalman-filter</a></p><p><a href="https://wenku.baidu.com/view/3ba0b673effdc8d376eeaeaad1f34693daef109d.html">百度文库 基于单片机控制的积分式电压表设计</a></p><p><a href="https://github.com/fabriceo/SCoop/issues/4">SCoop Github issue about timer0_overflow_count</a></p><p><a href="https://playground.arduino.cc/Main/PROGMEM/">Arduino PROGMEM</a></p><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.15.4/img/HYAH/SIM800_Series_AT_Command_Manual_V1.07.pdf">SIM800 Series AT Command Manual V1.07</a></p><p><a href="https://wenku.baidu.com/view/8b41ae843b3567ec102d8ae6.html">百度文库 SIM800C_硬件设计手册_V1.01</a></p><p><a href="https://blog.csdn.net/tech_joy/article/details/105877066">CSDN JOY_TECH SIM800C的使用心得</a></p><p><a href="https://wenku.baidu.com/view/a7492aeab9f3f90f76c61b8d.html">百度文库 MPU6050 技术手册</a></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/">微信小程序文档 - 微信开放文档</a></p><p><a href="https://www.arduino.cc/en/Tutorial/HomePage">Arduino tutorials</a></p><p><a href="https://www.arduino.cc/en/Tutorial/BuiltInExamples/ArduinoISP">ArduinoISP</a></p><p><a href="https://www.latex-project.org/">The LaTeX Project</a></p><p><a href="http://www.ctex.org/onlinedocuments">CTEX : OnlineDocuments LaTeX</a></p><p><a href="http://www.ctex.org/documents/latex/latex2e-html/index.html">Hypertext Help with LaTeX</a></p><p><a href="http://www.ctex.org/documents/latex/graphics/index.html">LATEX2e 插图指南</a></p><p><a href="https://zhuanlan.zhihu.com/p/166219554">编译原理——链接过程</a></p><p><a href="https://open.iot.10086.cn/devdoc/">OneNET 文档中心</a></p><p><a href="https://open.iot.10086.cn/doc/multiprotocol/">OneNET 多协议接入</a></p><p><a href="https://www.pianshen.com/article/1601187790/">程序员大本营 HTTP报文格式</a></p><p><a href="https://zhuanlan.zhihu.com/p/112060856">知乎 HTTP报文格式简介</a></p><p><a href="http://www.cplusplus.com/reference/string/string/c_str/">std::string::c_str</a></p><p><a href="https://weui.io/">WeUI 文档</a></p><p><a href="https://github.com/Tencent/weui">GitHub Tencent WeUI</a></p><p><a href="https://jin-yufeng.github.io/Parser/#/">Parser富文本插件 文档</a></p><p><a href="https://github.com/jin-yufeng/Parser">GitHub jin-yufeng Parser</a></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>YMOI圣地巡礼</title>
      <link href="/recall-oi-20200828/"/>
      <url>/recall-oi-20200828/</url>
      
        <content type="html"><![CDATA[<blockquote><p>2020.8.28 YMOI暑假24中集训圣地巡礼<br>goto: <a href="https://brynhild.online/oi_history/">ELLIAS的退役之路</a></p></blockquote><a id="more"></a><h3 id="罗森便利店-七七街店"><a href="#罗森便利店-七七街店" class="headerlink" title="罗森便利店(七七街店)"></a>罗森便利店(七七街店)</h3><div class="timenode"><div class="meta"><p><p>2020-08-28</p></p></div><div class="body"><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/requiem/20200828_162633.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/requiem/20200828_162633.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="LAWSON"></p></div></div><div class="timenode"><div class="meta"><p><p>2018-07-25</p></p></div><div class="body"><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/542e2e5ec1194fa8.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/542e2e5ec1194fa8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.7.25.3"></p></div></div><h3 id="大连市第24中学"><a href="#大连市第24中学" class="headerlink" title="大连市第24中学"></a>大连市第24中学</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/requiem/20200828_163317.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/requiem/20200828_163317.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="24"></p><h3 id="次の旅を楽しみにしています"><a href="#次の旅を楽しみにしています" class="headerlink" title="次の旅を楽しみにしています!"></a>次の旅を楽しみにしています!</h3>]]></content>
      
      
      <categories>
          
          <category> memory </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>FAIOJ 101 左偏树 可并堆 STL简单实现</title>
      <link href="/faioj0101-leftist-heap/"/>
      <url>/faioj0101-leftist-heap/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="http://faioj.brynhild.online/problem/101">FAIOJ #101</a><br><a href="https://www.luogu.com.cn/problem/P3377">洛谷 P3377</a></p></blockquote><a id="more"></a><p>使用了 <code>ext/pb_ds/priority_queue.hpp</code>.</p><p>由于使用结构体或者pair同时存数和编号较为繁琐, 由于本题数据不大, 故使用 $data*(n+1)+i$ 来同时存储数据和编号.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/priority_queue.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],but[ELAS],*_p1=buf,*_p2=buf,*_p3=but,*_p4=but+ELAS;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> bit[<span class="number">20</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gc() ((_p1==_p2)&amp;&amp;(_p2=(_p1=buf)+fread(buf,1,ELAS,stdin),_p1==_p2)?EOF:*_p1++)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">(_p3==_p4)?(fwrite(_p3=but, <span class="number">1</span>, ELAS, <span class="built_in">stdout</span>), *_p3++=c):(*_p3++=c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x=<span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c=gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (!(c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc(), m = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">readu</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> x=<span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c=gc();</span><br><span class="line"><span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">while</span> (c &gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!x) &#123;<span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>); <span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> pos=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, pt (<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (; x; x/=<span class="number">10</span>) bit[++ pos] = x%<span class="number">10</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> i=pos; i; --i) pt(bit[i]^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> fa[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">find</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (!(x^fa[x]))? x:fa[x]=find(fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__gnu_pbds::<span class="built_in">priority_queue</span>&lt;<span class="keyword">long</span> <span class="keyword">long</span>, greater &lt;<span class="keyword">long</span> <span class="keyword">long</span>&gt;, __gnu_pbds::binomial_heap_tag&gt; que[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> n=readu()+<span class="number">1</span>, m=readu(), opt, x, y;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">bool</span> del[maxn];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> i=<span class="number">1</span>; i^n; ++i) fa[i]=i, del[i]=<span class="literal">false</span>, que[i].push(read()*n+i);</span><br><span class="line"><span class="keyword">while</span> (m --) &#123;</span><br><span class="line">opt = read(), x = read();</span><br><span class="line"><span class="keyword">if</span> (opt^<span class="number">2</span>) &#123;</span><br><span class="line">y = read ();</span><br><span class="line"><span class="keyword">if</span> (del[x] || del[y]) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> ((x=find(x))^(y=find(y))) &#123;</span><br><span class="line">fa[y]=x, que[x].join(que[y]);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (del[x]) pt(<span class="string">&#x27;-&#x27;</span>), pt(<span class="string">&#x27;1&#x27;</span>), pt(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">write ((opt=que[y=find(x)].top())/n), pt (<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">que[y].pop(), del[opt%n] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fwrite (but, <span class="number">1</span>, _p3-but, <span class="built_in">stdout</span>), <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OPTIMIZATION</title>
      <link href="/OPTIMIZE/"/>
      <url>/OPTIMIZE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>编译选项 普通的快读快写 fread/fwrite优化的快读快写 浮点数的快读快写 内嵌asm</p></blockquote><a id="more"></a><p><a href="https://ellias.blog.luogu.org/optimize-1">LuoguBlog</a></p><h3 id="Fast-Read-amp-Write"><a href="#Fast-Read-amp-Write" class="headerlink" title="Fast Read &amp; Write"></a>Fast Read &amp; Write</h3><h4 id="ELLIAS-Old"><a href="#ELLIAS-Old" class="headerlink" title="ELLIAS_Old"></a>ELLIAS_Old</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fastio</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[<span class="number">1</span>&lt;&lt;<span class="number">14</span>],*p1=buf,*p2=buf;</span><br><span class="line"><span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">14</span>,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getint</span> <span class="params">(<span class="keyword">int</span> &amp;to)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (c!=<span class="string">&#x27;-&#x27;</span>&amp;&amp;(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>) &amp;&amp; c != <span class="string">&#x27;-&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) c = gc(), m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + c - <span class="string">&#x27;0&#x27;</span>, c = gc();</span><br><span class="line"><span class="keyword">if</span> (m) <span class="keyword">return</span> -x; <span class="keyword">else</span> <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getuint</span> <span class="params">(<span class="keyword">int</span> &amp;to)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> c = gc();</span><br><span class="line"><span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) c = gc();</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + c - <span class="string">&#x27;0&#x27;</span>, c = gc();</span><br><span class="line">to = x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getdou</span> <span class="params">(<span class="keyword">double</span> &amp;to)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> x=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> ch = getchar ();</span><br><span class="line"><span class="keyword">bool</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch != <span class="string">&#x27;-&#x27;</span>) ch = gc ();</span><br><span class="line"><span class="keyword">if</span> (ch == <span class="string">&#x27;-&#x27;</span>) ch = gc(), m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + (ch<span class="number">-48</span>), ch = gc ();</span><br><span class="line"><span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">double</span> s = <span class="number">0.1</span>;</span><br><span class="line">ch = gc ();</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x + (ch<span class="number">-48</span>)*s,s/=<span class="number">10</span>,ch = gc ();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (m) to = -x;</span><br><span class="line"><span class="keyword">else</span> to = x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getudou</span> <span class="params">(<span class="keyword">double</span> &amp;to)</span> </span>&#123;</span><br><span class="line"><span class="keyword">double</span> x=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> ch = gc ();</span><br><span class="line"><span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = gc ();</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x * <span class="number">10</span> + (ch<span class="number">-48</span>), ch = gc ();</span><br><span class="line"><span class="keyword">if</span> (ch == <span class="string">&#x27;.&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">double</span> s = <span class="number">0.1</span>;</span><br><span class="line">ch = gc ();</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) x = x + (ch<span class="number">-48</span>)*s,s/=<span class="number">10</span>,ch = gc ();</span><br><span class="line">&#125;</span><br><span class="line">to = x;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125; io;</span><br></pre></td></tr></table></figure><h4 id="SJB"><a href="#SJB" class="headerlink" title="SJB"></a>SJB</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> fastIO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> str = <span class="number">1</span>&lt;&lt;<span class="number">20</span>; <span class="keyword">const</span> <span class="keyword">char</span>* kiana = <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Reader</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str], *s, *t;</span><br><span class="line">        <span class="keyword">bool</span> EOF_FLG;</span><br><span class="line">        Reader():s(buf), t(buf), EOF_FLG(<span class="literal">false</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gt</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> s==t&amp;&amp;((t=(s=buf)+fread(buf,<span class="number">1</span>,str,<span class="built_in">stdin</span>))==s)?EOF:(*s++);&#125;</span><br><span class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; Reader&amp;<span class="keyword">operator</span> &gt;&gt; (T&amp;x)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="keyword">if</span> (EOF_FLG)<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> c=<span class="number">0</span>,d;</span><br><span class="line">            <span class="keyword">while</span> (c != EOF &amp;&amp; (!<span class="built_in">isdigit</span>(c)))d=c,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(c == EOF) &#123;EOF_FLG=<span class="literal">true</span>; <span class="keyword">return</span> *<span class="keyword">this</span>;&#125; <span class="keyword">else</span> x = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">isdigit</span>(c)) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + c - <span class="string">&#x27;0&#x27;</span>, c = gt();</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="string">&#x27;-&#x27;</span>) x =- x;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cin</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Writer</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        Writer():s(buf),t(buf+str) &#123;&#125;</span><br><span class="line">        ~Writer() &#123;fwrite(buf,<span class="number">1</span>,s-buf,<span class="built_in">stdout</span>);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;(s==t)?(fwrite(s=buf,<span class="number">1</span>,str,<span class="built_in">stdout</span>),*s++=c):(*s++=c);&#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Writer&amp;<span class="keyword">operator</span>&lt;&lt;(T x)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="keyword">if</span>(!x) <span class="keyword">return</span> pt(<span class="string">&#x27;0&#x27;</span>),*<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;<span class="number">0</span>) pt(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> a[<span class="number">30</span>],t=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x)a[t++]=x%<span class="number">10</span>,x/=<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span>(t--)pt(a[t]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Writer&amp;<span class="keyword">operator</span>&lt;&lt;(<span class="keyword">const</span> <span class="keyword">char</span>*s) &#123;<span class="keyword">while</span>(*s)pt(*s++);<span class="keyword">return</span> *<span class="keyword">this</span>;&#125;</span><br><span class="line">    &#125; <span class="built_in">cout</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ELLIAS-New"><a href="#ELLIAS-New" class="headerlink" title="ELLIAS_New"></a>ELLIAS_New</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) c = gc(), m = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">if</span>(x&lt;<span class="number">0</span>)x=-x,<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); write (x); <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br></pre></td></tr></table></figure><h4 id="ELLIAS-2020-fread-fwrite-优化版本"><a href="#ELLIAS-2020-fread-fwrite-优化版本" class="headerlink" title="ELLIAS@2020 (fread fwrite 优化版本)"></a>ELLIAS@2020 (fread fwrite 优化版本)</h4><p>包括 <code>fread</code> <code>fwrite</code> 改写的 <code>getchar()</code> 和 <code>putchar()</code> 浮点数快读快写 整数快读快写</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],but[ELAS],*_p1=buf,*_p2=buf,*_p3=but,*_p4=but+ELAS;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> bit[<span class="number">20</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gc() ((_p1==_p2)&amp;&amp;(_p2=(_p1=buf)+fread(buf,1,ELAS,stdin),_p1==_p2)?EOF:*_p1++)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">(_p3==_p4)?(fwrite(_p3=but, <span class="number">1</span>, ELAS, <span class="built_in">stdout</span>), *_p3++=c):(*_p3++=c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x=<span class="number">0l</span>l; <span class="keyword">register</span> <span class="keyword">char</span> c=gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (!(c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc(), m = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">readu</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x=<span class="number">0l</span>l; <span class="keyword">register</span> <span class="keyword">char</span> c=gc();</span><br><span class="line"><span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">while</span> (c &gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">double</span> <span class="title">readdou</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">double</span> x=<span class="number">0.0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c=gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (!(c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc(), m = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x * <span class="number">10.0</span> + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">if</span> (!(c ^ <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">double</span> s=<span class="number">0.1</span>; c=gc();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x + (c ^ <span class="string">&#x27;0&#x27;</span>) * s, s/=<span class="number">10.0</span>, c=gc();</span><br><span class="line">&#125; <span class="keyword">return</span> m? -x : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">double</span> <span class="title">readudou</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">double</span> x=<span class="number">0.0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c=gc();</span><br><span class="line"><span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x * <span class="number">10.0</span> + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">if</span> (!(c ^ <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">double</span> s=<span class="number">0.1</span>; c=gc();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x + (c ^ <span class="string">&#x27;0&#x27;</span>) * s, s/=<span class="number">10.0</span>, c=gc();</span><br><span class="line">&#125; <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!x) &#123;pt(<span class="string">&#x27;0&#x27;</span>); <span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> pos=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, pt (<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (; x; x/=<span class="number">10</span>) bit[++ pos] = x%<span class="number">10</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=pos; i; --i) pt(bit[i]^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">qpow</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> t)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> base = a, ret = <span class="number">1l</span>l;</span><br><span class="line"><span class="keyword">while</span> (t) &#123;</span><br><span class="line"><span class="keyword">if</span> (t&amp;<span class="number">1</span>) ret = ret * base;</span><br><span class="line">base = base * base, t &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">writedou</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">double</span> x, <span class="keyword">int</span> res=<span class="number">9</span>)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x == <span class="number">0.0</span>) &#123;</span><br><span class="line">pt(<span class="string">&#x27;0&#x27;</span>), pt(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>; i^res; ++i) pt (<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (x &lt; <span class="number">0.0</span>) x=-x, pt(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> clf=qpow(<span class="number">10</span>, res);</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> flt=(<span class="keyword">long</span> <span class="keyword">long</span>)(x * clf) % clf;</span><br><span class="line">write ((<span class="keyword">long</span> <span class="keyword">long</span>) x); pt (<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (; pos^res; flt/=<span class="number">10</span>) bit[++ pos] = flt%<span class="number">10</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=pos; i; --i) pt(bit[i]^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//主程序代码内容</span></span><br><span class="line">fwrite (but, <span class="number">1</span>, _p3-but, <span class="built_in">stdout</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SWITCH"><a href="#SWITCH" class="headerlink" title="SWITCH"></a>SWITCH</h3><h4 id="OLD-2017"><a href="#OLD-2017" class="headerlink" title="OLD (2017)"></a>OLD (2017)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks,inline-functions-called-once,-funsafe-loop-optimizations,-fexpensive-optimizations,-foptimize-sibling-calls,-ftree-switch-conversion,-finline-small-functions,inline-small-functions,-frerun-cse-after-loop,-fhoist-adjacent-loads,-findirect-inlining,-freorder-functions,no-stack-protector,-fpartial-inlining,-fsched-interblock,-fcse-follow-jumps,-fcse-skip-blocks,-falign-functions,-fstrict-overflow,-fstrict-aliasing,-fschedule-insns2,-ftree-tail-merge,inline-functions,-fschedule-insns,-freorder-blocks,-fwhole-program,-funroll-loops,-fthread-jumps,-fcrossjumping,-fcaller-saves,-fdevirtualize,-falign-labels,-falign-loops,-falign-jumps,unroll-loops,-fsched-spec,-ffast-math,Ofast,inline,-fgcse,-fgcse-lm,-fipa-sra,-ftree-pre,-ftree-vrp,-fpeephole2&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br></pre></td></tr></table></figure><h4 id="OLD-2018-3"><a href="#OLD-2018-3" class="headerlink" title="OLD(2018.3)"></a>OLD(2018.3)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse-lm&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fipa-sra&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-pre&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-vrp&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpeephole2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ffast-math&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-spec&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-labels&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdevirtualize&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcaller-saves&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcrossjumping&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fthread-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-funroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fwhole-program&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-blocks&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-tail-merge&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fstrict-aliasing&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fstrict-overflow&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcse-skip-blocks&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcse-follow-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-interblock&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpartial-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;no-stack-protector&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-findirect-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fhoist-adjacent-loads&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-frerun-cse-after-loop&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-finline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-switch-conversion&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-foptimize-sibling-calls&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fexpensive-optimizations&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-funsafe-loop-optimizations&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions-called-once&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks&quot;</span>)</span></span><br></pre></td></tr></table></figure><h4 id="NOIp2018"><a href="#NOIp2018" class="headerlink" title="NOIp2018"></a>NOIp2018</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse-lm&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fipa-sra&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-pre&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-vrp&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpeephole2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ffast-math&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-spec&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-labels&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdevirtualize&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcaller-saves&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcrossjumping&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fthread-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-funroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-blocks&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-tail-merge&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fstrict-aliasing&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcse-follow-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-interblock&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpartial-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;no-stack-protector&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-findirect-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fhoist-adjacent-loads&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-frerun-cse-after-loop&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-finline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-switch-conversion&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-foptimize-sibling-calls&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fexpensive-optimizations&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions-called-once&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks&quot;</span>)</span></span><br></pre></td></tr></table></figure><h3 id="内嵌asm优化"><a href="#内嵌asm优化" class="headerlink" title="内嵌asm优化"></a>内嵌asm优化</h3><h4 id="a-b-mo"><a href="#a-b-mo" class="headerlink" title="a * b % mo"></a>a * b % mo</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">mul_mod</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> b,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> mo)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret;</span><br><span class="line">__asm__ __volatile__ (<span class="string">&quot;\tmull %%ebx\n\tdivl %%ecx\n&quot;</span> : <span class="string">&quot;=d&quot;</span>(ret):<span class="string">&quot;a&quot;</span>(a),<span class="string">&quot;b&quot;</span>(b),<span class="string">&quot;c&quot;</span>(mo));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线段树 namespace</title>
      <link href="/seg-tree-namespace/"/>
      <url>/seg-tree-namespace/</url>
      
        <content type="html"><![CDATA[<blockquote><p>线段树 namespace</p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Seg_Tree &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls p &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs p &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((l + r) &gt;&gt; 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> mn[N &lt;&lt; <span class="number">2</span>], pos[N &lt;&lt; <span class="number">2</span>], tag[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span> <span class="params">(<span class="keyword">int</span> p)</span> </span>&#123; mn[p] = <span class="built_in">std</span>::min (mn[ls], mn[rs]), pos[p] = !(mn[p]^mn[rs]) ? pos[rs] : pos[ls]; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span> <span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> x)</span> </span>&#123; tag[p] += x, mn[p] -= x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span> <span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (tag[p]) modify (ls, tag[p]), modify (rs, tag[p]), tag[p] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!(l^r)) <span class="keyword">return</span> mn[p] = wait[l], pos[p] = l, <span class="keyword">void</span> ();</span><br><span class="line"><span class="keyword">else</span> build (ls, l, mid), build (rs, mid + <span class="number">1</span>, r), pushup (p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; r || l &gt; R || L &gt; R) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> modify(p, x);</span><br><span class="line"><span class="keyword">else</span> pushdown (p), update (ls, l, mid, L, R, x), update (rs, mid + <span class="number">1</span>, r, L, R, x), pushup (p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">find</span> <span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (L &gt; r || l &gt; R || L &gt; R) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> p;</span><br><span class="line">pushdown(p);</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> p1 = find (ls, l, mid, L, R), p2 = find (rs, mid + <span class="number">1</span>, r, L, R);</span><br><span class="line"><span class="keyword">return</span> mn[p1] &gt; mn[p2] ? p2 : p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> ls</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> rs</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> mid</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Seg_Tree;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> segment tree </tag>
            
            <tag> Template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FAIOJ 1499 快速幂取模 (加强版)</title>
      <link href="/faioj1499-qpow-fast/"/>
      <url>/faioj1499-qpow-fast/</url>
      
        <content type="html"><![CDATA[<blockquote><p>扩展欧拉定理<br><a href="http://faioj.brynhild.online/problem/1499">题目链接</a></p></blockquote><a id="more"></a><p>$$ {a}^b\ mod\ p = {a}^{b\ mod\ φp + φp}\ mod\ p $$</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize(<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">&quot;sse3&quot;</span>, <span class="meta-string">&quot;sse2&quot;</span>, <span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">&quot;avx&quot;</span>, <span class="meta-string">&quot;sse4&quot;</span>, <span class="meta-string">&quot;sse4.1&quot;</span>, <span class="meta-string">&quot;sse4.2&quot;</span>, <span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target(<span class="meta-string">&quot;sse3&quot;</span>, <span class="meta-string">&quot;sse2&quot;</span>, <span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target(<span class="meta-string">&quot;avx&quot;</span>, <span class="meta-string">&quot;sse4&quot;</span>, <span class="meta-string">&quot;sse4.1&quot;</span>, <span class="meta-string">&quot;sse4.2&quot;</span>, <span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target(<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">mul_mod</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> b,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> mo)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret;</span><br><span class="line">__asm__ __volatile__ (<span class="string">&quot;\tmull %%ebx\n\tdivl %%ecx\n&quot;</span> : <span class="string">&quot;=d&quot;</span>(ret):<span class="string">&quot;a&quot;</span>(a),<span class="string">&quot;b&quot;</span>(b),<span class="string">&quot;c&quot;</span>(mo));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">qpow</span><span class="params">(Re ll a, Re ll t, Re ll m)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> base = a % m, ret = <span class="number">1l</span>l;</span><br><span class="line"><span class="keyword">while</span> (t) &#123;</span><br><span class="line"><span class="keyword">if</span> (t &amp; <span class="number">1</span>)</span><br><span class="line">ret = mul_mod (ret, base, m);</span><br><span class="line">base = mul_mod (base, base, m), t &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret % m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> aa[<span class="number">101</span>], bb[<span class="number">101</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> a = <span class="number">0l</span>l, b = <span class="number">0l</span>l, m, mm, phi;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s %s %lld&quot;</span>, aa, bb, &amp;m);</span><br><span class="line"></span><br><span class="line">mm = phi = m;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> ll i = <span class="number">2l</span>l; i * i &lt;= mm; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (!(mm % i)) &#123;</span><br><span class="line">phi = phi / i * (i - <span class="number">1</span>);</span><br><span class="line"><span class="keyword">while</span> (!(mm % i)) mm /= i;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">if</span> (mm &gt; <span class="number">1</span>) phi = phi / mm * (mm - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> la = <span class="built_in">strlen</span>(aa), lb = <span class="built_in">strlen</span>(bb);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; la; ++i) a = (a * <span class="number">10</span> + (aa[i] ^ <span class="string">&#x27;0&#x27;</span>)) % m;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lb; ++i) b = (b * <span class="number">10</span> + (bb[i] ^ <span class="string">&#x27;0&#x27;</span>)) % phi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, qpow(a, b &gt; phi? (b % phi + phi) : b % phi, m)), <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>珂学上网 基于VultrVPS的SSR服务器的基本搭建</title>
      <link href="/vultr_ssr_vpn_buildup/"/>
      <url>/vultr_ssr_vpn_buildup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Vultr SSR VPS 锐速 CentOS VPN GoogleBBR 防火墙</p></blockquote><a id="more"></a><h3 id="购买-VPS-服务器"><a href="#购买-VPS-服务器" class="headerlink" title="购买 VPS 服务器"></a>购买 VPS 服务器</h3><p>我们应该选择国外的 VPS(Virtual Private Server) 提供商,这里推荐 <a href="https://www.vultr.com/">Vultr</a>,性价比较高,最低有 $2.5/m 的,但其只支持 IPv6 ,所以个人搭建推荐 $3.5/m.</p><p>目前新账号充值 $10 可赠送 $50,是相当划算的.如果想要通过注册多个账号来减少资费,请务必注意 IP 地址及 GPS 定位.</p><h3 id="VPS服务器的搭建和连接"><a href="#VPS服务器的搭建和连接" class="headerlink" title="VPS服务器的搭建和连接"></a>VPS服务器的搭建和连接</h3><h4 id="服务器搭建"><a href="#服务器搭建" class="headerlink" title="服务器搭建"></a>服务器搭建</h4><p>在 Product 页点击加号新建服务器.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>选择 Cloud Compute.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>选择自己熟悉的 OS.这里以 CentOS 为例. CentOS 版本建议选6以上,否则也许会出现未知的问题.</p><p>Vultr 提供多个地区的服务器,建议一次性搭建多台之后逐个测试速度,速度较慢的删除即可.服务器按照小时计费,不需要担心资费浪费问题.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>扩展功能按需要选择.这里建议勾选 Enable IPv6.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>服务器搭建完成后可以在 Products 页面看到.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="服务器连接"><a href="#服务器连接" class="headerlink" title="服务器连接"></a>服务器连接</h4><p>在服务器页面,我们需要记下服务器的 IP 用户名 密码.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/6.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>我们需要终端用 SSH 来连接 VPS.在 Windows 操作系统上推荐 Xshell. Vultr 网站上也提供了命令行,但不推荐使用.</p><h5 id="在Xshell上连接"><a href="#在Xshell上连接" class="headerlink" title="在Xshell上连接"></a>在Xshell上连接</h5><p>文件-&gt;新建</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>在连接中填写相关内容.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>在用户身份验证中填写用户名和密码.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/9.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/15.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/15.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>连接即可.</p><h5 id="在终端连接"><a href="#在终端连接" class="headerlink" title="在终端连接"></a>在终端连接</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh your_username@server_IP -p 22 (22是你VPS的SSH端口)</span><br></pre></td></tr></table></figure><p>端口可以省略.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/22.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/22.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h3 id="相关内容安装"><a href="#相关内容安装" class="headerlink" title="相关内容安装"></a>相关内容安装</h3><h4 id="安装SSR"><a href="#安装SSR" class="headerlink" title="安装SSR"></a>安装SSR</h4><p>安装 wegt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br></pre></td></tr></table></figure><p>安装 SSR</p><blockquote><p>该脚本由 <a href="http://www.qcgzxw.cn/">www.qcgzxw.cn</a> 提供.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://freed.ga/github/shadowsocksR.sh; bash shadowsocksR.sh</span><br></pre></td></tr></table></figure><p>SSR 相关配置依需要而定.</p><p>搭建成功后会显示 IP,端口,密码,协议等,用于填写 ShadowsocksR 配置信息.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/12.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/12.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="使用锐速为-SSR-加速"><a href="#使用锐速为-SSR-加速" class="headerlink" title="使用锐速为 SSR 加速"></a>使用锐速为 SSR 加速</h4><p>锐速模块依赖于内核,基本原理是对丢包情况进行评估,并重发可能丢的数据包,即锐速多倍发包,在一定程度上能够提高 VPN 速度.</p><p>首先查询系统内核版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure><p>如返回值以 2 开头,说明服务器为 CentOS6,可直接安装锐速.</p><p>如返回值以 3 开头,需要对内核降级.</p><p>另: 如果已经安装过 Google BBR 拥塞控制算法,那么无法安装锐速.</p><p>CentOS6 安装锐速:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O appex.sh https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh &amp;&amp; bash appex.sh install <span class="string">&#x27;2.6.32-642.el6.x86_64&#x27;</span></span><br></pre></td></tr></table></figure><p>更高版本使用以下命令对内核降级:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate -O rskernel.sh https://raw.githubusercontent.com/uxh/shadowsocks_bash/master/rskernel.sh &amp;&amp; bash rskernel.sh</span><br></pre></td></tr></table></figure><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/13.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/13.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>如图所示,系统为 CentOS7,更换内核后系统重启.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/14.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/14.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>重新连接后使用如下指令安装锐速:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools -y &amp;&amp; wget --no-check-certificate -O appex.sh https://raw.githubusercontent.com/0oVicero0/serverSpeeder_Install/master/appex.sh &amp;&amp; bash appex.sh install</span><br></pre></td></tr></table></figure><p>在过程中图示的三个选项默认即可.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/16.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/16.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>下图为安装运行成功.与锐速相关的指令会在文末给出.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/17.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ssr_basic_setup/17.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="使用-Google-BBR-为-SSR-加速"><a href="#使用-Google-BBR-为-SSR-加速" class="headerlink" title="使用 Google BBR 为 SSR 加速"></a>使用 Google BBR 为 SSR 加速</h4><p>这是一个 TCP 拥塞控制算法.Google BBR 的 github 页面: <a href="https://github.com/google/bbr">https://github.com/google/bbr</a></p><blockquote><p>警告: Google BBR 需要升级内核,锐速需要降级内核,二者不可兼得.</p></blockquote><p>卸载原版内核 headers.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove kernel-headers</span><br></pre></td></tr></table></figure><p>安装高版本内核 headers.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --enablerepo=elrepo-kernel -y install kernel-ml-headers</span><br></pre></td></tr></table></figure><p>升级 CentOS 系统内核.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kernel-ml kernel-ml-devel</span><br></pre></td></tr></table></figure><p>升级 headers.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kernel-ml-headers</span><br></pre></td></tr></table></figure><p>对于 CentOS6</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/^default=.*/default=0/g&#x27;</span> /boot/grub/grub.conf</span><br></pre></td></tr></table></figure><p>对于更高版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-set-default 0</span><br></pre></td></tr></table></figure><p>使用安装脚本安装 Google BBR.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh &amp;&amp; chmod +x bbr.sh &amp;&amp; ./bbr.sh</span><br></pre></td></tr></table></figure><blockquote><p>这个脚本由 <a href="https://teddysun.com/">秋水逸冰</a> 提供.</p></blockquote><p>安装后重启服务器,检查 BBR 是否启动.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure><p>返回值有 tcp_bbr 模块即说明 BBR 已启动.并不是所有的 VPS 都会有此返回值,若没有也属正常.</p><h3 id="SSR多端口配置"><a href="#SSR多端口配置" class="headerlink" title="SSR多端口配置"></a>SSR多端口配置</h3><p>使用 Vim 打开配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/shadowsocks.json</span><br></pre></td></tr></table></figure><p>原有内容大致如下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_ipv6&quot;</span>: <span class="string">&quot;::&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>: <span class="number">25565</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>: <span class="number">1081</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;www.qcgzxw.cn&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>: <span class="number">120</span>,</span><br><span class="line">    <span class="attr">&quot;udp_timeout&quot;</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;auth_sha1_v4_compatible&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;protocol_param&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;obfs&quot;</span>: <span class="string">&quot;http_simple_compatible&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;obfs_param&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dns_ipv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;connect_verbose_info&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;redirect&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fast_open&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;workers&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除原有的 <code>server_port</code> 及 <code>password</code> ,新增 <code>port_password</code> ,前面是端口,后面是密码,需要注意格式问题.</p><p>示例更改后如下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_ipv6&quot;</span>: <span class="string">&quot;::&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>: <span class="number">1081</span>,</span><br><span class="line">    <span class="attr">&quot;port_password&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;1096&quot;</span>:<span class="string">&quot;hanyuu&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;1919&quot;</span>:<span class="string">&quot;senpai&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;2020&quot;</span>:<span class="string">&quot;evolution&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;417&quot;</span>:<span class="string">&quot;morsunhy&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;2333&quot;</span>:<span class="string">&quot;morsun&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;11451&quot;</span>:<span class="string">&quot;niconiconi&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;10960&quot;</span>:<span class="string">&quot;hanyuu&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>: <span class="number">120</span>,</span><br><span class="line">    <span class="attr">&quot;udp_timeout&quot;</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;auth_sha1_v4_compatible&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;protocol_param&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;obfs&quot;</span>: <span class="string">&quot;http_simple_compatible&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;obfs_param&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dns_ipv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;connect_verbose_info&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;redirect&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fast_open&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;workers&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存后修改防火墙配置:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/firewalld/zones/public.xml</span><br></pre></td></tr></table></figure><p>原有内容大致如下:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">zone</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short</span>&gt;</span>Public<span class="tag">&lt;/<span class="name">short</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;dhcpv6-client&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;ssh&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;25565&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;25565&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">zone</span>&gt;</span></span><br></pre></td></tr></table></figure><p>加入新加入的端口,一行 tcp,一行 udp.</p><p>修改后内容大致如下:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">zone</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">short</span>&gt;</span>Public<span class="tag">&lt;/<span class="name">short</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;dhcpv6-client&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">&quot;ssh&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1096&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1096&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1919&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1919&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;2020&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;2020&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;2333&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;2333&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;11451&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;11451&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;417&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;417&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;tcp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;10960&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span> <span class="attr">protocol</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">port</span>=<span class="string">&quot;10960&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">zone</span>&gt;</span></span><br></pre></td></tr></table></figure><p>重启 SSR.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/shadowsocks restart</span><br></pre></td></tr></table></figure><p>重启防火墙.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>也可以参考下文的指令按照类似流程安装.</p><h3 id="SSR的使用"><a href="#SSR的使用" class="headerlink" title="SSR的使用"></a>SSR的使用</h3><p>下载客户端,配置并连接即可.</p><p>Shadowsocks:  <a href="https://shadowsocks.org/">https://shadowsocks.org/</a></p><p>ShadowsocksR: <a href="https://github.com/Anankke/SSRR-Windows/">https://github.com/Anankke/SSRR-Windows/</a></p><h3 id="相关指令扩展"><a href="#相关指令扩展" class="headerlink" title="相关指令扩展"></a>相关指令扩展</h3><h4 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动SSR</span></span><br><span class="line">/etc/init.d/shadowsocks start</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止SSR</span></span><br><span class="line">/etc/init.d/shadowsocks stop</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启SSR</span></span><br><span class="line">/etc/init.d/shadowsocks restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#状态SSR</span></span><br><span class="line">/etc/init.d/shadowsocks status</span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载SSR</span></span><br><span class="line">./shadowsocks-all.sh uninstall</span><br><span class="line"></span><br><span class="line"><span class="comment">#更改配置参数</span></span><br><span class="line">vim /etc/shadowsocks-r/config.json</span><br></pre></td></tr></table></figure><h4 id="锐速"><a href="#锐速" class="headerlink" title="锐速"></a>锐速</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看运行状态</span></span><br><span class="line">/appex/bin/serverSpeeder.sh status</span><br><span class="line">  </span><br><span class="line"><span class="comment">#启动锐速</span></span><br><span class="line">/appex/bin/serverSpeeder.sh start</span><br><span class="line">  </span><br><span class="line"><span class="comment">#停止锐速</span></span><br><span class="line">/appex/bin/serverSpeeder.sh stop</span><br><span class="line">  </span><br><span class="line"><span class="comment">#重启锐速</span></span><br><span class="line">/appex/bin/serverSpeeder.sh restart</span><br><span class="line">  </span><br><span class="line"><span class="comment">#卸载锐速</span></span><br><span class="line">/appex/bin/serverSpeeder.sh uninstall</span><br></pre></td></tr></table></figure><h4 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h4><h5 id="CentOS7之前版本-iptables-命令"><a href="#CentOS7之前版本-iptables-命令" class="headerlink" title="CentOS7之前版本 iptables 命令"></a>CentOS7之前版本 iptables 命令</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看已经开放的端口:</span></span><br><span class="line">/etc/init.d/iptables status</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启端口</span></span><br><span class="line">/sbin/iptables -I INPUT -p tcp --dport 端口 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存设置</span></span><br><span class="line">/etc/rc.d/init.d/iptables save</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动防火墙(永久)</span></span><br><span class="line">chkconfig iptables on</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止防火墙(永久)</span></span><br><span class="line">chkconfig iptables off</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动防火墙(暂时,重启失效)</span></span><br><span class="line">service iptables start</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭防火墙(暂时,重启失效)</span></span><br><span class="line">service iptables stop</span><br></pre></td></tr></table></figure><h5 id="CentOS7-firewall-命令"><a href="#CentOS7-firewall-命令" class="headerlink" title="CentOS7 firewall 命令"></a>CentOS7 firewall 命令</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动防火墙</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看防火墙状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看已经开放的端口</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启端口(永久)</span></span><br><span class="line">firewall-cmd --zone=public --add-port=端口/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启防火墙</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止防火墙</span></span><br><span class="line">systemctl stop firewalld.service </span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止开机启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> VPN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VPN </tag>
            
            <tag> VPS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>扫盲向 利用OBS虚拟摄像头在网课上摸鱼</title>
      <link href="/obs_internet_class_fishing/"/>
      <url>/obs_internet_class_fishing/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Windows OBS OBS-VirtualCam Facerig</p></blockquote><a id="more"></a><h3 id="INTRODUCTION"><a href="#INTRODUCTION" class="headerlink" title="INTRODUCTION"></a>INTRODUCTION</h3><blockquote><p>「摸鱼之心，人皆有之，咸者能毋丧耳。」    – Hanyuu ELLIAS</p></blockquote><p>近期不少同学问我网课摸鱼的事,于是有了这个扫盲向博客.</p><p>当然,您也可以用它来在课上做一些不对劲的事,</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.2.32/img/OBS_internet_class/10.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND@2.2.32/img/OBS_internet_class/10.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h3 id="REQUIREMENT"><a href="#REQUIREMENT" class="headerlink" title="REQUIREMENT"></a>REQUIREMENT</h3><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><a href="https://obsproject.com/">Open Broadcaster Software</a></p><p><a href="https://obsproject.com/forum/resources/obs-virtualcam.539/">OBS-VirtualCam</a></p><p>Install and run.</p><h3 id="USE"><a href="#USE" class="headerlink" title="USE"></a>USE</h3><h4 id="INPUT"><a href="#INPUT" class="headerlink" title="INPUT"></a>INPUT</h4><p>在”来源”中点击加号添加.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h5 id="作为视频或图像"><a href="#作为视频或图像" class="headerlink" title="作为视频或图像"></a>作为视频或图像</h5><p>录一段学习时候的视频或选择一张贴纸.</p><p>选择 VLC 视频源或图像.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/5.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>点击加号添加文件或路径.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/6.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h5 id="作为视频源"><a href="#作为视频源" class="headerlink" title="作为视频源"></a>作为视频源</h5><p>添加视频捕获装置</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/7.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>作为示例,这里选择了 Facerig 的虚拟摄像头.</p><p><del>我很可爱,请给我钱!</del></p><blockquote><p>　这个模型来自创意工坊,作者为 toribako145.</p></blockquote><p>确保其被激活.分辨率选项视情况而定.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/8.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>将画面充满屏幕.</p><p>用上下箭头调整前后位置.确保其出于可视状态.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/9.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="OUTPUT"><a href="#OUTPUT" class="headerlink" title="OUTPUT"></a>OUTPUT</h4><p>工具-&gt;虚拟摄像头.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>选择目标摄像头(默认即可),水平翻转及保持长宽比例视情况使用.</p><p>缓冲帧视性能调整.</p><p>启动即可.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/OBS_internet_class/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="IN-CLASS"><a href="#IN-CLASS" class="headerlink" title="IN CLASS"></a>IN CLASS</h4><p>选择刚才设置的目标摄像头即可.</p><h3 id="OTHERS"><a href="#OTHERS" class="headerlink" title="OTHERS"></a>OTHERS</h3><ol><li>低配置设备可在设置-&gt;视频中调整分辨率来缓解卡顿.</li><li>不使用物理摄像头时将其遮住是个好习惯.</li><li>使用Facerig时请留意各方面的版权限制.</li><li>摸鱼有风险,使用需谨慎.</li><li>请各位”务必”以学业为重!</li></ol>]]></content>
      
      
      <categories>
          
          <category> Trick </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OBS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网易云VIP歌曲NCM格式解密</title>
      <link href="/ncm_unlock/"/>
      <url>/ncm_unlock/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Windows Android ncmdump 网易云</p></blockquote><a id="more"></a><h4 id="INTRODUCTION"><a href="#INTRODUCTION" class="headerlink" title="INTRODUCTION"></a>INTRODUCTION</h4><p>当发现从网易云音乐下载的 VIP 音乐成了这副样子</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/3.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>不禁要吐槽:</p><p>这真是太(    ),太(    )了. (中文填空,每空2字)</p><p>本文将提供几种 NCM 格式的解密方案.</p><h4 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h4><h5 id="Dev-Tools"><a href="#Dev-Tools" class="headerlink" title="Dev Tools"></a>Dev Tools</h5><p>在官网播放页”偷”缓存,发现了看起来对劲的东西,果断下载+转码,用 mp3tag 加入封面及歌曲信息,大功告成.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/4.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h5 id="音乐解锁-By-IXarea"><a href="#音乐解锁-By-IXarea" class="headerlink" title="音乐解锁 - By IXarea"></a>音乐解锁 - By IXarea</h5><p><a href="https://github.com/ix64/unlock-music">unlock-music on GitHub</a></p><p>音乐解锁用于移除已购音乐的加密保护.目前支持网易云音乐(ncm) QQ音乐(qmc,mflac,mgg,tkm)以及其他格式,并使用 MIT 许可协议开放源代码.其使用浏览器对本地文件进行操作,不需要将文件上传.</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/1.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><p>使用 <a href="https://github.com/yoki123/ncmdump">ncmdump</a> 或 <a href="https://github.com/anonymous5l/ncmdump-gui">ncmdump-gui</a>.链接指向对应的GitHub仓库.</p><p>考虑到 GitHub 要”夜缒而出”,给出一定版本的下载地址:</p><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/Release.zip">Release.zip, ncmdump-gui@25Jan2019</a></p><blockquote><p>大小: 219129 字节</p><p>MD5: D90B1FDFCEC35DD3E5BDE912AB35C436</p><p>SHA1: B57308A46244823EC44996E62AD45FE5DD32BF26</p><p>CRC32: 36B0CD33</p></blockquote><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/ncmdump-gui-lastest.tar.gz">ncmdump-gui-lastest.tar.gz, ncmdump-gui@25Jan2019</a></p><blockquote><p>大小: 72943 字节</p><p>MD5: D21AC64AFD09270C0ABFFADD62D50ECF</p><p>SHA1: 87186625F385E70102DE58E5B8414F99EF1653F6</p><p>CRC32: 7A91F3AE</p></blockquote><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/ncmdump-windows-amd64.zip">ncmdump-windows-amd64.zip, ncmdump@v0.3.0</a></p><blockquote><p>大小: 3318258 字节</p><p>MD5: 9720D5EE3523D377E7F0F7D499665043</p><p>SHA1: 9E4F216562B7CED2533A098255FC16794AAC05CE</p><p>CRC32: 17FC5336</p></blockquote><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/ncmdump-darwin-amd64.zip">ncmdump-darwin-amd64.zip, ncmdump@v0.3.0</a></p><blockquote><p>大小: 3461822 字节</p><p>MD5: 0CD5CB0A46DE5532CCCD62CD22261E3F</p><p>SHA1: A8DDFDA576D703E90F7491BCF6D2A907934534A2</p><p>CRC32: A2F413A9</p></blockquote><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/ncmdump-0.3.0.tar.gz">ncmdump-0.3.0.tar.gz, ncmdump@v0.3.0</a></p><blockquote><p>大小: 104499 字节</p><p>MD5: 23896D0FEDE39F976003661ACFEF810D</p><p>SHA1: 85EE97C5CD995FA88616A8523E6862A1836D9D08</p><p>CRC32: B142A5B6</p></blockquote><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><h5 id="DroidNCM"><a href="#DroidNCM" class="headerlink" title="DroidNCM"></a>DroidNCM</h5><p>安卓版的 ncmdump.GitHub 页面: <a href="https://github.com/bunnyblueair/DroidNCM">https://github.com/bunnyblueair/DroidNCM</a></p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/2.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>下载地址:</p><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/ncm-release.apk">ncm-release.apk, DroidNCM@v2.1.1</a></p><blockquote><p>大小: 3054417 字节</p><p>MD5: 4F42A5244E817B485C1DE1CA0FE4E8F6</p><p>SHA1: B70F7A1401A9DBC858C1E1CF87AF49E9442977D0</p><p>CRC32: B3D2E106</p></blockquote><p><a href="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/download/ncm/DroidNCM-2.1.1.tar.gz">DroidNCM-2.1.1.tar.gz, DroidNCM@v2.1.1</a></p><blockquote><p>大小: 9360077 字节</p><p>MD5: 073D92EA36E3EE388E95C0651D3886DA</p><p>SHA1: F8C50937C661C00D225C00E954F1DA96065A6D38</p><p>CRC32: F99D094B</p></blockquote><blockquote><p>据说这个软件兼容性不是很好,建议下载源码自行编译.</p></blockquote><h5 id="铃声-操作繁琐-不推荐"><a href="#铃声-操作繁琐-不推荐" class="headerlink" title="铃声(操作繁琐,不推荐)"></a>铃声(操作繁琐,不推荐)</h5><p>在客户端中将歌曲设置为铃声</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/5.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>每次截取60s,直到全部截取</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/6.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>在如图所示的目录中会生成解密后的文件</p><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/7.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/ncm/7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></fancybox><p>加.mp3后缀,使用格式工厂拼接即可.</p>]]></content>
      
      
      <categories>
          
          <category> Trick </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Trick </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buzzer scale define</title>
      <link href="/buzzer-define/"/>
      <url>/buzzer-define/</url>
      
        <content type="html"><![CDATA[<blockquote><p>buzzer scale define</p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ddo 262</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dre 294</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dmi 330</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dfa 349</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dso 392</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dla 440</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dsi 494</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> do 523</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re 578</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mi 659</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fa 698</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> so 784</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> la 880</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> si 988</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> udo 1046</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ure 1175</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> umi 1318</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ufa 1480</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uso 1568</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ula 1760</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> usi 1976</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sddo 277</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sdre 311</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sdfa 370</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sdso 415</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sdla 466</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sdo 554</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sre 622</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sfa 740</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sso 831</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sla 932</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sudo 1046</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sure 1245</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sufa 1480</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> suso 1661</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sula 1865</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> buzzer </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
            <tag> buzzer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ELLIAS的OI之路</title>
      <link href="/oi_history/"/>
      <url>/oi_history/</url>
      
        <content type="html"><![CDATA[<blockquote><p>从高中录取到退役<br>ELLIAS的OI之路</p></blockquote><a id="more"></a><h3 id="2017-7-24-YM录取"><a href="#2017-7-24-YM录取" class="headerlink" title="2017.7.24 YM录取"></a>2017.7.24 YM录取</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20170724_135654.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20170724_135654.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2017.7.24.1"></p></fancybox><h3 id="2017-12-29-YM1-12新年联欢会OIer合影"><a href="#2017-12-29-YM1-12新年联欢会OIer合影" class="headerlink" title="2017.12.29 YM1.12新年联欢会OIer合影"></a>2017.12.29 YM1.12新年联欢会OIer合影</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/72d39e754c42233b.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/72d39e754c42233b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2017.12.29.1"></p></fancybox><h3 id="2018-1-19-先修调人-YM1-12教室"><a href="#2018-1-19-先修调人-YM1-12教室" class="headerlink" title="2018.1.19 先修调人 YM1.12教室"></a>2018.1.19 先修调人 YM1.12教室</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180119_121125.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180119_121125.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.1.19.1"></p></fancybox><h3 id="2018-4-7-窗外风景-非正式参加LN胜选"><a href="#2018-4-7-窗外风景-非正式参加LN胜选" class="headerlink" title="2018.4.7 窗外风景 非正式参加LN胜选"></a>2018.4.7 窗外风景 非正式参加LN胜选</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180407_070025.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180407_070025.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.4.7.1"></p><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180407_070031.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180407_070031.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.4.7.2"></p></fancybox><h3 id="2018-7-16-YMOI校内集训"><a href="#2018-7-16-YMOI校内集训" class="headerlink" title="2018.7.16 YMOI校内集训"></a>2018.7.16 YMOI校内集训</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180716_124407.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180716_124407.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.7.16.1"></p></fancybox><h3 id="2018-7-25-24中集训"><a href="#2018-7-25-24中集训" class="headerlink" title="2018.7.25 24中集训"></a>2018.7.25 24中集训</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180725_175848.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180725_175848.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.7.25.1"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180725_175938.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20180725_175938.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.7.25.2"><br><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/542e2e5ec1194fa8.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/542e2e5ec1194fa8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="2018.7.25.3"></p></fancybox><h3 id="2019-NOIp2018省一退役"><a href="#2019-NOIp2018省一退役" class="headerlink" title="2019 NOIp2018省一退役"></a>2019 NOIp2018省一退役</h3><fancybox><p><img src="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20181219134050.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/novaELLIAS/CDN_for_ND/img/oi_history/20181219134050.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="NOIp2018省一"></p></fancybox><h3 id="次の旅を楽しみにしています"><a href="#次の旅を楽しみにしています" class="headerlink" title="次の旅を楽しみにしています!"></a>次の旅を楽しみにしています!</h3><h3 id="2020-8-28圣地巡礼"><a href="#2020-8-28圣地巡礼" class="headerlink" title="2020.8.28圣地巡礼"></a>2020.8.28圣地巡礼</h3><p>goto: <a href="https://brynhild.online/recall-oi-20200828">https://brynhild.online/recall-oi-20200828</a></p>]]></content>
      
      
      <categories>
          
          <category> memory </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>倍增 洛谷P1967 货车运输</title>
      <link href="/luogu-P1967-noip2018-day-1/"/>
      <url>/luogu-P1967-noip2018-day-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>NOIp2018 day-1<br>RP倍增祈愿<br><a href="https://www.luogu.org/problemnew/show/P1967">luogu P1967</a></p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luogu-judger-enable-o2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fgcse-lm&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fipa-sra&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-pre&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-vrp&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpeephole2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ffast-math&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-spec&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-labels&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdevirtualize&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcaller-saves&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcrossjumping&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fthread-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-funroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-blocks&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-tail-merge&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fschedule-insns2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fstrict-aliasing&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-falign-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fcse-follow-jumps&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fsched-interblock&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fpartial-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;no-stack-protector&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-freorder-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-findirect-inlining&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fhoist-adjacent-loads&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-frerun-cse-after-loop&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-finline-small-functions&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-ftree-switch-conversion&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-foptimize-sibling-calls&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fexpensive-optimizations&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;inline-functions-called-once&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::sort;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxe 50001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) ((x)^=(y)^=(x)^=(y))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) c = gc(), m = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line">    <span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">if</span>(x&lt;<span class="number">0</span>)x=-x,<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); write (x); <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">min</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123;<span class="keyword">return</span> a&lt;b? a:b;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fr, to, va;</span><br><span class="line">&#125; edge[maxe];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span> <span class="params">(node a, node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.va &gt; b.va;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[maxn], nxt[maxn], too[maxn], wei[maxn], ecnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge_d</span> <span class="params">(Re <span class="keyword">int</span> fr, Re <span class="keyword">int</span> to, Re <span class="keyword">int</span> va)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    nxt[++ ecnt]=head[fr], head[fr]=ecnt, too[ecnt]=to, wei[ecnt]=va;</span><br><span class="line">    nxt[++ ecnt]=head[to], head[to]=ecnt, too[ecnt]=fr, wei[ecnt]=va;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fa[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">find</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x ^ fa[x]) x = fa[x] = fa[fa[x]];</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Kruskal</span> <span class="params">(Re <span class="keyword">int</span> n, Re <span class="keyword">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i, j, fr, to, va, ffr, fto;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=m; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        fr=edge[i].fr, to=edge[i].to, ffr=find(fr), fto=find(to);</span><br><span class="line">        <span class="keyword">if</span> (ffr ^ fto) addedge_d (fr, to, edge[i].va), fa[ffr]=fto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fl[maxn];</span><br><span class="line"><span class="keyword">int</span> ex[maxn][<span class="number">18</span>], ew[maxn][<span class="number">18</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build_tree</span> <span class="params">(Re <span class="keyword">int</span> x, Re <span class="keyword">int</span> dep)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i, j, to, va;</span><br><span class="line">    <span class="keyword">if</span> (!fl[x])</span><br><span class="line">    &#123;</span><br><span class="line">        fl[x] = dep;</span><br><span class="line">        <span class="keyword">for</span> (i=head[x]; i; i=nxt[i])</span><br><span class="line">        &#123;</span><br><span class="line">            to=too[i], va=wei[i];</span><br><span class="line">            <span class="keyword">if</span> (!fl[to])</span><br><span class="line">            &#123;</span><br><span class="line">                ex[to][<span class="number">0</span>] = x, ew[to][<span class="number">0</span>] = va;</span><br><span class="line">                build_tree (to, dep + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build_forest</span> <span class="params">(Re <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i, j, fr, to, va;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">        <span class="keyword">if</span> (!fl[i]) &#123;</span><br><span class="line">            ew[i][<span class="number">0</span>] = <span class="number">0x3f3f3f3f</span>, ex[i][<span class="number">0</span>] = i;</span><br><span class="line">            build_tree (i, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">lca_init</span> <span class="params">(Re <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">17</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j=<span class="number">1</span>; j&lt;=n; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            ex[j][i] = ex[ex[j][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">            ew[j][i] = min (ew[ex[j][i<span class="number">-1</span>]][i<span class="number">-1</span>], ew[j][i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get_lca</span> <span class="params">(Re <span class="keyword">int</span> fr, Re <span class="keyword">int</span> to)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (find(fr) ^ find(to)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> ret=<span class="number">0x3f3f3f3f</span>, i, j;</span><br><span class="line">    <span class="keyword">if</span> (fl[fr] &gt; fl[to]) swap (fr, to);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">17</span>; i&gt;=<span class="number">0</span>; --i)</span><br><span class="line">        <span class="keyword">if</span> (fl[ex[to][i]] &gt;= fl[fr])</span><br><span class="line">            ret=min (ret, ew[to][i]), to=ex[to][i];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (fr == to) <span class="keyword">return</span> ret;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">17</span>; i&gt;=<span class="number">0</span>; --i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex[fr][i] ^ ex[to][i])</span><br><span class="line">        &#123;</span><br><span class="line">            ret = min (ret, min (ew[to][i], ew[fr][i]));</span><br><span class="line">            to=ex[to][i], fr=ex[fr][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ret=min(ret,min(ew[fr][<span class="number">0</span>], ew[to][<span class="number">0</span>]));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i, j, fr, to, va;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> n=read(), m=read();</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; ++i) fa[i] = i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=m; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        fr=read(), to=read(), va=read();</span><br><span class="line">        edge[i] = &#123;fr, to, va&#125;;</span><br><span class="line">    &#125; sort (edge+<span class="number">1</span>, edge+m+<span class="number">1</span>, cmp);</span><br><span class="line">    Kruskal (n, m);</span><br><span class="line">    build_forest (n);</span><br><span class="line">    lca_init (n);</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> _ = read ();</span><br><span class="line">    <span class="keyword">while</span> (_ --) writelen (get_lca(read(), read()));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
            <tag> 倍增 </tag>
            
            <tag> 生成树 </tag>
            
            <tag> 并查集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GSS1 - Can you answer these queries I</title>
      <link href="/GSS1/"/>
      <url>/GSS1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>线段树<br>GSS1 - Can you answer these queries I</p></blockquote><a id="more"></a><p><a href="https://www.luogu.org/problemnew/show/SP1043">Luogu SP1043</a><br><a href="https://vjudge.net/problem/SPOJ-GSS1">Vjudge</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks,inline-functions-called-once,-funsafe-loop-optimizations,-fexpensive-optimizations,-foptimize-sibling-calls,-ftree-switch-conversion,-finline-small-functions,inline-small-functions,-frerun-cse-after-loop,-fhoist-adjacent-loads,-findirect-inlining,-freorder-functions,no-stack-protector,-fpartial-inlining,-fsched-interblock,-fcse-follow-jumps,-fcse-skip-blocks,-falign-functions,-fstrict-overflow,-fstrict-aliasing,-fschedule-insns2,-ftree-tail-merge,inline-functions,-fschedule-insns,-freorder-blocks,-fwhole-program,-funroll-loops,-fthread-jumps,-fcrossjumping,-fcaller-saves,-fdevirtualize,-falign-labels,-falign-loops,-falign-jumps,unroll-loops,-fsched-spec,-ffast-math,Ofast,inline,-fgcse,-fgcse-lm,-fipa-sra,-ftree-pre,-ftree-vrp,-fpeephole2&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson rt&lt;&lt;1,l,mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson rt&lt;&lt;1|1,mid+1,r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rint register int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, x, y, in;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sum, lmax, rmax, dat;</span><br><span class="line">&#125; tr[<span class="number">200001</span>];</span><br><span class="line"><span class="keyword">namespace</span> FastIO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> str=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="built_in">endl</span>=<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Reader</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        <span class="keyword">bool</span> EOF_FLG;</span><br><span class="line">        Reader():s(buf),t(buf),EOF_FLG(<span class="literal">false</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s==t&amp;&amp;((t=(s=buf)+fread(buf,<span class="number">1</span>,str,<span class="built_in">stdin</span>))==s)?EOF:(*s++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Reader&amp;<span class="keyword">operator</span>&gt;&gt;(T&amp;x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(EOF_FLG)<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> c=<span class="number">0</span>,d;</span><br><span class="line">            <span class="keyword">while</span>(c!=EOF&amp;&amp;(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>))d=c,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(c==EOF) &#123;</span><br><span class="line">                EOF_FLG=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> x=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>)x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+c-<span class="string">&#x27;0&#x27;</span>,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(d==<span class="string">&#x27;-&#x27;</span>)x=-x;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cin</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Writer</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        Writer():s(buf),t(buf+str) &#123;&#125;</span><br><span class="line">        ~Writer() &#123;</span><br><span class="line">            fwrite(buf,<span class="number">1</span>,s-buf,<span class="built_in">stdout</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">            (s==t)?(fwrite(s=buf,<span class="number">1</span>,str,<span class="built_in">stdout</span>),*s++=c):(*s++=c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Writer&amp;<span class="keyword">operator</span>&lt;&lt;(T x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!x)<span class="keyword">return</span> pt(<span class="string">&#x27;0&#x27;</span>),*<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;<span class="number">0</span>)pt(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> a[<span class="number">30</span>],t=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x)a[t++]=x%<span class="number">10</span>,x/=<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span>(t--)pt(a[t]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Writer&amp;<span class="keyword">operator</span>&lt;&lt;(<span class="keyword">const</span> <span class="keyword">char</span>*s) &#123;</span><br><span class="line">            <span class="keyword">while</span>(*s)pt(*s++);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cout</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">max</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x,<span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    tr[rt].sum =tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">    tr[rt].lmax= max (tr[rt&lt;&lt;<span class="number">1</span>].lmax, tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lmax);</span><br><span class="line">    tr[rt].rmax= max (tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].rmax, tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>].rmax);</span><br><span class="line">    tr[rt].dat = max (max(tr[rt&lt;&lt;<span class="number">1</span>].dat, tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat), tr[rt&lt;&lt;<span class="number">1</span>].rmax + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lmax);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l==r) &#123;</span><br><span class="line">        FastIO::<span class="built_in">cin</span>&gt;&gt;in;</span><br><span class="line">        tr[rt].dat = tr[rt].sum = tr[rt].lmax = tr[rt].rmax = in;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build (lson);</span><br><span class="line">    build (rson);</span><br><span class="line">    update (rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> node <span class="title">query</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> tr[rt];</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &gt;  mid) <span class="keyword">return</span> query (rson, ql, qr);</span><br><span class="line">    <span class="keyword">if</span> (qr &lt;= mid) <span class="keyword">return</span> query (lson, ql, qr);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        node ans,a,b;</span><br><span class="line">        a = query (lson,ql,qr);</span><br><span class="line">        b = query (rson,ql,qr);</span><br><span class="line">        ans.sum = a.sum + b.sum;</span><br><span class="line">        ans.dat = max (a.dat, a.rmax + b.lmax), ans.dat = max (ans.dat, b.dat);</span><br><span class="line">        ans.lmax= max (a.lmax, a.sum + b.lmax);</span><br><span class="line">        ans.rmax= max (b.rmax, b.sum + a.rmax);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> FastIO;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//freopen (&quot;nico.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    FastIO::<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    build (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    FastIO::<span class="built_in">cin</span>&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span> (m --) &#123;</span><br><span class="line">        FastIO::<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        FastIO::<span class="built_in">cout</span>&lt;&lt;query(<span class="number">1</span>, <span class="number">1</span>, n, x, y).dat&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GSS </tag>
            
            <tag> segment tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SP2713 GSS4 - Can you answer these queries IV</title>
      <link href="/GSS4/"/>
      <url>/GSS4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>GSS4 - Can you answer these queries IV<br><a href="https://www.luogu.org/problemnew/show/SP2713">Luogu</a><br><a href="https://vjudge.net/problem/SPOJ-GSS4">Vjudge</a></p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> root 1,1,n</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson rt&lt;&lt;1,l,mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson rt&lt;&lt;1|1,mid+1,r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) y^=x^=y^=x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dmax 400001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rint register int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> fastIO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> str=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* endll=<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Reader</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        <span class="keyword">bool</span> EOF_FLG;</span><br><span class="line">        Reader():s(buf),t(buf),EOF_FLG(<span class="literal">false</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s==t&amp;&amp;((t=(s=buf)+fread(buf,<span class="number">1</span>,str,<span class="built_in">stdin</span>))==s)?EOF:(*s++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> gt() getchar() </span></span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Reader&amp;<span class="keyword">operator</span>&gt;&gt;(T&amp;x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(EOF_FLG)<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> c=<span class="number">0</span>,d;</span><br><span class="line">            <span class="keyword">while</span>(c!=EOF&amp;&amp;!<span class="built_in">isdigit</span>(c))d=c,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(c==EOF) &#123;</span><br><span class="line">                EOF_FLG=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> x=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(<span class="built_in">isdigit</span>(c))x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+c-<span class="string">&#x27;0&#x27;</span>,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(d==<span class="string">&#x27;-&#x27;</span>)x=-x;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cin</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Writer</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        Writer():s(buf),t(buf+str) &#123;&#125;</span><br><span class="line">        ~Writer() &#123;</span><br><span class="line">            fwrite(buf,<span class="number">1</span>,s-buf,<span class="built_in">stdout</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">            (s==t)?(fwrite(s=buf,<span class="number">1</span>,str,<span class="built_in">stdout</span>),*s++=c):(*s++=c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">#<span class="meta-keyword">define</span> pt(c) putchar(c)</span></span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Writer&amp;<span class="keyword">operator</span>&lt;&lt;(T x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!x)<span class="keyword">return</span> pt(<span class="string">&#x27;0&#x27;</span>),*<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;<span class="number">0</span>)pt(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> a[<span class="number">30</span>],t=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x)a[t++]=x%<span class="number">10</span>,x/=<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span>(t--)pt(a[t]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Writer&amp;<span class="keyword">operator</span>&lt;&lt;(<span class="keyword">const</span> <span class="keyword">char</span>*s) &#123;</span><br><span class="line">            <span class="keyword">while</span>(*s)pt(*s++);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cout</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> fastIO;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> sum, mxx;</span><br><span class="line">&#125; dat[dmax];</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> in;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; <span class="title">max</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; x,<span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; y)</span> </span>&#123;<span class="keyword">return</span> x&gt;y? x:y;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(<span class="keyword">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dat[rt].sum = dat[rt&lt;&lt;<span class="number">1</span>].sum + dat[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">    dat[rt].mxx = max (dat[rt&lt;&lt;<span class="number">1</span>].mxx, dat[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mxx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    dat[rt].l = l, dat[rt].r = r;</span><br><span class="line">    <span class="keyword">if</span> (l == r)</span><br><span class="line">    &#123;</span><br><span class="line">        fastIO::<span class="built_in">cin</span> &gt;&gt; in;</span><br><span class="line">        dat[rt].sum = dat[rt].mxx = in;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    build (lson); build (rson);</span><br><span class="line">    update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> L = dat[rt].l, R = dat[rt].r;</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= L &amp;&amp; R &lt;= r) <span class="keyword">return</span> dat[rt].sum;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0l</span>l;</span><br><span class="line">    <span class="keyword">if</span> (l &lt;=mid) ret  = query (rt&lt;&lt;<span class="number">1</span>, l, r);</span><br><span class="line">    <span class="keyword">if</span> (mid &lt; r) ret += query (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> L = dat[rt].l, R = dat[rt].r;</span><br><span class="line">    <span class="keyword">if</span> (L == R) &#123;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;dat[rt].sum&lt;&lt;&quot; -&gt; &quot;;</span></span><br><span class="line">        dat[rt].sum = <span class="built_in">sqrt</span> (dat[rt].sum),</span><br><span class="line">        dat[rt].mxx = <span class="built_in">sqrt</span> (dat[rt].mxx);</span><br><span class="line">        <span class="comment">//cout&lt;&lt;dat[rt].sum&lt;&lt;endll;</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (l&lt;=mid &amp;&amp; dat[rt&lt;&lt;<span class="number">1</span>].mxx  &gt;<span class="number">1</span>) change (rt&lt;&lt;<span class="number">1</span>, l, r);</span><br><span class="line">    <span class="keyword">if</span> (mid&lt; r &amp;&amp; dat[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mxx&gt;<span class="number">1</span>) change (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//using namespace fastIO;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Write</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x, <span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;<span class="built_in">cout</span> &lt;&lt; query(<span class="number">1</span>, x, y) &lt;&lt; endll;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Change</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x, <span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;change (<span class="number">1</span>, x, y);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> _ = <span class="number">0</span>, n;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span> (<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        fastIO::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Case #&quot;</span> &lt;&lt; ++ _ &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; endll;</span><br><span class="line">        build (root);</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">int</span> m, x, y, ret;</span><br><span class="line">        <span class="keyword">register</span> <span class="keyword">bool</span> opt;</span><br><span class="line">        fastIO::<span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">        <span class="keyword">while</span> (m --)</span><br><span class="line">        &#123;</span><br><span class="line">            fastIO::<span class="built_in">cin</span> &gt;&gt; opt &gt;&gt; x &gt;&gt; y;</span><br><span class="line">                <span class="keyword">if</span> (x &gt; y) swap (x, y);</span><br><span class="line">            opt? Write(x, y):Change (x, y);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GSS </tag>
            
            <tag> segment tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SP1716 GSS3 - Can you answer these queries III</title>
      <link href="/GSS3/"/>
      <url>/GSS3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>线段树<br>GSS3 - Can you answer these queries III</p></blockquote><a id="more"></a><p><a href="https://www.luogu.org/problemnew/show/SP1716">Luogu</a><br><a href="https://vjudge.net/problem/SPOJ-GSS3">Vjudge</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;-fdelete-null-pointer-checks,inline-functions-called-once,-funsafe-loop-optimizations,-fexpensive-optimizations,-foptimize-sibling-calls,-ftree-switch-conversion,-finline-small-functions,inline-small-functions,-frerun-cse-after-loop,-fhoist-adjacent-loads,-findirect-inlining,-freorder-functions,no-stack-protector,-fpartial-inlining,-fsched-interblock,-fcse-follow-jumps,-fcse-skip-blocks,-falign-functions,-fstrict-overflow,-fstrict-aliasing,-fschedule-insns2,-ftree-tail-merge,inline-functions,-fschedule-insns,-freorder-blocks,-fwhole-program,-funroll-loops,-fthread-jumps,-fcrossjumping,-fcaller-saves,-fdevirtualize,-falign-labels,-falign-loops,-falign-jumps,unroll-loops,-fsched-spec,-ffast-math,Ofast,inline,-fgcse,-fgcse-lm,-fipa-sra,-ftree-pre,-ftree-vrp,-fpeephole2&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson rt&lt;&lt;1,l,mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson rt&lt;&lt;1|1,mid+1,r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rint register int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, x, y, in, opt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sum, lmax, rmax, dat, l, r;</span><br><span class="line">&#125; tr[<span class="number">200001</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> FastIO &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> str=<span class="number">1</span>&lt;&lt;<span class="number">20</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="built_in">endl</span>=<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Reader</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        <span class="keyword">bool</span> EOF_FLG;</span><br><span class="line">        Reader():s(buf),t(buf),EOF_FLG(<span class="literal">false</span>) &#123;&#125;;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s==t&amp;&amp;((t=(s=buf)+fread(buf,<span class="number">1</span>,str,<span class="built_in">stdin</span>))==s)?EOF:(*s++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Reader&amp;<span class="keyword">operator</span>&gt;&gt;(T&amp;x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(EOF_FLG)<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> c=<span class="number">0</span>,d;</span><br><span class="line">            <span class="keyword">while</span>(c!=EOF&amp;&amp;(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>))d=c,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(c==EOF) &#123;</span><br><span class="line">                EOF_FLG=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> x=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>)x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+c-<span class="string">&#x27;0&#x27;</span>,c=gt();</span><br><span class="line">            <span class="keyword">if</span>(d==<span class="string">&#x27;-&#x27;</span>)x=-x;</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cin</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Writer</span> &#123;</span></span><br><span class="line">        <span class="keyword">char</span> buf[str],*s,*t;</span><br><span class="line">        Writer():s(buf),t(buf+str) &#123;&#125;</span><br><span class="line">        ~Writer() &#123;</span><br><span class="line">            fwrite(buf,<span class="number">1</span>,s-buf,<span class="built_in">stdout</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pt</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">            (s==t)?(fwrite(s=buf,<span class="number">1</span>,str,<span class="built_in">stdout</span>),*s++=c):(*s++=c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;Writer&amp;<span class="keyword">operator</span>&lt;&lt;(T x) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!x)<span class="keyword">return</span> pt(<span class="string">&#x27;0&#x27;</span>),*<span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;<span class="number">0</span>)pt(<span class="string">&#x27;-&#x27;</span>),x=-x;</span><br><span class="line">            <span class="keyword">register</span> <span class="keyword">char</span> a[<span class="number">30</span>],t=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(x)a[t++]=x%<span class="number">10</span>,x/=<span class="number">10</span>;</span><br><span class="line">            <span class="keyword">while</span>(t--)pt(a[t]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Writer&amp;<span class="keyword">operator</span>&lt;&lt;(<span class="keyword">const</span> <span class="keyword">char</span>*s) &#123;</span><br><span class="line">            <span class="keyword">while</span>(*s)pt(*s++);</span><br><span class="line">            <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">cout</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">max</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; x,<span class="keyword">const</span> <span class="keyword">int</span>&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;y?x:y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    tr[rt].sum =tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">    tr[rt].lmax= <span class="built_in">max</span> (tr[rt&lt;&lt;<span class="number">1</span>].lmax, tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lmax);</span><br><span class="line">    tr[rt].rmax= <span class="built_in">max</span> (tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].rmax, tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>].rmax);</span><br><span class="line">    tr[rt].dat = <span class="built_in">max</span> (<span class="built_in">max</span>(tr[rt&lt;&lt;<span class="number">1</span>].dat, tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].dat), tr[rt&lt;&lt;<span class="number">1</span>].rmax + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lmax);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[rt].l = l, tr[rt].r = r;</span><br><span class="line">    <span class="keyword">if</span>(l==r) &#123;</span><br><span class="line">        FastIO::<span class="built_in">cin</span>&gt;&gt;in;</span><br><span class="line">        tr[rt].dat = tr[rt].sum = tr[rt].lmax = tr[rt].rmax = in;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build (lson);</span><br><span class="line">    build (rson);</span><br><span class="line">    update (rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> node <span class="title">query</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> tr[rt];</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &gt;  mid) <span class="keyword">return</span> query (rson, ql, qr);</span><br><span class="line">    <span class="keyword">if</span> (qr &lt;= mid) <span class="keyword">return</span> query (lson, ql, qr);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        node ans,a,b;</span><br><span class="line">        a = query (lson,ql,qr);</span><br><span class="line">        b = query (rson,ql,qr);</span><br><span class="line">        ans.sum = a.sum + b.sum;</span><br><span class="line">        ans.dat = <span class="built_in">max</span> (a.dat, a.rmax + b.lmax), ans.dat = <span class="built_in">max</span> (ans.dat, b.dat);</span><br><span class="line">        ans.lmax= <span class="built_in">max</span> (a.lmax, a.sum + b.lmax);</span><br><span class="line">        ans.rmax= <span class="built_in">max</span> (b.rmax, b.sum + a.rmax);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">work</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> to, <span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tr[rt].l == tr[rt].r) &#123;</span><br><span class="line">        tr[rt].sum = tr[rt].lmax = tr[rt].rmax = tr[rt].dat = val; <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (tr[rt].l + tr[rt].r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (to &lt;= mid) work (rt&lt;&lt;<span class="number">1</span>, to, val);</span><br><span class="line">    <span class="keyword">else</span> work (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, to, val);</span><br><span class="line">    update(rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> FastIO;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen (&quot;nico.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    build (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">while</span> (m --) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; opt &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        <span class="keyword">if</span> (opt) <span class="built_in">cout</span> &lt;&lt; query (<span class="number">1</span>, <span class="number">1</span>, n, x, y).dat &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">else</span> work (<span class="number">1</span>,x,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GSS </tag>
            
            <tag> segment tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SP2916 GSS5 - Can you answer these queries V</title>
      <link href="/GSS5/"/>
      <url>/GSS5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>GSS4 - Can you answer these queries V<br><a href="https://www.luogu.org/problemnew/show/SP2916">Luogu</a><br><a href="https://vjudge.net/problem/SPOJ-GSS5">Vjudge</a></p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (2)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;sse3&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>,<span class="meta-string">&quot;sse&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse4&quot;</span>,<span class="meta-string">&quot;sse4.1&quot;</span>,<span class="meta-string">&quot;sse4.2&quot;</span>,<span class="meta-string">&quot;ssse3&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS], *p1 = buf, *p2 = buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &#123;<span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>; c = gc();&#125;</span><br><span class="line">    <span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x &lt;&lt; <span class="number">3</span>) + (x &lt;&lt; <span class="number">1</span>) + (c ^ <span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line">    <span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0l</span>l) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>), x = -x;</span><br><span class="line">    write (x), <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dmax 40001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) ((y)^=(x)^=(y)^=(x)) </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> sum, lmax, rmax, dat;</span><br><span class="line">&#125; tr[dmax], null;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; <span class="title">max</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; x,<span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span>&amp; y)</span> </span>&#123;<span class="keyword">return</span> x&gt;y? x:y;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(<span class="keyword">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> lson = rt&lt;&lt;<span class="number">1</span>, rson = rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>;</span><br><span class="line">    tr[rt].sum = tr[lson].sum + tr[rson].sum;</span><br><span class="line">    tr[rt].lmax= max (tr[lson].lmax, tr[lson].sum + tr[rson].lmax);</span><br><span class="line">    tr[rt].rmax= max (tr[rson].rmax, tr[rson].sum + tr[lson].rmax);</span><br><span class="line">    tr[rt].dat = max (max(tr[lson].dat, tr[rson].dat), tr[lson].rmax + tr[rson].lmax);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    tr[rt].l = l, tr[rt].r = r;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;tr[rt].dat = tr[rt].sum = tr[rt].lmax = tr[rt].rmax = read (); <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    build (rt&lt;&lt;<span class="number">1</span>, l, mid), build (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">    update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> node <span class="title">query</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> l = tr[rt].l, r = tr[rt].r;</span><br><span class="line">    <span class="keyword">if</span> (ql &gt; qr) <span class="keyword">return</span> null;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; qr &gt;= r) <span class="keyword">return</span> tr[rt];</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &gt;  mid) <span class="keyword">return</span> query (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,ql,qr);</span><br><span class="line">    <span class="keyword">if</span> (qr &lt;= mid) <span class="keyword">return</span> query (rt&lt;&lt;<span class="number">1</span>, ql, qr);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">register</span> node ret, a, b;</span><br><span class="line">        a = query (rt&lt;&lt;<span class="number">1</span>, ql, qr), b = query (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, ql, qr);</span><br><span class="line">        ret.sum = a.sum + b.sum;</span><br><span class="line">        ret.dat = max (a.dat, a.rmax + b.lmax), ret.dat = max (ret.dat, b.dat);</span><br><span class="line">        ret.lmax= max (a.lmax, a.sum + b.lmax), ret.rmax= max (b.rmax, b.sum + a.rmax);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">modify</span> <span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> to, <span class="keyword">long</span> <span class="keyword">long</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tr[rt].l == tr[rt].r) &#123;tr[rt].sum = tr[rt].lmax = tr[rt].rmax = tr[rt].dat = val; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> mid = (tr[rt].l + tr[rt].r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (to &lt;= mid) modify (rt&lt;&lt;<span class="number">1</span>, to, val);</span><br><span class="line">    <span class="keyword">else</span> modify (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, to, val);</span><br><span class="line">    update(rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> _ = read ();</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> x1, y1, x2, y2;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> n, m;</span><br><span class="line">    <span class="keyword">register</span> node a, b, c;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> tmp;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">char</span> opt;</span><br><span class="line">    <span class="keyword">while</span> (_ --)</span><br><span class="line">    &#123;</span><br><span class="line">        n = read ();<span class="comment">//, m = read ();</span></span><br><span class="line">        build (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">        m = read ();</span><br><span class="line">        <span class="keyword">while</span> (m --)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//opt = &#x27;z&#x27;;</span></span><br><span class="line">            <span class="comment">//while ((opt ^ &#x27;C&#x27;) &amp;&amp; (opt ^ &#x27;Q&#x27;)) opt = gc();</span></span><br><span class="line">            <span class="comment">//if (opt ^ &#x27;C&#x27;)</span></span><br><span class="line">            &#123;</span><br><span class="line">                x1 = read (), y1 = read (), x2 = read (), y2 = read ();</span><br><span class="line">                <span class="keyword">if</span> (y1&lt;x1) swap(x1,y1); <span class="keyword">if</span> (y2&lt;x2) swap(x2,y2);</span><br><span class="line">                <span class="keyword">if</span> (x1&gt;y2) swap(x1,x2), swap(y1,y2);</span><br><span class="line">                <span class="keyword">if</span> (y1 &lt; x2) &#123;</span><br><span class="line">                    writelen (max(query(<span class="number">1</span>,x1,y1<span class="number">-1</span>).rmax, <span class="number">0</span>) + query(<span class="number">1</span>,y1,x2).sum + max(query(<span class="number">1</span>,x2+<span class="number">1</span>,y2).lmax, <span class="number">0</span>));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    a = query (<span class="number">1</span>, x2, y1), b = query(<span class="number">1</span>,x1,x2<span class="number">-1</span>), c = query(<span class="number">1</span>,y1+<span class="number">1</span>,y2);</span><br><span class="line">                    tmp = a.dat;</span><br><span class="line">                    tmp = max (tmp, a.lmax + b.rmax);</span><br><span class="line">                    tmp = max (tmp, c.lmax + a.rmax);</span><br><span class="line">                    tmp = max (tmp, a.sum + max(<span class="number">0</span>, b.rmax) + max(<span class="number">0</span>, c.lmax));</span><br><span class="line">                    writelen (tmp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">//else &#123;x1 = read (), tmp = read (); modify (1, x1, tmp);&#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GSS </tag>
            
            <tag> segment tree </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nescafé17 守卫者的挑战</title>
      <link href="/Nescafe17-Defenders&#39;-Challenge/"/>
      <url>/Nescafe17-Defenders&#39;-Challenge/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Nescafé17 守卫者的挑战</p></blockquote><a id="more"></a><h2 id="守卫者的挑战"><a href="#守卫者的挑战" class="headerlink" title="守卫者的挑战"></a>守卫者的挑战</h2><h3 id="Description"><a href="#Description" class="headerlink" title="[Description]"></a>[Description]</h3><p>打开了黑魔法师Vani的大门,队员们在迷宫般的路上漫无目的地搜寻着关押applepi的监狱的所在地.突然,眼前一道亮光闪过.“我,Nizem,是黑魔法圣殿的守卫者.如果你能通过我的挑战,那么你可以带走黑魔法圣殿的地图……”瞬间,队员们被传送到了一个擂台上,最初身边有一个容量为K的包包.</p><p>擂台赛一共有项挑战,各项挑战依次进行.第项挑战有一个属性ai,如果ai≥0,表示这次挑战成功后可以再获得一个容量为ai的包包；如果ai = -1,则表示这次挑战成功后可以得到一个大小为 1 的地图残片.地图残片必须装在包包里才能带出擂台,包包没有必要全部装满,但是队员们必须把获得的所有的地图残片都带走（没有得到的不用考虑,只需要完成所有N项挑战后背包容量足够容纳地图残片即可）,才能拼出完整的地图.并且他们至少要挑战成功L次才能离开擂台.</p><p>队员们一筹莫展之时,善良的守卫者Nizem帮忙预估出了每项挑战成功的概率,其中第i项挑战成功的概率为pi%.现在，请你帮忙预测一下，队员们能够带上他们获得的地图残片离开擂台的概率.</p><h3 id="Data-Size"><a href="#Data-Size" class="headerlink" title="[Data Size]"></a>[Data Size]</h3><p>对于 100% 的数据,保证 $ 0≤K≤2000$ , $ 0≤N≤200$ , $-1≤ai≤1000$ , $0≤L≤N$ , $0≤pi≤100$ .</p><h3 id="Solution"><a href="#Solution" class="headerlink" title="[Solution]"></a>[Solution]</h3><p>刚看到此题时,我被那个概率吓得半死.但看了数据范围,此题就是一道很简单的水题了.</p><p>对于可以赢l把以上并且背包不会溢出的概率 $P_0$ ,通过枚举结束时的背包容量和赢的次数快速求出:</p><p>$$ P_0=\sum_{i=l}^{n}\sum_{j=0}^{K}P_{i, j} $$</p><p>而 $P_{i, j}$ 可以通过刷表法 $O(n^2K)≈8*10^7$ 地求出:</p><p>定义状态 $dp[i][j][k]$ 代表达到第$i$场胜$j$场背包容量为$k$时的概率,转移方程很显然为本次成功的概率和本次失败的概率之和:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j][k] += dp[i<span class="number">-1</span>][j][k] * (<span class="number">1</span> - dat[i].dat);</span><br><span class="line"><span class="keyword">if</span> ((tmp = <span class="built_in">min</span> (K + dat[i].opt, n)) &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">dp[i][j+<span class="number">1</span>][tmp] += dp[i<span class="number">-1</span>][j][k] * dat[i].dat;</span><br></pre></td></tr></table></figure><p>这个时间复杂度看起来很悬,未免会有稍作优化的想法.本题K的范围2000,但是真的需要2000吗?共有N项挑战,对于每一项挑战最多可以获得一块地图残片,所以背包实际的最大容量就是N次挑战中所有类型-1的数量,极限情况下是n,这样复杂度就会降到 $O(n^3)$, 较为稳妥.</p><h3 id="Code"><a href="#Code" class="headerlink" title="[Code]"></a>[Code]</h3><p>考场代码,写得略丑,请谅解.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">getdou</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">double</span> x=<span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x * <span class="number">10</span> + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">double</span> s = <span class="number">0.1</span>, c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = x + (c-<span class="string">&#x27;0&#x27;</span>)*s, s/=<span class="number">10</span>, c = gc ();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">min</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span></span>&#123;<span class="keyword">return</span> a&lt;b? a:b;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> opt;</span><br><span class="line"><span class="keyword">double</span> dat;</span><br><span class="line">&#125; dat[<span class="number">201</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span> <span class="params">(node a, node b)</span> </span>&#123;<span class="keyword">return</span> a.opt &gt; b.opt;&#125;</span><br><span class="line"><span class="keyword">double</span> dp[<span class="number">201</span>][<span class="number">201</span>][<span class="number">201</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">freopen (<span class="string">&quot;guard.in&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">freopen (<span class="string">&quot;guard.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n = read (), l = read (), k = read (), tmp;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) dat[i].dat = getdou()/<span class="number">100</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) dat[i].opt = read ();</span><br><span class="line"><span class="built_in">std</span>::sort (dat + <span class="number">1</span>, dat + n + <span class="number">1</span>, cmp);</span><br><span class="line"></span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>][min(n, k)] = <span class="number">1.0</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; ++ j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> K = <span class="number">0</span>; K &lt;= n; ++ K)</span><br><span class="line">&#123;</span><br><span class="line">dp[i][j][K] += dp[i<span class="number">-1</span>][j][K] * (<span class="number">1</span> - dat[i].dat);</span><br><span class="line"><span class="keyword">if</span> ((tmp = min (K + dat[i].opt, n)) &lt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">dp[i][j+<span class="number">1</span>][tmp] += dp[i<span class="number">-1</span>][j][K] * dat[i].dat;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">double</span> ans = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = l; i &lt;= n; ++ i)</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= n; ++ j)</span><br><span class="line">ans += dp[n][i][j];</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;%.6lf&quot;</span>, ans);</span><br><span class="line"></span><br><span class="line">fclose (<span class="built_in">stdin</span>), fclose (<span class="built_in">stdout</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Cena评测$0.03s$,效率还是可以的.<br><img src="https://novaellias.files.wordpress.com/2018/11/guard.png" class="lazyload" data-srcset="https://novaellias.files.wordpress.com/2018/11/guard.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="guard"></p>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> contest </tag>
            
            <tag> DP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STL 洛谷P3369 普通平衡树</title>
      <link href="/lg-P3369-STL/"/>
      <url>/lg-P3369-STL/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://www.luogu.org/problemnew/show/P3369">luogu P3369 普通平衡树</a><br>STL 实现</p></blockquote><a id="more"></a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// luogu-judger-enable-o2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; c ^ <span class="string">&#x27;-&#x27;</span>) c = gc();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc();</span><br><span class="line">    <span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line">    <span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">if</span>(x&lt;<span class="number">0</span>) x=-x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);write (x);<span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; eli;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">register</span> <span class="keyword">int</span> n = read (), x, opt;</span><br><span class="line">    <span class="keyword">while</span> (n --)</span><br><span class="line">    &#123;</span><br><span class="line">        opt = read (), x = read ();</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) eli.insert(upper_bound(eli.begin(), eli.end(), x), x);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">2</span>) eli.erase(lower_bound(eli.begin(), eli.end(), x));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">3</span>) writelen(lower_bound(eli.begin(), eli.end(), x)-eli.begin()+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">4</span>) writelen(eli[x - <span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">5</span>) writelen(*--lower_bound(eli.begin(), eli.end(), x));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (opt == <span class="number">6</span>) writelen(*upper_bound(eli.begin(), eli.end(), x));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SP2885 WORDRING - Word Rings</title>
      <link href="/SP2885-WORDRING-World-Rings/"/>
      <url>/SP2885-WORDRING-World-Rings/</url>
      
        <content type="html"><![CDATA[<blockquote><p>SP2885 WORDRING - Word Rings</p></blockquote><a id="more"></a><p>本题求平均环长,可以将每个字符串的前后两个字符看做点,这两个点存在于一个字符串的关系视为一条边,接着二分枚举答案(单调性是很显然的),用队列优化BellmanFord判断即可.</p><p>关键代码:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> __fastcall <span class="title">spfa_dfs</span> <span class="params">(Re <span class="keyword">int</span> fr, Re <span class="keyword">double</span> mid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vis[fr] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> to;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = head[fr]; i; i = nxt[i])</span><br><span class="line">&#123;</span><br><span class="line">to = too[i];</span><br><span class="line"><span class="keyword">if</span> (dis[fr] + wei[i] - mid &gt; dis[to])</span><br><span class="line">&#123;</span><br><span class="line">dis[to] = dis[fr] + wei[i] - mid;</span><br><span class="line"><span class="keyword">if</span> (vis[to] || spfa_dfs(to, mid))</span><br><span class="line">&#123;vis[fr] = <span class="literal">false</span>; <span class="keyword">return</span> <span class="literal">true</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">vis[fr] = <span class="literal">false</span>; <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">judge</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">double</span> mid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">memset</span> (dis, <span class="number">0</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= hhsh; ++ i)</span><br><span class="line"><span class="keyword">if</span> (spfa_dfs (i, mid)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">n = read (); <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span> (head, <span class="number">0</span>, <span class="keyword">sizeof</span> head);</span><br><span class="line"><span class="built_in">memset</span> (hash, <span class="number">0</span>, <span class="keyword">sizeof</span> hash);</span><br><span class="line">ecnt = hhsh = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (n --)</span><br><span class="line">&#123;</span><br><span class="line">c = gc(), len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (c == <span class="string">&#x27;\n&#x27;</span> || c == <span class="string">&#x27;\r&#x27;</span>) c = gc ();</span><br><span class="line"><span class="keyword">while</span> ((c != <span class="string">&#x27;\n&#x27;</span>) &amp;&amp; (c != <span class="string">&#x27;\r&#x27;</span>)) s[++ len] = c, c = gc();</span><br><span class="line">fr = calc(s[<span class="number">1</span>], s[<span class="number">2</span>]), to = calc(s[len<span class="number">-1</span>], s[len]);</span><br><span class="line"><span class="keyword">if</span> (!hash[fr]) hash[fr] = ++ hhsh;</span><br><span class="line"><span class="keyword">if</span> (!hash[to]) hash[to] = ++ hhsh;</span><br><span class="line">addedge (hash[fr], hash[to], len);</span><br><span class="line">&#125;</span><br><span class="line">l = <span class="number">0.0</span>, r = <span class="number">1000.0</span>;</span><br><span class="line"><span class="keyword">while</span> (r - l &gt;= eps)</span><br><span class="line">&#123;</span><br><span class="line">mid = (l + r) / <span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span> (judge(mid)) l = mid;</span><br><span class="line"><span class="keyword">else</span> r = mid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l == <span class="number">0</span>) <span class="built_in">puts</span> (<span class="string">&quot;No solution.&quot;</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span> (<span class="string">&quot;%.2lf\n&quot;</span>, l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>祝大家 <code>RP++</code> !</p>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CF372B Counting Rectangles is Fun</title>
      <link href="/CF372B-Counting-Rectangles-is-Fun/"/>
      <url>/CF372B-Counting-Rectangles-is-Fun/</url>
      
        <content type="html"><![CDATA[<blockquote><p>CF372B Counting Rectangles is Fun</p></blockquote><a id="more"></a><h3 id="NULL-Problem"><a href="#NULL-Problem" class="headerlink" title="NULL Problem :"></a>NULL Problem :</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>给定一个${n* m}$的01矩阵, q次询问, 每次询问指定一个子矩形, 求该子矩形种有多少个只包含0的子矩阵.<br>矩阵从上到下编号1<del>n, 从左到右编号1</del>m.</p><h4 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h4><p>第一行三个整数n,m,q. 接下来n行, 每行m个整数描述该矩阵. 接下来q行, 每行四个整数a,b,c,d表示询问的子矩阵左上角为(a,b), 右下角为(c,d).</p><h4 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h4><p>对于每个询问, 输出一个整数表示答案.</p><h3 id="EINS-Solution"><a href="#EINS-Solution" class="headerlink" title="EINS Solution"></a>EINS Solution</h3><p>看到本题很小的数据范围 ${1&lt;=n,m&lt;=40}$ , 内心或许会萌发一些类似于把整张图状压的想法. 但看到时限是 ${4s}$ , 当然会想到本题可以使用暴力求解.</p><p>本题要求两个点之间共有多少个全部为0的子矩阵,q的范围高达${3* 10^5}$, 不难想到, 可以通过暴力的dp打出表然后${O(1)}$查询.</p><p>令${dp[x1][y1][x2][y2]}$表示从(x1, y1)到(x2, y2)的答案, 不难得到状态转移方程:</p><p>约定${x1&lt;=x2, y1&lt;=y2}$</p><p>${dp[x1][y1][x2][y2]=dp[x1][y1][x2-1][y2]+dp[x1][y1][x2][y2-1]-dp[x1][y1][x2-1][y2-1]}$</p><p>${dp[x1][y1][x2][y2] +=}$ 该区域内能获得的矩形数量</p><h3 id="ZWEI-Code"><a href="#ZWEI-Code" class="headerlink" title="ZWEI Code"></a>ZWEI Code</h3><p>代码就比较好写:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n = read (), m = read (), _ = read (), nico;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++ j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span> (<span class="string">&quot;%1d&quot;</span>, &amp;nico);</span><br><span class="line"><span class="keyword">if</span> (nico) lin[i][j] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> lin[i][j] = lin[i<span class="number">-1</span>][j] + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> frx = <span class="number">1</span>; frx &lt;= n; ++ frx)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> fry = <span class="number">1</span>; fry &lt;= m; ++ fry)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> tox = frx; tox &lt;= n; ++ tox)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> toy = fry; toy &lt;= m; ++ toy)</span><br><span class="line">&#123;</span><br><span class="line">ans[frx][fry][tox][toy] = ans[frx][fry][tox<span class="number">-1</span>][toy] + ans[frx][fry][tox][toy<span class="number">-1</span>] - ans[frx][fry][tox<span class="number">-1</span>][toy<span class="number">-1</span>];</span><br><span class="line">nico = tox - frx + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> k = toy; k &gt;= fry; -- k)</span><br><span class="line">&#123;</span><br><span class="line">nico = min (nico, lin[tox][k]);</span><br><span class="line">ans[frx][fry][tox][toy] += nico;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (_ --) writelen (ans[read()][read()][read()][read()]);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UVA1714 Keyboarding</title>
      <link href="/UVA1714-Keyboarding/"/>
      <url>/UVA1714-Keyboarding/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ACM-ICPC World Final: UVA1714 Keyboarding</p></blockquote><a id="more"></a><h3 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h3><p>这道题居然是<code>ACM-ICPC World Final</code>的题目</p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>给定一个r行c列的在屏幕上的“虚拟键盘”，我们需要通过“上，下，左，右，选择”5个控制键来移动屏幕上的光标来打印文本。一开始，光标在键盘的左上 角，每次按方向键，光标总是跳到下一个在该方向上与当前位置不同的字符，若不存在则不移动。每次按选择键，则将光标所在位置的字符打印出来。<br>现在求打印给定文本（要在结尾打印换行符）的最少按键次数。</p><h4 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h4><p>第一行输入${r,c(1≤r,c≤50)}$</p><p>接下来给出一个 ${r* c}$ 的键盘，包括大写字母，数字，横线以及星号（星号代表${Enter}$换行） 最后一行是要打印的文本串s，s的长度不超过10000.</p><h4 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h4><p>输出打印文本（包括结尾换行符）的最少按键次数。保证一定有解。</p><p>Sample Input</p><p>2 19</p><p>ABCDEFGHIJKLMNOPQZY</p><p>X*****Y</p><p>AZAZ</p><p>Sample Output</p><p>19</p><p>注:　部分内容被省略　数据可能有多组</p><h3 id="EINS"><a href="#EINS" class="headerlink" title="EINS"></a>EINS</h3><p>用<code>nxt[][]</code>维护向四个方向能到的第一个非当前点字符的位置</p><p>BFS容器维护四个值:<code>nowx</code> 当前x坐标 <code>nowy</code> 当前y坐标 <code>ste</code> 当前有效字符长度 <code>sum</code> 总步数</p><p>先查看当前扩展的字符是否有效,有效则直接入队,判断是否结束,无效则考虑向周围移动.</p><h3 id="ZWEI"><a href="#ZWEI" class="headerlink" title="ZWEI"></a>ZWEI</h3><p>直接上代码</p><ul><li><p><code>next</code> 处理部分</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (rint i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (rint j = <span class="number">1</span>; j &lt;= m; j ++)</span><br><span class="line">&#123;</span><br><span class="line">ch = dat[i][j];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dat[i<span class="number">-1</span>][j] != ch) nxt[i][j][<span class="number">0</span>] = <span class="built_in">make_pair</span> (i<span class="number">-1</span>, j);</span><br><span class="line"><span class="keyword">else</span> nxt[i][j][<span class="number">0</span>] = nxt[i<span class="number">-1</span>][j][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (rint k = i + <span class="number">1</span>; k &lt;= n; k ++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dat[k][j] != ch) &#123;nxt[i][j][<span class="number">1</span>] = <span class="built_in">make_pair</span> (k, j); <span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (dat[i][j<span class="number">-1</span>] != ch) nxt[i][j][<span class="number">2</span>] = <span class="built_in">make_pair</span> (i, j<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">else</span> nxt[i][j][<span class="number">2</span>] = nxt[i][j<span class="number">-1</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (rint k = j + <span class="number">1</span>; k &lt;= m; k ++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dat[i][k] != ch) &#123;nxt[i][j][<span class="number">3</span>] = <span class="built_in">make_pair</span> (i, k); <span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>左和上直接继承,右侧暴力枚举,顺便更新路过的点也可以,但是<del>我太菜了</del>没写</p></li><li><p>比较基本的BFS</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!que.empty())</span><br><span class="line">&#123;</span><br><span class="line">fr = que.front(), que.pop ();</span><br><span class="line">nowx = fr.x, nowy = fr.y, nste = fr.ste, nsum = fr.sum;</span><br><span class="line"><span class="keyword">if</span> (dat[nowx][nowy] == s[nste + <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">que.push ((node) &#123;nowx, nowy, nste + <span class="number">1</span>, nsum + <span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">if</span> (nste + <span class="number">1</span> == lens) &#123;<span class="built_in">printf</span> (<span class="string">&quot;%d\n&quot;</span>, nsum + <span class="number">1</span>); <span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i ++)</span><br><span class="line">&#123;</span><br><span class="line">gox = nxt[nowx][nowy][i].first, goy = nxt[nowx][nowy][i].second;</span><br><span class="line"><span class="keyword">if</span>(!gox || !goy) <span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> (vis[gox][goy] &lt; nste) &#123; vis[gox][goy] = nste; que.push ((node)&#123;gox, goy, nste, nsum + <span class="number">1</span>&#125;);&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="DREI"><a href="#DREI" class="headerlink" title="DREI"></a>DREI</h3><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul><li>可能有多组数据</li><li>最后不要忘记打空格</li><li>小心字符串的输入和各种换行符</li><li>留心初始化</li></ul><h3 id="VIER"><a href="#VIER" class="headerlink" title="VIER"></a>VIER</h3><p>最后,祝大家 <code>RP ++</code></p>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Luogu P4289 [HAOI2008]移动玩具</title>
      <link href="/Luogu-P4289/"/>
      <url>/Luogu-P4289/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Luogu P4289 [HAOI2008]移动玩具</p></blockquote><a id="more"></a><h3 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h3><p>在一个4*4的方框内摆放了若干个相同的玩具，某人想将这些玩具重新摆放成为他心中理想的状态，规定移动时只能将玩具向上下左右四个方向移动，并且移动的位置不能有玩具，请你用最少的移动次数将初始的玩具状态移动到某人心中的目标状态。</p><h3 id="EINS"><a href="#EINS" class="headerlink" title="EINS"></a>EINS</h3><p>很显然地发现,这道题搜索树的深度几乎是无穷的,易于想到用BFS求解. ${4 * 4}$的方阵,总共状态的个数不过 ${65535}$ 种,这告诉我们很普通的BFS就能AC本题.看到题目中每个节点的状态只有 ${0, 1}$ 两种,不难想到使用二位(二进制)哈希判重.队列手写,减小一些常数.</p><h3 id="ZWEI"><a href="#ZWEI" class="headerlink" title="ZWEI"></a>ZWEI</h3><p>每个状态的容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct StandNode</span><br><span class="line">&#123;</span><br><span class="line">bool a[16];</span><br><span class="line"></span><br><span class="line">inline int get_hash ()</span><br><span class="line">&#123;</span><br><span class="line">register int ret &#x3D; a[0];</span><br><span class="line">for (rint i &#x3D; 1; i &lt;&#x3D; 15; i ++) ret &#x3D; (ret&lt;&lt;1) + a[i];</span><br><span class="line">return ret;</span><br><span class="line">&#125;</span><br><span class="line">&#125; nico_STA, nico_FIN;</span><br></pre></td></tr></table></figure><p><code>get_hash()</code> 用来求解每个状态的哈希值, <code>nico_STA</code> 和 <code>nico_nico_FIN</code> 存储初始状态和结束状态.</p><p>队列元素</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">QueueNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">StandNode a;</span><br><span class="line"><span class="keyword">int</span> ste;</span><br><span class="line">&#125; que[<span class="number">65537</span>];</span><br></pre></td></tr></table></figure><p>存储当前状态和步数</p><p>主程序</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">input ();</span><br><span class="line"><span class="keyword">int</span> FIN = nico_FIN.get_hash();</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>, diff, xpos, kiana;</span><br><span class="line">que[tail].a = nico_STA;</span><br><span class="line">sjb[nico_STA.get_hash()] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (head &lt; tail)</span><br><span class="line">&#123;</span><br><span class="line">head ++;</span><br><span class="line"><span class="keyword">if</span> (que[head].a.get_hash() == FIN)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;%d&quot;</span>, que[head].ste);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; i ++) nico_bfswork (i, i % <span class="number">4</span>, head, tail);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span> (<span class="string">&quot;No Solution&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BFS操作函数</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">nico_bfswork</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">int</span> diff, <span class="keyword">register</span> <span class="keyword">int</span> xpos, <span class="keyword">register</span> <span class="keyword">int</span> head, <span class="keyword">register</span> <span class="keyword">int</span> &amp;tail)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> StandNode ellias; <span class="keyword">register</span> <span class="keyword">int</span> kiana;</span><br><span class="line"><span class="keyword">if</span> (xpos &amp;&amp; !que[head].a.a[diff - <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff - <span class="number">1</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (xpos &lt;= <span class="number">2</span> &amp;&amp; !que[head].a.a[diff + <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff + <span class="number">1</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (diff &gt;= <span class="number">4</span> &amp;&amp; !que[head].a.a[diff - <span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff - <span class="number">4</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (diff &lt;= <span class="number">11</span> &amp;&amp; !que[head].a.a[diff + <span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff + <span class="number">4</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>枚举四种方向, 判断是否可行, 加入队列. 特别提醒: <code>tail</code> 一定要取地址</p><h3 id="DREI"><a href="#DREI" class="headerlink" title="DREI"></a>DREI</h3><p>代码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rint register int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) ((y)^=(x)^=(y)^=(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gc() getchar()</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">StandNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">bool</span> a[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get_hash</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> ret = a[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i ++) ret = (ret&lt;&lt;<span class="number">1</span>) + a[i];</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">&#125; nico_STA, nico_FIN;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">QueueNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">StandNode a;</span><br><span class="line"><span class="keyword">int</span> ste;</span><br><span class="line">&#125; que[<span class="number">65537</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">input</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">char</span> c[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (rint t = <span class="number">1</span>; t &lt;= <span class="number">4</span>; t ++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span> (<span class="string">&quot;%s&quot;</span>, c);</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i ++) nico_STA.a[pos ++] = c[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (rint t = <span class="number">1</span>; t &lt;= <span class="number">4</span>; t ++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">scanf</span> (<span class="string">&quot;%s&quot;</span>, c);</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i ++) nico_FIN.a[pos ++] = c[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> &lt;<span class="keyword">int</span>, <span class="keyword">bool</span>&gt; sjb;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">nico_bfswork</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">int</span> diff, <span class="keyword">register</span> <span class="keyword">int</span> xpos, <span class="keyword">register</span> <span class="keyword">int</span> head, <span class="keyword">register</span> <span class="keyword">int</span> &amp;tail)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> StandNode ellias; <span class="keyword">register</span> <span class="keyword">int</span> kiana;</span><br><span class="line"><span class="keyword">if</span> (xpos &amp;&amp; !que[head].a.a[diff - <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff - <span class="number">1</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (xpos &lt;= <span class="number">2</span> &amp;&amp; !que[head].a.a[diff + <span class="number">1</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff + <span class="number">1</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (diff &gt;= <span class="number">4</span> &amp;&amp; !que[head].a.a[diff - <span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff - <span class="number">4</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (diff &lt;= <span class="number">11</span> &amp;&amp; !que[head].a.a[diff + <span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">ellias = que[head].a, swap (ellias.a[diff], ellias.a[diff + <span class="number">4</span>]);</span><br><span class="line">kiana = ellias.get_hash ();</span><br><span class="line"><span class="keyword">if</span> (!sjb[kiana]) que[++ tail].a = ellias, que[tail].ste = que[head].ste + <span class="number">1</span>, sjb[kiana] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">input ();</span><br><span class="line"><span class="keyword">int</span> FIN = nico_FIN.get_hash();</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>, diff, xpos, kiana;</span><br><span class="line">que[tail].a = nico_STA;</span><br><span class="line">sjb[nico_STA.get_hash()] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">while</span> (head &lt; tail)</span><br><span class="line">&#123;</span><br><span class="line">head ++;</span><br><span class="line"><span class="keyword">if</span> (que[head].a.get_hash() == FIN)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;%d&quot;</span>, que[head].ste);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; i ++) nico_bfswork (i, i % <span class="number">4</span>, head, tail);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span> (<span class="string">&quot;No Solution&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CF749E Inversions After Shuffle</title>
      <link href="/CF749E-Inversions-After-Shuffle/"/>
      <url>/CF749E-Inversions-After-Shuffle/</url>
      
        <content type="html"><![CDATA[<blockquote><p>CF749E Inversions After Shuffle<br>给出一个1~n的排列,从中等概率抽取一个连续的片段,并对其进行等概率全排列,求排列后整个序列的逆序对的期望个数.</p></blockquote><a id="more"></a><h3 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h3><p>给出一个1~n的排列,从中等概率抽取一个连续的片段,并对其进行等概率全排列,求排列后整个序列的逆序对的期望个数.</p><h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p>设所选的区间长度为l,考虑一个有序数对 ${a_i,a_j (i&lt;j)}$ 并计算其贡献.<br>这样一来,就有两种情况:</p><ol><li>${a_i,a_j}$在所选的连续段中</li><li>${a_i,a_j}$在所选的连续段之外</li></ol><p>对于情况2,当${a_i&lt;a_j}$时,很显然他们不会对答案有贡献.对于${a_i&gt;a_j}$,对于区间 ${[1,j-1],[i+1,n]}$ 才会有贡献.但很显然地看到,区间 ${[i+1,j-1]}$ 被重复计算,要在计算概率时将其剪掉.如果使用 ${O(n^2)}$暴力显然会超时,可以将其用树状数组维护.</p><p>对于情况1就很简单,满足全排列概率为${\frac{1}{2}}$,满足连续段包含关系的概率为 ${2<em>\frac{i</em>(n-j+1)}{n*(n+1)}}$,概率相乘结果</p><p>$${P_{i,j}=\frac{i*(n-j+1)}{n*(n+1)}}$$</p><p>那么总期望为</p><p>$${P=\sum_{i=1}^n\sum_{j=i+1}^n \frac{i*(n-j+1)}{n*(n+1)}}$$</p><p>$${P=\frac{1}{2}\sum_{i=1}^n \frac{i*(n-i)<em>(n-i+1)}{n</em>(n+1)}}$$</p><h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3><p>加入操作</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span> <span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> w, ll *c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">while</span> (x) &#123; c[x] += w, x &amp;= x<span class="number">-1</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>询问操作</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">query</span> <span class="params">(<span class="keyword">int</span> x, ll *c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (x&lt;=n) &#123;</span><br><span class="line">ret += c[x], x += lowbit(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主程序</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">n = read();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">&#123;</span><br><span class="line">a = read();</span><br><span class="line">tmp += query (a+<span class="number">1</span>, c1);</span><br><span class="line">ans -= (<span class="keyword">double</span>)query(a+<span class="number">1</span>, c2)*(n-i+<span class="number">1</span>);</span><br><span class="line">ans += (<span class="keyword">double</span>)(n-i+<span class="number">1</span>)*i*(i<span class="number">-1</span>)/<span class="number">4.0</span>;</span><br><span class="line">add (a, <span class="number">1</span>, c1); add (a, i, c2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;%.20lf&quot;</span>, (<span class="keyword">double</span>)(tmp+ans/((<span class="keyword">double</span>)n*(n+<span class="number">1</span>)/<span class="number">2.0</span>)));</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>洛谷 P1654 OSU!</title>
      <link href="/Luogu-P1654-OSU/"/>
      <url>/Luogu-P1654-OSU/</url>
      
        <content type="html"><![CDATA[<blockquote><p>洛谷 P1654 OSU! 滚动数组</p></blockquote><a id="more"></a><h3 id="本题可以使用滚动数组进一步优化空间"><a href="#本题可以使用滚动数组进一步优化空间" class="headerlink" title="本题可以使用滚动数组进一步优化空间."></a>本题可以使用滚动数组进一步优化空间.</h3><blockquote><p>空间多精贵.</p></blockquote><h4 id="订正一下本题题干"><a href="#订正一下本题题干" class="headerlink" title="订正一下本题题干:"></a>订正一下本题题干:</h4><p>小H和小Z正在玩一个取石子游戏。 取石子游戏的规则是这样的，每个人每次可以从一堆石子中取出若干个石子，每次取石子的个数有限制，谁不能取石子时就会输掉游戏。 小H先进行操作，他想问你他是否有必胜策略，如果有，第一步如何取石子。</p><h3 id="优化分析"><a href="#优化分析" class="headerlink" title="优化分析"></a>优化分析</h3><p>看到楼下大佬的代码，用庞大的数组会造成大量的内存浪费. 从算法中可以看到，一个状态只从它前一个状态转移而来，就可以使用滚动数组节约空间.</p><p>第一次使用数组取 <code>0</code> 位， 每次转移将 <code>pos ^ 1</code>. 代码如下</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i, pos ^= <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">exp</span> = !pos, k = getdou ();</span><br><span class="line">x[pos] = (x[<span class="built_in">exp</span>] + <span class="number">1</span>) * k;</span><br><span class="line">y[pos] = (y[<span class="built_in">exp</span>] + <span class="number">2</span>*x[<span class="built_in">exp</span>] + <span class="number">1</span>) * k;</span><br><span class="line">v[pos] = v[<span class="built_in">exp</span>] + (<span class="number">3</span>*x[<span class="built_in">exp</span>] + <span class="number">3</span>*y[<span class="built_in">exp</span>]+<span class="number">1</span>) * k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>洛谷 P2899 [USACO08JAN]手机网络Cell Phone Network</title>
      <link href="/Luogu-P2899-Cell-Phone-Network/"/>
      <url>/Luogu-P2899-Cell-Phone-Network/</url>
      
        <content type="html"><![CDATA[<blockquote><p>树状贪心<br>洛谷 P2899 [USACO08JAN]手机网络Cell Phone Network</p></blockquote><a id="more"></a><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>Farmer John has decided to give each of his cows a cell phone in hopes to encourage their social interaction. This, however, requires him to set up cell phone towers on his N (1 ≤ N ≤ 10,000) pastures (conveniently numbered 1..N) so they can all communicate.</p><p>Exactly N-1 pairs of pastures are adjacent, and for any two pastures A and B (1 ≤ A ≤ N; 1 ≤ B ≤ N; A ≠ B) there is a sequence of adjacent pastures such that A is the first pasture in the sequence and B is the last. Farmer John can only place cell phone towers in the pastures, and each tower has enough range to provide service to the pasture it is on and all pastures adjacent to the pasture with the cell tower.</p><p>Help him determine the minimum number of towers he must install to provide cell phone service to each pasture.</p><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>本题要求使用最少的电磁塔, 把所有的节点覆盖掉. 由 N-1 条边我们可以了解到, 这是一棵树. 从树的叶子节点向上看, 显然在儿子节点摆电磁塔是不合算的. 所以很显然地, 从最后一层向上搜索, 每遇到一个儿子节点没有被覆盖, 就在他父亲上摆一个电磁塔. 很显然, 从下向上枚举, 对于本题的数据这种方法是成立的.</p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iostream&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;vector&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rint register int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x=<span class="number">0l</span>l,t=<span class="number">1l</span>l;</span><br><span class="line">    <span class="keyword">char</span> ch=getchar();</span><br><span class="line">    <span class="keyword">while</span>((ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&amp;&amp;ch!=<span class="string">&#x27;-&#x27;</span>)ch=getchar();</span><br><span class="line">    <span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)t=<span class="number">-1</span>,ch=getchar();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;ch&gt;=<span class="string">&#x27;0&#x27;</span>)x=x*<span class="number">10</span>+ch<span class="number">-48</span>,ch=getchar();</span><br><span class="line">    <span class="keyword">return</span> x*t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> check[<span class="number">10001</span>];</span><br><span class="line"><span class="keyword">int</span> n, fa[<span class="number">10001</span>], ans, mxdp;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; mp[<span class="number">10001</span>], fl[<span class="number">10001</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span> <span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> de)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">mxdp = max (mxdp, de);</span><br><span class="line">fl[de].push_back (u);</span><br><span class="line"><span class="keyword">int</span> v;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt; mp[u].size (); ++ i)</span><br><span class="line">&#123;</span><br><span class="line">v = mp[u][i];</span><br><span class="line"><span class="keyword">if</span> (!(v ^ fa[u])) <span class="keyword">continue</span>;</span><br><span class="line">fa[v] = u;</span><br><span class="line">dfs (v, de + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">work</span> <span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">check[u] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">0</span>; i &lt; mp[u].size (); ++ i) check[mp[u][i]] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">n = read ();</span><br><span class="line"><span class="keyword">int</span> u, v;</span><br><span class="line"><span class="keyword">for</span> (rint i = <span class="number">1</span>; i &lt; n; ++ i)</span><br><span class="line">&#123;</span><br><span class="line">u = read (), v = read ();</span><br><span class="line">mp[u].push_back (v);</span><br><span class="line">mp[v].push_back (u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dfs (<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (rint i = mxdp; i &gt;= <span class="number">0</span>; -- i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (rint j = <span class="number">0</span>; j &lt; fl[i].size (); ++ j)</span><br><span class="line">&#123;</span><br><span class="line">u = fl[i][j], v = fa[u];</span><br><span class="line"><span class="keyword">if</span> (check[u]) <span class="keyword">continue</span>;</span><br><span class="line">ans ++;</span><br><span class="line">work (v);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span> (<span class="string">&quot;%d&quot;</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 贪心 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>洛谷 线段树模板</title>
      <link href="/luogu-segment-tree/"/>
      <url>/luogu-segment-tree/</url>
      
        <content type="html"><![CDATA[<blockquote><p>洛谷 线段树1 线段树2 模板</p></blockquote><a id="more"></a><h3 id="P3372-模板-线段树-1"><a href="#P3372-模板-线段树-1" class="headerlink" title="P3372 [模板] 线段树 1"></a>P3372 [模板] 线段树 1</h3><p><a href="https://www.luogu.org/problemnew/show/P3372">Luogu P3372 线段树加</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="comment">//...略</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span> </span>&#123;<span class="keyword">if</span>(x&lt;<span class="number">0</span>)x=-x,<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); write (x); <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dmax 400001</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) ((x)^=(y)^=(x)^=(y))</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SMT</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> l, r;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum, tag;</span><br><span class="line">&#125; tr[dmax];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(Re <span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">tr[rt].sum = tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">tr[rt].l = l, tr[rt].r = r;</span><br><span class="line"><span class="keyword">if</span> (l == r) &#123;tr[rt].sum = read(); <span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">build (rt&lt;&lt;<span class="number">1</span>, l, mid), build (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, r);</span><br><span class="line">update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span> <span class="params">(Re <span class="keyword">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (rt &gt; <span class="number">200000</span> || !tr[rt].tag) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> ls = rt&lt;&lt;<span class="number">1</span>, rs = rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>;</span><br><span class="line">tr[ls].tag += tr[rt].tag, tr[rs].tag += tr[rt].tag;</span><br><span class="line">tr[ls].sum += tr[rt].tag * (tr[ls].r - tr[ls].l + <span class="number">1</span>),</span><br><span class="line">tr[rs].sum += tr[rt].tag * (tr[rs].r - tr[rs].l + <span class="number">1</span>);</span><br><span class="line">tr[rt].tag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">modify</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r, Re ll val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> L = tr[rt].l, R = tr[rt].r;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= L &amp;&amp; R &lt;= r) &#123;</span><br><span class="line">tr[rt].sum += val * (R - L + <span class="number">1</span>), tr[rt].tag += val;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">register</span> <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>; pushdown (rt);</span><br><span class="line"><span class="keyword">if</span> (l &lt;= mid) modify (rt&lt;&lt;<span class="number">1</span>, l, r, val);</span><br><span class="line"><span class="keyword">if</span> (r  &gt; mid) modify (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r, val);</span><br><span class="line">update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> L = tr[rt].l, R = tr[rt].r;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= L &amp;&amp; R &lt;= r) <span class="keyword">return</span> tr[rt].sum;</span><br><span class="line">pushdown (rt); <span class="keyword">register</span> <span class="keyword">int</span> mid = (L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= mid) ret  = query (rt&lt;&lt;<span class="number">1</span>, l, r);</span><br><span class="line"><span class="keyword">if</span> (r  &gt; mid) ret += query (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n=read(), m=read();</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> opt, x, y;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> z;</span><br><span class="line">build (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line"><span class="keyword">while</span> (m --)</span><br><span class="line">&#123;</span><br><span class="line">opt=read(), x=read(), y=read();</span><br><span class="line"><span class="keyword">if</span> (x &gt; y) swap (x, y);</span><br><span class="line"><span class="keyword">if</span> (opt == <span class="number">2</span>) writelen (query (<span class="number">1</span>, x, y));</span><br><span class="line"><span class="keyword">else</span> z = read (), modify (<span class="number">1</span>, x, y, z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="P3373-模板-线段树-2"><a href="#P3373-模板-线段树-2" class="headerlink" title="P3373 [模板]线段树 2"></a>P3373 [模板]线段树 2</h3><p><a href="https://www.luogu.org/problemnew/show/P3373">Luogu P3372 加 乘</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (2)</span></span><br><span class="line"><span class="comment">//..略</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;f16c&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writelen</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span> </span>&#123;<span class="keyword">if</span>(x&lt;<span class="number">0</span>)x=-x,<span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); write (x); <span class="built_in">putchar</span> (<span class="string">&#x27;\n&#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">mul_mod</span> <span class="params">(<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> b,<span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> mo)</span> </span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret;</span><br><span class="line">__asm__ __volatile__ (<span class="string">&quot;\tmull %%ebx\n\tdivl %%ecx\n&quot;</span> : <span class="string">&quot;=d&quot;</span>(ret):<span class="string">&quot;a&quot;</span>(a),<span class="string">&quot;b&quot;</span>(b),<span class="string">&quot;c&quot;</span>(mo));</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dmax 400001</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> swap(x,y) ((x)^=(y)^=(x)^=(y))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mod(x) (((x)%modn+modn)%modn)</span></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> modn;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SMT</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> l, r;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> sum, add, mul;</span><br><span class="line">&#125; tr[dmax];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span> <span class="params">(Re <span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">tr[rt].sum = tr[rt&lt;&lt;<span class="number">1</span>].sum + tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">tr[rt] = &#123;l, r, <span class="number">0l</span>l, <span class="number">0l</span>l, <span class="number">1l</span>l&#125;;</span><br><span class="line"><span class="keyword">if</span> (l == r) &#123;tr[rt].sum = read()%modn; <span class="keyword">return</span>;&#125;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">build (rt&lt;&lt;<span class="number">1</span>, l, mid), build (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, r);</span><br><span class="line">update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span> <span class="params">(Re <span class="keyword">int</span> rt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (rt &gt; <span class="number">200000</span> || (!tr[rt].add &amp;&amp; tr[rt].mul == <span class="number">1l</span>l)) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> ls = rt &lt;&lt; <span class="number">1</span>, rs = rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>;</span><br><span class="line">tr[ls].mul = mul_mod (tr[ls].mul, tr[rt].mul, modn);</span><br><span class="line">tr[rs].mul = mul_mod (tr[rs].mul, tr[rt].mul, modn);</span><br><span class="line">tr[ls].add = mod (mul_mod (tr[ls].add , tr[rt].mul, modn) + tr[rt].add);</span><br><span class="line">tr[rs].add = mod (mul_mod (tr[rs].add, tr[rt].mul, modn) + tr[rt].add);</span><br><span class="line">tr[ls].sum = mod (mul_mod (tr[ls].sum, tr[rt].mul, modn) + mul_mod (tr[rt].add, (tr[ls].r - tr[ls].l + <span class="number">1</span>), modn));</span><br><span class="line">tr[rs].sum = mod (mul_mod (tr[rs].sum, tr[rt].mul, modn) + mul_mod (tr[rt].add, (tr[rs].r - tr[rs].l + <span class="number">1</span>), modn));</span><br><span class="line">tr[rt].add = <span class="number">0l</span>l, tr[rt].mul = <span class="number">1l</span>l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// opt==1: mul opt==2: add</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">modify</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r, Re ll val, Re <span class="keyword">int</span> opt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> L = tr[rt].l, R = tr[rt].r;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= L &amp;&amp; R &lt;= r) &#123;</span><br><span class="line"><span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">tr[rt].add = mod (tr[rt].add + val),\</span><br><span class="line">tr[rt].sum = mod (tr[rt].sum + mul_mod (val, (R - L + <span class="number">1</span>), modn));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">tr[rt].mul = mul_mod (tr[rt].mul, val, modn),\</span><br><span class="line">tr[rt].sum = mul_mod (tr[rt].sum, val, modn),\</span><br><span class="line">tr[rt].add = mul_mod (tr[rt].add, val, modn);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; pushdown (rt); <span class="keyword">register</span> <span class="keyword">int</span> mid = (L + R) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= mid) modify (rt&lt;&lt;<span class="number">1</span>, l, r, val, opt);</span><br><span class="line"><span class="keyword">if</span> (r  &gt; mid) modify (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r, val, opt);</span><br><span class="line">update (rt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span> <span class="params">(Re <span class="keyword">int</span> rt, Re <span class="keyword">int</span> l, Re <span class="keyword">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> L = tr[rt].l, R = tr[rt].r;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= L &amp;&amp; R &lt;= r) <span class="keyword">return</span> tr[rt].sum;</span><br><span class="line">pushdown (rt); <span class="keyword">register</span> <span class="keyword">int</span> mid = (L+R)&gt;&gt;<span class="number">1</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (l &lt;= mid) ret  = query (rt&lt;&lt;<span class="number">1</span>, l, r);</span><br><span class="line"><span class="keyword">if</span> (r  &gt; mid) ret += query (rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line"><span class="keyword">return</span> ret % modn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n=read(), m=read(); modn=read();</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> opt, x, y;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> z;</span><br><span class="line">build (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line"><span class="keyword">while</span> (m --)</span><br><span class="line">&#123;</span><br><span class="line">opt=read(), x=read(), y=read();</span><br><span class="line"><span class="keyword">if</span> (x &gt; y) swap (x, y);</span><br><span class="line"><span class="keyword">if</span> (opt == <span class="number">3</span>) writelen (query (<span class="number">1</span>,x,y));</span><br><span class="line"><span class="keyword">else</span> z=read()%modn,modify(<span class="number">1</span>,x,y,z,opt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> segment tree </tag>
            
            <tag> Template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最短路模板</title>
      <link href="/shortest-path/"/>
      <url>/shortest-path/</url>
      
        <content type="html"><![CDATA[<blockquote><p>SPFA 堆优化迪杰斯特拉<br>C++模板</p></blockquote><a id="more"></a><h3 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h3><p><a href="https://www.luogu.org/problemnew/show/P3371">Luogu P3371</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">long</span> <span class="keyword">long</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; c ^ <span class="string">&#x27;-&#x27;</span>) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">9</span>) write (x / <span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">int</span>&amp; <span class="title">min</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; a, <span class="keyword">const</span> <span class="keyword">int</span>&amp; b)</span> </span>&#123;<span class="keyword">return</span> a&lt;b? a:b;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxm 500001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[maxn], nxt[maxm], too[maxm], ecnt;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> wei[maxm], dis[maxn];</span><br><span class="line"><span class="keyword">int</span> que[maxm*<span class="number">100</span> + <span class="number">100</span>];</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n = read (), m = read (), sta = read ();</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) dis[i] = <span class="number">2147483647</span>;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> fr, to, va;</span><br><span class="line"><span class="keyword">while</span> (m --)</span><br><span class="line">&#123;</span><br><span class="line">fr = read (), to = read (), va = read ();</span><br><span class="line">nxt[++ ecnt] = head[fr], head[fr] = ecnt, too[ecnt] = to, wei[ecnt] = va;</span><br><span class="line">&#125;</span><br><span class="line">dis[sta] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> hd = <span class="number">0</span>, tl = <span class="number">1</span>; que[tl] = sta;</span><br><span class="line"><span class="keyword">while</span> (hd &lt; tl)</span><br><span class="line">&#123;</span><br><span class="line">fr = que[++ hd], vis[fr] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = head[fr]; i; i = nxt[i])</span><br><span class="line">&#123;</span><br><span class="line">to = too[i], va = wei[i];</span><br><span class="line"><span class="keyword">if</span> (dis[to] &gt; dis[fr] + va)</span><br><span class="line">&#123;</span><br><span class="line">dis[to] = dis[fr] + va;</span><br><span class="line"><span class="keyword">if</span> (!vis[to]) vis[to] = <span class="literal">true</span>, que[++ tl] = to;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dis[i]&lt;<span class="number">0</span>) dis[i] = -dis[i], <span class="built_in">putchar</span> (<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">write (dis[i]), <span class="built_in">putchar</span> (<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="堆优化迪杰斯特拉"><a href="#堆优化迪杰斯特拉" class="headerlink" title="堆优化迪杰斯特拉"></a>堆优化迪杰斯特拉</h3><p><a href="https://www.luogu.org/problemnew/show/P4779">Luogu P4779</a></p><h4 id="OLD-2017"><a href="#OLD-2017" class="headerlink" title="OLD (2017)"></a>OLD (2017)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize (<span class="meta-string">&quot;Ofast&quot;</span>, 3)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target (<span class="meta-string">&quot;avx&quot;</span>,<span class="meta-string">&quot;sse2&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ext/pb_ds/priority_queue.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxm 200001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> inff 2147483647</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">char</span> c = getchar(); <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c) &amp;&amp; c != <span class="string">&#x27;-&#x27;</span>) c = getchar();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) c = getchar(), m = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) x = x * <span class="number">10</span> + c - <span class="number">48</span>, c = getchar();</span><br><span class="line">    <span class="keyword">if</span> (m) <span class="keyword">return</span> -x;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">fastwrite</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">9</span>) fastwrite(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">fastwritespace</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    fastwrite(x);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val, name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmp</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(<span class="keyword">const</span> node&amp; aa, <span class="keyword">const</span> node&amp; bb)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aa.val &gt; bb.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, fro, to, w;</span><br><span class="line"><span class="keyword">int</span> dis[maxn];</span><br><span class="line"><span class="keyword">bool</span> visit[maxn];</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="built_in">pair</span> &lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; data[maxn];</span><br><span class="line">__gnu_pbds::<span class="built_in">priority_queue</span> &lt;node, cmp, pairing_heap_tag&gt; nico;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    n = read (), m = read (), s = read ();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        fro = read (), to = read (), w = read ();</span><br><span class="line">        data[fro].push_back (<span class="built_in">make_pair</span> (to, w));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) dis[i] = inff;</span><br><span class="line">    dis[s] = <span class="number">0</span>;</span><br><span class="line">    nico.push ((node) &#123;</span><br><span class="line">        <span class="number">0</span>, s</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!nico.empty ()) &#123;</span><br><span class="line">        fro = nico.top ().name;</span><br><span class="line">        nico.pop ();</span><br><span class="line">        <span class="keyword">if</span> (visit[fro]) <span class="keyword">continue</span>;</span><br><span class="line">        visit[fro] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data[fro].size (); i ++) &#123;</span><br><span class="line">            to = data[fro][i].first;</span><br><span class="line">            w = data[fro][i].second;</span><br><span class="line">            <span class="keyword">if</span> (!visit[to] &amp;&amp; dis[fro] + w &lt; dis[to]) &#123;</span><br><span class="line">                dis[to] = dis[fro] + w;</span><br><span class="line">                nico.push ((node) &#123;</span><br><span class="line">                    dis[to], to</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) fastwritespace (dis[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="NEW-2018-11-5"><a href="#NEW-2018-11-5" class="headerlink" title="NEW(2018/11/5)"></a>NEW(2018/11/5)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> G++ optimize (3)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">priority_queue</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> ELAS = <span class="number">1</span>&lt;&lt;<span class="number">14</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> buf[ELAS],*p1=buf,*p2=buf;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,<span class="number">1</span>,ELAS,<span class="built_in">stdin</span>),p1==p2)?EOF:*p1++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> x = <span class="number">0</span>; <span class="keyword">register</span> <span class="keyword">char</span> c = gc(); <span class="keyword">register</span> <span class="keyword">bool</span> m = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">while</span> ((c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) &amp;&amp; (c ^ <span class="string">&#x27;-&#x27;</span>)) c = gc();</span><br><span class="line"><span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) m = <span class="literal">true</span>, c = gc ();</span><br><span class="line"><span class="keyword">while</span> (c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (c^<span class="string">&#x27;0&#x27;</span>), c = gc();</span><br><span class="line"><span class="keyword">return</span> m? -x:x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span> <span class="params">(<span class="keyword">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span> (x / <span class="number">10</span>);</span><br><span class="line"><span class="built_in">putchar</span> (x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">nwrite</span> <span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="built_in">write</span> (x); <span class="built_in">putchar</span> (<span class="string">&#x27; &#x27;</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxm 200001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Re register</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> id, val;</span><br><span class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (node a, node b) &#123;</span><br><span class="line"><span class="keyword">return</span> a.val &gt; b.val;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">priority_queue</span> &lt;node&gt; que;</span><br><span class="line"><span class="keyword">int</span> head[maxn], wei[maxm], too[maxm], nxt[maxm], ecnt;</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="keyword">int</span> dis[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> n = <span class="built_in">read</span> (), m = <span class="built_in">read</span> (), sta = <span class="built_in">read</span> ();</span><br><span class="line"><span class="keyword">register</span> <span class="keyword">int</span> fr, to, va;</span><br><span class="line"><span class="keyword">while</span> (m --)</span><br><span class="line">&#123;</span><br><span class="line">fr = <span class="built_in">read</span> (), nxt[++ ecnt] = head[fr],\</span><br><span class="line">head[fr] = ecnt, too[ecnt] = <span class="built_in">read</span> (), wei[ecnt] = <span class="built_in">read</span> ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span> (dis, <span class="number">0x3f3f3f3f</span>, <span class="keyword">sizeof</span> dis); dis[sta] = <span class="number">0</span>;</span><br><span class="line">que.push (&#123;sta, <span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!que.empty ())</span><br><span class="line">&#123;</span><br><span class="line">fr = que.top ().id, que.pop ();</span><br><span class="line"><span class="keyword">if</span> (!vis[fr])</span><br><span class="line">&#123;</span><br><span class="line">vis[fr] = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = head[fr]; i; i = nxt[i])</span><br><span class="line">&#123;</span><br><span class="line">to = too[i], va = wei[i];</span><br><span class="line"><span class="keyword">if</span> (dis[fr] + va &lt; dis[to])</span><br><span class="line">&#123;</span><br><span class="line">dis[to] = dis[fr] + va;</span><br><span class="line">que.push (&#123;to, dis[to]&#125;); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Re <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) nwrite (dis[i]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Olympiad in Informatics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Template </tag>
            
            <tag> 最短路 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HEXO博客的基本搭建</title>
      <link href="/hexo-buildup/"/>
      <url>/hexo-buildup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>HEXO 博客的基本搭建<br>安装 初始化 部署</p></blockquote><a id="more"></a><h2 id="事前准备"><a href="#事前准备" class="headerlink" title="事前准备"></a>事前准备</h2><h3 id="准备仓库"><a href="#准备仓库" class="headerlink" title="准备仓库"></a>准备仓库</h3><p>在 <a href="https://github.com/">GitHub</a> 上注册账号并创建仓库 yourname.github.io</p><h3 id="安装必要环境"><a href="#安装必要环境" class="headerlink" title="安装必要环境"></a>安装必要环境</h3><p>安装 <a href="https://nodejs.org/">node.js</a> 及 <a href="https://git-scm.com/">git</a></p><p>完成后在命令窗口分别输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line">git- version</span><br></pre></td></tr></table></figure><p>如显示正确版本号即为成功.</p><h3 id="SSH授权"><a href="#SSH授权" class="headerlink" title="SSH授权"></a>SSH授权</h3><p>在目录下右键,git bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>在C盘用户目录下用记事本打开公钥,复制内容添加到 GitHub.</p><p>在 git bash 中输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>测试是否成功.</p><h2 id="安装及运行"><a href="#安装及运行" class="headerlink" title="安装及运行"></a>安装及运行</h2><h3 id="安装和初始化-HEXO"><a href="#安装和初始化-HEXO" class="headerlink" title="安装和初始化 HEXO"></a>安装和初始化 <a href="https://hexo.io/">HEXO</a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-cli -g</span><br><span class="line">$ hexo init</span><br><span class="line">$ hexo g</span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure><h3 id="HEXO-命令一览"><a href="#HEXO-命令一览" class="headerlink" title="HEXO 命令一览"></a>HEXO 命令一览</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Commands:</span><br><span class="line">  clean     Remove generated files and cache.</span><br><span class="line">  config    Get or <span class="built_in">set</span> configurations.</span><br><span class="line">  deploy    Deploy your website.</span><br><span class="line">  generate  Generate static files.</span><br><span class="line">  <span class="built_in">help</span>      Get <span class="built_in">help</span> on a <span class="built_in">command</span>.</span><br><span class="line">  init      Create a new Hexo folder.</span><br><span class="line">  list      List the information of the site</span><br><span class="line">  migrate   Migrate your site from other system to Hexo.</span><br><span class="line">  new       Create a new post.</span><br><span class="line">  publish   Moves a draft post from _drafts to _posts folder.</span><br><span class="line">  render    Render files with renderer plugins.</span><br><span class="line">  server    Start the server.</span><br><span class="line">  version   Display version information.</span><br><span class="line"></span><br><span class="line">Global Options:</span><br><span class="line">  --config  Specify config file instead of using _config.yml</span><br><span class="line">  --cwd     Specify the CWD</span><br><span class="line">  --debug   Display all verbose messages <span class="keyword">in</span> the terminal</span><br><span class="line">  --draft   Display draft posts</span><br><span class="line">  --safe    Disable all plugins and scripts</span><br><span class="line">  --silent  Hide output on console</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> HEXO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HEXO </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
